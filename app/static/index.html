<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Spackler">
    <meta name="theme-color" content="#2C472F">
    <meta name="description" content="Quick sandbagger detection for golf tournaments and member-guests. Check if your opponents' handicaps are legit.">
    <title>üèåÔ∏è Spackler's Handicap Checker</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- App Icons -->
    <link rel="apple-touch-icon" href="/static/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/static/images/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/static/images/icon-512.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Special+Elite&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* üé® Bushwood Country Club Palette */
            --bushwood-green: #2C472F;
            --bushwood-dark: #1a2b1c;
            --grass-yellow: #E8D564;
            --explosives-red: #9E2A2A;
            --explosives-bright: #c43535;
            --dirt-brown: #8B6432;
            --dirt-dark: #5a4021;
            --gopher-tan: #C6AF7F;
            --gopher-light: #e0d4b8;
            --bunker-sand: #d4c69e;
            
            /* Utility colors */
            --corkboard-bg: #b8956b;
            --paper-cream: #f5f0e1;
            --paper-aged: #e8dcc4;
            --pencil-gray: #4a4a4a;
            --string-red: #8b0000;
            --polaroid-border: #f0f0e8;
            --coffee-stain: rgba(139, 100, 50, 0.15);
            --cigarette-burn: #3d2817;
            
            /* Base colors */
            --background: linear-gradient(180deg, var(--bushwood-green) 0%, var(--bushwood-dark) 100%);
            --background-solid: var(--bushwood-green);
            --card-bg: var(--paper-cream);
            --card-bg-alt: var(--paper-aged);
            --text-primary: #1a1a1a;
            --text-secondary: #5d5d5d;
            --border-color: var(--dirt-brown);
            --success: #2e7d32;
            --error: var(--explosives-red);
            --warning: var(--grass-yellow);
            
            /* Risk/Suspicion colors - Spackler scale */
            --risk-low: #4a7c4e;
            --risk-moderate: var(--grass-yellow);
            --risk-high: #d4632a;
            --risk-severe: var(--explosives-red);
            
            /* Fonts */
            --font-display: 'Bangers', cursive;
            --font-handwritten: 'Special Elite', monospace;
            --font-body: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            
            /* Spacing */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            
            /* Shadows - grungier */
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.2);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.25);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.35);
            --shadow-inset: inset 0 2px 8px rgba(0,0,0,0.15);
        }
        
        /* Serious Committee Mode overrides */
        body.serious-mode {
            --background: #f5f5f5;
            --background-solid: #f5f5f5;
            --card-bg: #ffffff;
            --card-bg-alt: #fafafa;
            --font-display: var(--font-body);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-body);
            background: var(--background);
            background-attachment: fixed;
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
        }
        
        /* ============================================
           üåø BUSHWOOD COURSE TEXTURE - Grass & Grime
           ============================================ */
        
        /* Animated grass texture overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                /* Grass texture */
                url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='grass' width='20' height='20' patternUnits='userSpaceOnUse'%3E%3Cpath d='M0 20 Q5 15 2 10 Q4 5 0 0' stroke='%23406344' stroke-width='0.5' fill='none' opacity='0.3'/%3E%3Cpath d='M10 20 Q12 12 8 5 Q10 2 12 0' stroke='%23365438' stroke-width='0.5' fill='none' opacity='0.25'/%3E%3Cpath d='M20 20 Q18 14 20 8' stroke='%23406344' stroke-width='0.5' fill='none' opacity='0.2'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23grass)'/%3E%3C/svg%3E"),
                /* Noise texture */
                url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E"),
                /* Subtle light spots */
                radial-gradient(circle at 20% 80%, rgba(232, 213, 100, 0.08) 0%, transparent 30%),
                radial-gradient(circle at 80% 20%, rgba(44, 71, 47, 0.1) 0%, transparent 35%),
                radial-gradient(circle at 50% 50%, rgba(139, 100, 50, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
            animation: grassSway 8s ease-in-out infinite;
        }
        
        @keyframes grassSway {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(-1px, 0); }
            50% { transform: translate(1px, 1px); }
            75% { transform: translate(0, -1px); }
        }
        
        body.serious-mode::before {
            display: none;
        }
        
        /* Gopher mounds decoration */
        body::after {
            content: 'üï≥Ô∏è';
            position: fixed;
            bottom: 20px;
            left: 30px;
            font-size: 2rem;
            opacity: 0.4;
            pointer-events: none;
            z-index: 0;
            animation: moundPeek 10s ease-in-out infinite;
        }
        
        @keyframes moundPeek {
            0%, 90%, 100% { transform: scale(1); }
            95% { transform: scale(1.2); }
        }
        
        body.serious-mode::after {
            display: none;
        }
        
        /* Additional gopher mound - random position */
        .gopher-mound {
            position: fixed;
            font-size: 1.5rem;
            opacity: 0.3;
            pointer-events: none;
            z-index: 0;
        }
        
        .gopher-mound:nth-child(1) {
            bottom: 15%;
            right: 10%;
        }
        
        .gopher-mound:nth-child(2) {
            top: 30%;
            left: 5%;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        /* ============================================
           üß® SPLASH SCREEN - "Licensed to Kill Handicaps"
           ============================================ */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center bottom, var(--bushwood-green) 0%, var(--bushwood-dark) 70%, #0a0f0a 100%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        .splash-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .splash-silhouette {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid var(--grass-yellow);
            box-shadow: 0 0 30px rgba(232, 213, 100, 0.5), 0 0 60px rgba(232, 213, 100, 0.3);
            animation: sway 3s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        .splash-silhouette img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center top;
        }
        
        @keyframes sway {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }
        
        .splash-explosion {
            position: absolute;
            font-size: 4rem;
            animation: explode 2s ease-out infinite;
        }
        
        .splash-explosion:nth-child(1) { top: 20%; left: 20%; animation-delay: 0s; }
        .splash-explosion:nth-child(2) { top: 30%; right: 25%; animation-delay: 0.5s; }
        .splash-explosion:nth-child(3) { bottom: 35%; left: 15%; animation-delay: 1s; }
        
        @keyframes explode {
            0% { transform: scale(0.8); opacity: 0.3; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(0.8); opacity: 0.3; }
        }
        
        .splash-logo {
            font-family: var(--font-display);
            font-size: 2.5rem;
            color: var(--grass-yellow);
            text-shadow: 3px 3px 0 var(--explosives-red), 6px 6px 0 rgba(0,0,0,0.3);
            letter-spacing: 2px;
            animation: shake 0.5s ease-in-out infinite;
            margin-bottom: 15px;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px) rotate(-0.5deg); }
            75% { transform: translateX(2px) rotate(0.5deg); }
        }
        
        .splash-tagline {
            font-family: var(--font-handwritten);
            color: var(--gopher-tan);
            font-size: 1.1rem;
            max-width: 400px;
            text-align: center;
            margin-bottom: 40px;
            opacity: 0;
            animation: fadeIn 1s ease-out 0.5s forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 0.9; }
        }
        
        .splash-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }
        
        .btn-dynamite {
            background: linear-gradient(180deg, var(--explosives-bright) 0%, var(--explosives-red) 100%);
            color: white;
            font-family: var(--font-display);
            font-size: 1.3rem;
            padding: 18px 40px;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            box-shadow: 0 6px 0 var(--dirt-dark), var(--shadow-lg);
            transition: all 0.1s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-dynamite::before {
            content: 'üß®';
            margin-right: 10px;
        }
        
        .btn-dynamite:hover {
            transform: translateY(2px);
            box-shadow: 0 4px 0 var(--dirt-dark), var(--shadow-md);
        }
        
        .btn-dynamite:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 var(--dirt-dark), var(--shadow-sm);
        }
        
        .btn-clipboard {
            background: linear-gradient(180deg, var(--gopher-tan) 0%, var(--dirt-brown) 100%);
            color: var(--bushwood-dark);
            font-family: var(--font-handwritten);
            font-size: 1rem;
            padding: 12px 25px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: all 0.2s ease;
        }
        
        .btn-clipboard::before {
            content: 'üìã';
            margin-right: 8px;
        }
        
        .btn-clipboard:hover {
            background: linear-gradient(180deg, var(--gopher-light) 0%, var(--gopher-tan) 100%);
        }

        /* ============================================
           üèåÔ∏è HEADER - "Groundskeeper's Command Center"
           ============================================ */
        header {
            background: 
                linear-gradient(180deg, rgba(0,0,0,0.1) 0%, transparent 20%),
                linear-gradient(135deg, var(--corkboard-bg) 0%, #a07850 100%);
            color: var(--text-primary);
            padding: 25px 20px 20px;
            text-align: center;
            box-shadow: var(--shadow-lg), inset 0 -3px 10px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
            border-bottom: 4px solid var(--dirt-dark);
        }
        
        /* Corkboard texture */
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                url("data:image/svg+xml,%3Csvg viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='cork'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23cork)' opacity='0.1'/%3E%3C/svg%3E");
            pointer-events: none;
        }
        
        /* Pushpin decorations */
        header::after {
            content: 'üìå';
            position: absolute;
            right: 25px;
            top: 15px;
            font-size: 1.5rem;
            transform: rotate(15deg);
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.3));
        }
        
        body.serious-mode header {
            background: linear-gradient(135deg, #37474f 0%, #263238 100%);
            color: white;
            border-bottom-color: #1a1a1a;
        }
        
        body.serious-mode header::before,
        body.serious-mode header::after {
            display: none;
        }

        header h1 {
            font-family: var(--font-display);
            font-size: 2rem;
            margin-bottom: 5px;
            color: var(--bushwood-dark);
            text-shadow: 2px 2px 0 rgba(255,255,255,0.3);
            position: relative;
            display: inline-block;
            letter-spacing: 1px;
        }
        
        header h1::before {
            content: 'üß®';
            margin-right: 10px;
            font-size: 1.5rem;
        }
        
        header h1::after {
            content: '‚õ≥';
            margin-left: 10px;
            font-size: 1.5rem;
        }
        
        body.serious-mode header h1 {
            font-family: var(--font-body);
            font-weight: 700;
            color: white;
            text-shadow: none;
        }
        
        body.serious-mode header h1::before,
        body.serious-mode header h1::after {
            display: none;
        }

        header p {
            color: var(--dirt-dark);
            font-size: 0.95rem;
            position: relative;
        }
        
        body.serious-mode header p {
            color: rgba(255,255,255,0.8);
        }
        
        .header-tagline {
            font-family: var(--font-handwritten);
            font-style: normal;
            color: var(--explosives-red);
            font-size: 1rem;
            margin-top: 5px;
            display: block;
        }
        
        body.serious-mode .header-tagline {
            display: none;
        }
        
        /* ============================================
           üêøÔ∏è GOPHER COMMAND CENTER - The Real Hero
           ============================================ */
        
        /* Gopher icon image styling */
        .gopher-icon {
            width: 1em;
            height: 1em;
            vertical-align: middle;
            display: inline-block;
        }
        
        .gopher-icon-large {
            width: 3.5rem;
            height: 3.5rem;
        }
        
        /* Gopher popup that appears randomly */
        .gopher-popup {
            position: fixed;
            bottom: -80px;
            right: 50px;
            width: 4rem;
            height: 4rem;
            z-index: 1000;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            cursor: pointer;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.4));
        }
        
        .gopher-popup img {
            width: 100%;
            height: 100%;
        }
        
        .gopher-popup.active {
            bottom: 10px;
        }
        
        /* Gopher hole - the burrow */
        .gopher-hole {
            position: fixed;
            bottom: 0;
            right: 40px;
            width: 80px;
            height: 40px;
            background: radial-gradient(ellipse at center, #2a1f0f 0%, #1a1208 60%, transparent 100%);
            border-radius: 50% 50% 0 0 / 100% 100% 0 0;
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .gopher-popup.active ~ .gopher-hole,
        .gopher-hole.visible {
            opacity: 1;
        }
        
        /* Gopher states - different moods */
        .gopher-popup.idle {
            animation: gopherBob 1s ease-in-out infinite alternate;
        }
        
        .gopher-popup.happy {
            animation: gopherDance 0.4s ease-in-out infinite;
        }
        
        .gopher-popup.alert {
            animation: gopherAlert 0.3s ease-in-out infinite;
        }
        
        .gopher-popup.suspicious {
            animation: gopherSuspicious 2s ease-in-out infinite;
        }
        
        .gopher-popup.angry {
            animation: gopherAngry 0.2s ease-in-out infinite;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.4)) hue-rotate(-20deg);
        }
        
        .gopher-popup.scared {
            animation: gopherScared 0.15s ease-in-out infinite;
        }
        
        @keyframes gopherBob {
            from { transform: translateY(0) rotate(-3deg); }
            to { transform: translateY(-8px) rotate(3deg); }
        }
        
        @keyframes gopherDance {
            0%, 100% { transform: translateY(0) rotate(0deg) scale(1); }
            25% { transform: translateY(-10px) rotate(-10deg) scale(1.1); }
            50% { transform: translateY(-5px) rotate(0deg) scale(1); }
            75% { transform: translateY(-10px) rotate(10deg) scale(1.1); }
        }
        
        @keyframes gopherAlert {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-15px) scale(1.2); }
        }
        
        @keyframes gopherSuspicious {
            0%, 100% { transform: rotate(0deg) translateX(0); }
            25% { transform: rotate(-5deg) translateX(-5px); }
            50% { transform: rotate(0deg) translateX(0); }
            75% { transform: rotate(5deg) translateX(5px); }
        }
        
        @keyframes gopherAngry {
            0%, 100% { transform: rotate(-5deg) scale(1.1); }
            50% { transform: rotate(5deg) scale(1.15); }
        }
        
        @keyframes gopherScared {
            0%, 100% { transform: translateY(-20px) scale(0.9); }
            50% { transform: translateY(-25px) scale(0.85); }
        }
        
        /* Dirt particles around gopher */
        .gopher-dirt {
            position: fixed;
            bottom: 30px;
            right: 60px;
            pointer-events: none;
            z-index: 998;
        }
        
        .dirt-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--dirt-brown);
            border-radius: 50%;
            animation: dirtSpray 1s ease-out forwards;
        }
        
        @keyframes dirtSpray {
            0% { 
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% { 
                transform: translate(var(--dx), var(--dy)) scale(0);
                opacity: 0;
            }
        }
        
        .gopher-speech {
            position: fixed;
            bottom: 110px;
            right: 20px;
            background: var(--paper-cream);
            color: var(--text-primary);
            padding: 15px 20px;
            border-radius: var(--radius-lg);
            font-family: var(--font-handwritten);
            font-size: 0.95rem;
            max-width: 280px;
            box-shadow: var(--shadow-lg), 0 0 0 3px var(--dirt-brown);
            opacity: 0;
            transform: scale(0.8) translateY(20px);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 1001;
            line-height: 1.5;
        }
        
        .gopher-speech::before {
            content: 'üéôÔ∏è';
            position: absolute;
            top: -12px;
            left: 15px;
            font-size: 1.2rem;
        }
        
        .gopher-speech.active {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
        
        .gopher-speech::after {
            content: '';
            position: absolute;
            bottom: -15px;
            right: 40px;
            border: 15px solid transparent;
            border-top-color: var(--paper-cream);
            border-bottom: none;
        }
        
        /* Speech bubble variants */
        .gopher-speech.warning {
            background: #fff3cd;
            border-color: var(--grass-yellow);
            box-shadow: var(--shadow-lg), 0 0 0 3px var(--grass-yellow);
        }
        
        .gopher-speech.warning::after {
            border-top-color: #fff3cd;
        }
        
        .gopher-speech.danger {
            background: #f8d7da;
            border-color: var(--explosives-red);
            box-shadow: var(--shadow-lg), 0 0 0 3px var(--explosives-red);
            animation: speechPulse 0.5s ease-in-out infinite;
        }
        
        .gopher-speech.danger::after {
            border-top-color: #f8d7da;
        }
        
        @keyframes speechPulse {
            0%, 100% { transform: scale(1) translateY(0); }
            50% { transform: scale(1.02) translateY(-2px); }
        }
        
        .gopher-speech.success {
            background: #d4edda;
            border-color: var(--success);
            box-shadow: var(--shadow-lg), 0 0 0 3px var(--success);
        }
        
        .gopher-speech.success::after {
            border-top-color: #d4edda;
        }
        
        body.serious-mode .gopher-popup,
        body.serious-mode .gopher-speech,
        body.serious-mode .gopher-hole,
        body.serious-mode .gopher-dirt {
            display: none !important;
        }
        
        /* ============================================
           üí° CARL'S TIP BANNER - Wisdom from the Lama
           ============================================ */
        .carl-tip {
            background: linear-gradient(135deg, var(--bushwood-dark) 0%, #2e5a2f 100%);
            color: var(--gopher-light);
            padding: 12px 20px;
            border-radius: var(--radius-md);
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--grass-yellow);
        }
        
        .carl-tip .tip-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .carl-tip .tip-text {
            flex: 1;
            font-family: var(--font-handwritten);
            font-size: 1rem;
            line-height: 1.4;
            transition: opacity 0.2s ease;
        }
        
        .carl-tip .tip-refresh {
            background: transparent;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            padding: 5px;
            border-radius: var(--radius-sm);
            transition: all 0.3s ease;
            opacity: 0.7;
        }
        
        .carl-tip .tip-refresh:hover {
            opacity: 1;
            transform: rotate(180deg);
            background: rgba(255,255,255,0.1);
        }
        
        body.serious-mode .carl-tip {
            display: none;
        }

        /* ============================================
           üìÅ TABS - Dynamite Buttons & Manila Folders
           ============================================ */
        .tabs {
            display: flex;
            background: var(--dirt-brown);
            border-bottom: none;
            margin-top: 20px;
            border-radius: var(--radius-md) var(--radius-md) 0 0;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            gap: 3px;
            padding: 8px 8px 0;
        }
        
        body.serious-mode .tabs {
            background: #455a64;
            padding: 0;
            gap: 0;
        }

        .tab {
            flex: 1;
            padding: 14px 15px;
            min-height: 48px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            background: var(--paper-aged);
            font-size: 0.9rem;
            font-weight: 600;
            font-family: var(--font-handwritten);
            color: var(--dirt-dark);
            -webkit-tap-highlight-color: transparent;
            position: relative;
            border-radius: var(--radius-sm) var(--radius-sm) 0 0;
            box-shadow: inset 0 -2px 4px rgba(0,0,0,0.1);
            margin-top: 4px;
        }
        
        body.serious-mode .tab {
            font-family: var(--font-body);
            background: #546e7a;
            color: white;
            border-radius: 0;
            margin-top: 0;
            box-shadow: none;
        }
        
        .tab::before {
            content: 'üìÑ';
            margin-right: 6px;
            font-size: 0.8rem;
        }
        
        body.serious-mode .tab::before {
            display: none;
        }

        .tab:hover {
            background: var(--paper-cream);
            transform: translateY(-2px);
            margin-top: 2px;
        }
        
        body.serious-mode .tab:hover {
            background: #607d8b;
            transform: none;
            margin-top: 0;
        }

        .tab.active {
            background: var(--paper-cream);
            color: var(--bushwood-dark);
            margin-top: 0;
            padding-bottom: 18px;
            box-shadow: var(--shadow-sm);
            z-index: 2;
        }
        
        body.serious-mode .tab.active {
            background: #37474f;
            padding-bottom: 14px;
        }
        
        /* üß® Special styling for Sandbagging/Suspects tab */
        .tab[onclick*="sandbagging"]::before {
            content: 'üîç';
        }
        
        .tab[onclick*="sandbagging"] {
            background: linear-gradient(180deg, #f5e6e6 0%, #e8d4d4 100%);
            border-left: 3px solid var(--explosives-red);
        }
        
        .tab[onclick*="sandbagging"]:hover {
            background: linear-gradient(180deg, #fff0f0 0%, #f5e6e6 100%);
        }
        
        .tab[onclick*="sandbagging"].active {
            background: linear-gradient(135deg, var(--explosives-red) 0%, var(--explosives-bright) 100%);
            color: white;
            border-left-color: var(--dirt-dark);
        }
        
        .tab[onclick*="sandbagging"].active::before {
            content: 'üß®';
        }
        
        body.serious-mode .tab[onclick*="sandbagging"] {
            background: #546e7a;
            border-left: none;
        }
        
        body.serious-mode .tab[onclick*="sandbagging"].active {
            background: #455a64;
        }

        /* ============================================
           üìã TAB CONTENT - Worn Clipboard Paper
           ============================================ */
        .tab-content {
            display: none;
            background: var(--paper-cream);
            padding: 25px;
            border-radius: 0 0 var(--radius-md) var(--radius-md);
            box-shadow: var(--shadow-md);
            position: relative;
            border: 1px solid var(--dirt-brown);
            border-top: none;
        }
        
        /* Coffee stain decoration */
        .tab-content::before {
            content: '';
            position: absolute;
            top: 20px;
            right: 30px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--coffee-stain);
            pointer-events: none;
            opacity: 0.5;
        }
        
        body.serious-mode .tab-content::before {
            display: none;
        }
        
        body.serious-mode .tab-content {
            background: white;
            border-color: #e0e0e0;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            margin-bottom: 25px;
            padding: 20px;
            background: var(--paper-aged);
            border-radius: var(--radius-md);
            border: 2px dashed var(--dirt-brown);
            position: relative;
        }
        
        /* Tape effect on form sections */
        .form-section::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 20px;
            width: 60px;
            height: 20px;
            background: linear-gradient(180deg, rgba(232, 213, 100, 0.7) 0%, rgba(232, 213, 100, 0.5) 100%);
            transform: rotate(-2deg);
            border-radius: 2px;
        }
        
        body.serious-mode .form-section {
            background: #fafafa;
            border: 1px solid #e0e0e0;
        }
        
        body.serious-mode .form-section::before {
            display: none;
        }

        .form-section h3 {
            font-family: var(--font-display);
            color: var(--bushwood-dark);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--dirt-brown);
            font-size: 1.2rem;
            letter-spacing: 1px;
        }
        
        .form-section h3::before {
            content: '‚úèÔ∏è';
            margin-right: 8px;
        }
        
        body.serious-mode .form-section h3 {
            font-family: var(--font-body);
            font-weight: 700;
            border-bottom-color: #e0e0e0;
        }
        
        body.serious-mode .form-section h3::before {
            display: none;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 500;
            margin-bottom: 5px;
            color: var(--dirt-dark);
            font-size: 0.9rem;
            font-family: var(--font-handwritten);
        }
        
        body.serious-mode .form-group label {
            font-family: var(--font-body);
            color: var(--text-secondary);
        }

        .form-group input,
        .form-group select {
            padding: 12px 15px;
            min-height: 44px;
            border: 2px solid var(--gopher-tan);
            border-radius: var(--radius-sm);
            font-size: 16px;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background: white;
            font-family: var(--font-body);
        }
        
        /* Scorecard-style inputs for Caddyshack mode */
        .scorecard-input {
            font-family: var(--font-handwritten) !important;
            background: linear-gradient(to bottom, 
                transparent 0%, 
                transparent 97%, 
                var(--gopher-tan) 97%, 
                var(--gopher-tan) 100%
            ) !important;
            background-size: 100% 1.5em !important;
            border: none !important;
            border-bottom: 2px solid var(--dirt-brown) !important;
            border-radius: 0 !important;
            padding: 8px 10px !important;
            color: var(--pencil-gray);
            font-size: 18px !important;
        }
        
        .scorecard-input:focus {
            box-shadow: none !important;
            border-bottom-color: var(--bushwood-green) !important;
            background: linear-gradient(to bottom, 
                rgba(232, 213, 100, 0.1) 0%, 
                rgba(232, 213, 100, 0.1) 97%, 
                var(--bushwood-green) 97%, 
                var(--bushwood-green) 100%
            ) !important;
        }
        
        body.serious-mode .scorecard-input {
            font-family: var(--font-body) !important;
            background: white !important;
            border: 1px solid #e0e0e0 !important;
            border-radius: var(--radius-sm) !important;
        }
        
        body.serious-mode .form-group input,
        body.serious-mode .form-group select {
            border-color: #e0e0e0;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--bushwood-green);
            box-shadow: 0 0 0 3px rgba(44, 71, 47, 0.2);
        }
        
        /* ============================================
           üìù SCORECARD STYLING - Pencil & Paper Feel
           ============================================ */
        .score-entry {
            position: relative;
            background: var(--paper-cream);
            border: 1px dashed var(--gopher-tan);
            border-radius: var(--radius-sm);
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .score-entry:hover {
            border-style: solid;
            border-color: var(--dirt-brown);
            box-shadow: var(--shadow-sm);
        }
        
        .score-entry::before {
            content: '‚úèÔ∏è';
            position: absolute;
            top: -8px;
            right: 10px;
            font-size: 0.8rem;
            background: var(--paper-cream);
            padding: 0 5px;
        }
        
        body.serious-mode .score-entry::before {
            display: none;
        }
        
        body.serious-mode .score-entry {
            background: #fafafa;
            border-style: solid;
            border-color: #e0e0e0;
        }
        
        /* Scorecard grid layout */
        .scorecard-container {
            display: grid;
            gap: 10px;
            padding: 20px;
            background: linear-gradient(135deg, var(--paper-cream) 0%, var(--paper-aged) 100%);
            border: 3px double var(--dirt-brown);
            border-radius: var(--radius-md);
            position: relative;
            box-shadow: var(--shadow-inset);
        }
        
        .scorecard-container::before {
            content: 'üèåÔ∏è OFFICIAL SCORECARD';
            position: absolute;
            top: -12px;
            left: 20px;
            background: var(--paper-cream);
            padding: 0 10px;
            font-family: var(--font-display);
            font-size: 0.7rem;
            color: var(--dirt-brown);
            letter-spacing: 2px;
        }
        
        body.serious-mode .scorecard-container {
            background: #fafafa;
            border: 1px solid #e0e0e0;
            box-shadow: none;
        }
        
        body.serious-mode .scorecard-container::before {
            display: none;
        }
        
        /* Coffee stain decoration */
        .coffee-stain {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(
                ellipse at center,
                transparent 30%,
                var(--coffee-stain) 35%,
                var(--coffee-stain) 40%,
                transparent 45%
            );
            pointer-events: none;
            opacity: 0.6;
        }
        
        body.serious-mode .coffee-stain {
            display: none;
        }

        /* ============================================
           üîò BUTTONS - Dynamite & Dirt Style
           ============================================ */
        .btn {
            display: inline-block;
            padding: 15px 30px;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: var(--font-display);
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        body.serious-mode .btn {
            font-family: var(--font-body);
            letter-spacing: 0;
        }

        .btn-primary {
            background: linear-gradient(180deg, var(--bushwood-green) 0%, var(--bushwood-dark) 100%);
            color: white;
            box-shadow: 0 4px 0 var(--dirt-dark), var(--shadow-md);
        }
        
        body.serious-mode .btn-primary {
            background: #37474f;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(2px);
            box-shadow: 0 2px 0 var(--dirt-dark), var(--shadow-sm);
        }
        
        body.serious-mode .btn-primary:hover {
            background: #455a64;
            transform: none;
        }
        
        .btn-primary:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 var(--dirt-dark);
        }

        .btn-secondary {
            background: linear-gradient(180deg, var(--gopher-tan) 0%, var(--dirt-brown) 100%);
            color: var(--bushwood-dark);
            box-shadow: 0 3px 0 var(--dirt-dark), var(--shadow-sm);
        }
        
        body.serious-mode .btn-secondary {
            background: #78909c;
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary:hover {
            transform: translateY(1px);
            box-shadow: 0 2px 0 var(--dirt-dark);
        }
        
        /* DANGER button for suspicious analysis */
        .btn-danger {
            background: linear-gradient(180deg, var(--explosives-bright) 0%, var(--explosives-red) 100%);
            color: white;
            box-shadow: 0 4px 0 #5a1515, var(--shadow-md);
            animation: pulse-danger 2s infinite;
        }
        
        @keyframes pulse-danger {
            0%, 100% { box-shadow: 0 4px 0 #5a1515, 0 0 0 0 rgba(158, 42, 42, 0.4); }
            50% { box-shadow: 0 4px 0 #5a1515, 0 0 0 8px rgba(158, 42, 42, 0); }
        }
        
        .btn-danger:hover {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #5a1515, var(--shadow-sm);
            animation: none;
        }
        
        body.serious-mode .btn-danger {
            background: #c62828;
            box-shadow: var(--shadow-md);
            animation: none;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-full {
            width: 100%;
        }

        /* ============================================
           üìù SCORE ENTRIES - Lined Paper Style
           ============================================ */
        .score-entry {
            margin-bottom: 15px;
            padding: 15px;
            background: linear-gradient(to bottom, 
                transparent 0px, transparent 27px, 
                #e0d5c7 27px, #e0d5c7 28px,
                transparent 28px);
            background-size: 100% 28px;
            background-color: var(--paper-cream);
            border-radius: var(--radius-sm);
            border: 1px solid var(--gopher-tan);
            border-left: 4px solid var(--explosives-red);
            position: relative;
        }
        
        .score-entry::before {
            content: '';
            position: absolute;
            left: 35px;
            top: 0;
            bottom: 0;
            width: 1px;
            background: rgba(158, 42, 42, 0.3);
        }
        
        body.serious-mode .score-entry {
            background: #f9f9f9;
            border-left-color: #607d8b;
        }
        
        body.serious-mode .score-entry::before {
            display: none;
        }

        /* ============================================
           üè∑Ô∏è BADGES - Weathered Labels
           ============================================ */
        .badge {
            background: linear-gradient(135deg, var(--bushwood-green) 0%, var(--bushwood-dark) 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 3px;
            font-size: 0.8rem;
            font-weight: 600;
            font-family: var(--font-handwritten);
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(0,0,0,0.2);
        }
        
        body.serious-mode .badge {
            font-family: var(--font-body);
            border-radius: 4px;
        }
        
        /* Suspicion badges - Spackler severity scale */
        .badge-low {
            background: linear-gradient(135deg, var(--risk-low) 0%, #3a5f3c 100%);
        }
        
        .badge-moderate {
            background: linear-gradient(135deg, var(--grass-yellow) 0%, #c9b84d 100%);
            color: var(--bushwood-dark);
        }
        
        .badge-high {
            background: linear-gradient(135deg, #d4632a 0%, #a84a1f 100%);
        }
        
        .badge-severe {
            background: linear-gradient(135deg, var(--explosives-red) 0%, #6a1a1a 100%);
            animation: pulse-badge 2s infinite;
            position: relative;
        }
        
        .badge-severe::before {
            content: 'üß®';
            margin-right: 5px;
            font-size: 0.7rem;
        }
        
        body.serious-mode .badge-severe {
            animation: none;
        }
        
        body.serious-mode .badge-severe::before {
            display: none;
        }
        
        @keyframes pulse-badge {
            0%, 100% { box-shadow: 0 0 0 0 rgba(158, 42, 42, 0.5); }
            50% { box-shadow: 0 0 0 6px rgba(158, 42, 42, 0); }
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        /* ============================================
           üìä RESULTS SECTION - Polaroid & Pinned Notes
           ============================================ */
        .results-section {
            margin-top: 30px;
        }

        .results-section h3 {
            font-family: var(--font-display);
            color: var(--bushwood-dark);
            margin-bottom: 20px;
            font-size: 1.3rem;
            letter-spacing: 1px;
        }
        
        .results-section h3::before {
            content: 'üìã';
            margin-right: 10px;
        }
        
        body.serious-mode .results-section h3 {
            font-family: var(--font-body);
            font-weight: 700;
        }
        
        body.serious-mode .results-section h3::before {
            display: none;
        }

        .result-card {
            background: var(--paper-cream);
            border: none;
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 4px 4px 0 var(--dirt-brown), var(--shadow-md);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
        }
        
        /* Tape on corner */
        .result-card::before {
            content: '';
            position: absolute;
            top: -5px;
            right: 20px;
            width: 40px;
            height: 25px;
            background: linear-gradient(180deg, rgba(232, 213, 100, 0.8) 0%, rgba(232, 213, 100, 0.6) 100%);
            transform: rotate(5deg);
            border-radius: 2px;
        }
        
        .result-card:hover {
            transform: translateY(-3px) rotate(0.5deg);
            box-shadow: 6px 6px 0 var(--dirt-brown), var(--shadow-lg);
        }
        
        body.serious-mode .result-card {
            background: #ffffff;
            border: 1px solid #e0e0e0;
            box-shadow: var(--shadow-sm);
        }
        
        body.serious-mode .result-card::before {
            display: none;
        }
        
        body.serious-mode .result-card:hover {
            transform: none;
            box-shadow: var(--shadow-md);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px dashed var(--gopher-tan);
        }

        .result-header h4 {
            font-family: var(--font-display);
            color: var(--bushwood-dark);
            font-size: 1.1rem;
            letter-spacing: 0.5px;
        }
        
        body.serious-mode .result-header h4 {
            font-family: var(--font-body);
            font-weight: 700;
        }

        .probability-badge {
            background: linear-gradient(135deg, var(--bushwood-green) 0%, var(--bushwood-dark) 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 1.1rem;
            font-family: var(--font-handwritten);
            box-shadow: 2px 2px 0 rgba(0,0,0,0.2);
        }
        
        body.serious-mode .probability-badge {
            font-family: var(--font-body);
            border-radius: 20px;
            box-shadow: var(--shadow-sm);
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .detail-item {
            text-align: center;
            padding: 12px;
            background: rgba(255,255,255,0.8);
            border-radius: var(--radius-sm);
            border: 1px solid var(--gopher-tan);
        }
        
        body.serious-mode .detail-item {
            background: #fafafa;
            border-color: #e0e0e0;
        }

        .detail-item .label {
            font-size: 0.8rem;
            color: var(--dirt-dark);
            margin-bottom: 5px;
            font-family: var(--font-handwritten);
        }
        
        body.serious-mode .detail-item .label {
            font-family: var(--font-body);
            color: var(--text-secondary);
        }

        .detail-item .value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .milestones-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .milestones-table th,
        .milestones-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        .milestones-table th {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            font-weight: 600;
            font-family: var(--font-display);
            font-size: 0.9rem;
        }
        
        body.serious-mode .milestones-table th {
            font-family: var(--font-body);
        }

        .milestones-table tr:hover {
            background: var(--scorecard-cream);
        }
        
        body.serious-mode .milestones-table tr:hover {
            background: #f5f5f5;
        }

        .milestones-table .prob-high {
            color: var(--success);
            font-weight: 600;
        }

        .milestones-table .prob-low {
            color: var(--error);
        }

        .error-message {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            color: var(--error);
            padding: 15px;
            border-radius: var(--radius-md);
            margin-top: 15px;
            border: 1px solid #ef9a9a;
            border-left: 4px solid var(--error);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* Gopher spinner for Caddyshack mode */
        .loading::before {
            content: '';
            display: block;
            width: 2.5rem;
            height: 2.5rem;
            margin: 0 auto 10px auto;
            background-image: url('/static/images/gopher.svg');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            animation: wiggle 0.5s ease-in-out infinite;
        }
        
        body.serious-mode .loading::before {
            display: none;
        }
        
        @keyframes wiggle {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ============================================
           üêøÔ∏è ENHANCED LOADING STATES - Carl's Commentary
           ============================================ */
        .loading-carl-quote {
            font-family: var(--font-handwritten);
            font-size: 0.95rem;
            color: var(--dirt-brown);
            opacity: 0.9;
            margin-top: 10px;
            padding: 10px 15px;
            background: var(--paper-aged);
            border-radius: var(--radius-sm);
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
            transition: opacity 0.3s ease;
            position: relative;
        }
        
        .loading-carl-quote::before {
            content: '"';
            font-size: 2rem;
            position: absolute;
            left: 5px;
            top: -5px;
            opacity: 0.3;
            font-family: var(--font-display);
        }
        
        .gopher-digging {
            margin-top: 15px;
            animation: gopher-dig 0.8s ease-in-out infinite;
            display: inline-block;
        }
        
        .gopher-digging img {
            width: 3rem;
            height: 3rem;
        }
        
        @keyframes gopher-dig {
            0%, 100% { 
                transform: translateY(0) rotate(0deg); 
            }
            25% { 
                transform: translateY(-10px) rotate(-10deg); 
            }
            50% { 
                transform: translateY(5px) rotate(5deg); 
            }
            75% { 
                transform: translateY(-5px) rotate(-5deg); 
            }
        }
        
        body.serious-mode .loading-carl-quote,
        body.serious-mode .gopher-digging {
            display: none;
        }
        
        /* ============================================
           üé¨ CARL'S NARRATION BOX - The Story Unfolds
           ============================================ */
        .carl-narration {
            background: linear-gradient(135deg, var(--bushwood-dark) 0%, var(--bushwood-green) 100%);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-md), inset 0 1px 0 rgba(255,255,255,0.1);
        }
        
        .carl-narration::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
            pointer-events: none;
        }
        
        .narration-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
            border: 3px solid var(--grass-yellow);
            box-shadow: 0 3px 0 var(--dirt-brown);
            animation: avatar-pulse 2s ease-in-out infinite;
        }
        
        .narration-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center top;
        }
        
        @keyframes avatar-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .narration-text {
            font-family: var(--font-handwritten);
            font-size: 1.1rem;
            color: var(--gopher-light);
            line-height: 1.6;
            position: relative;
            z-index: 1;
            padding-top: 5px;
        }
        
        .narration-text::before {
            content: 'üéôÔ∏è Carl says:';
            display: block;
            font-family: var(--font-display);
            font-size: 0.8rem;
            color: var(--grass-yellow);
            margin-bottom: 8px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        body.serious-mode .carl-narration {
            display: none;
        }

        .team-player-section {
            background: var(--scorecard-cream);
            padding: 20px;
            border-radius: var(--radius-md);
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }
        
        body.serious-mode .team-player-section {
            background: #f9f9f9;
        }

        .team-player-section h4 {
            font-family: var(--font-display);
            color: var(--primary-dark);
            margin-bottom: 15px;
            font-size: 1rem;
        }
        
        body.serious-mode .team-player-section h4 {
            font-family: var(--font-body);
            font-weight: 700;
        }
        
        /* ============================================
           üéØ SPACKLER CHEAT METER - Dynamite Fuse Gauge
           ============================================ */
        .suspicion-gauge {
            width: 100%;
            max-width: 320px;
            margin: 25px auto;
            text-align: center;
            padding: 20px;
            background: var(--paper-aged);
            border-radius: var(--radius-md);
            border: 3px solid var(--dirt-brown);
            box-shadow: var(--shadow-md);
            position: relative;
        }
        
        .suspicion-gauge::before {
            content: 'üß® SPACKLER SUSPICION-O-METER';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--explosives-red);
            color: white;
            padding: 4px 15px;
            font-family: var(--font-display);
            font-size: 0.75rem;
            letter-spacing: 1px;
            border-radius: 3px;
            white-space: nowrap;
        }
        
        body.serious-mode .suspicion-gauge::before {
            content: 'RISK ASSESSMENT';
            background: #455a64;
            font-family: var(--font-body);
        }
        
        .gauge-container {
            position: relative;
            width: 220px;
            height: 110px;
            margin: 15px auto 20px;
            overflow: hidden;
        }
        
        .gauge-background {
            width: 220px;
            height: 220px;
            border-radius: 110px 110px 0 0;
            background: linear-gradient(
                to right,
                var(--risk-low) 0%,
                var(--grass-yellow) 40%,
                #d4632a 70%,
                var(--explosives-red) 100%
            );
            position: absolute;
            top: 0;
            border: 3px solid var(--dirt-dark);
            border-bottom: none;
        }
        
        .gauge-cover {
            width: 150px;
            height: 150px;
            border-radius: 75px 75px 0 0;
            background: var(--paper-cream);
            position: absolute;
            top: 35px;
            left: 35px;
            border: 2px solid var(--gopher-tan);
            border-bottom: none;
        }
        
        .gauge-needle {
            width: 6px;
            height: 85px;
            background: linear-gradient(180deg, var(--explosives-red) 0%, var(--dirt-dark) 100%);
            position: absolute;
            bottom: 0;
            left: 107px;
            transform-origin: bottom center;
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border-radius: 3px 3px 0 0;
            box-shadow: 2px 0 4px rgba(0,0,0,0.3);
        }
        
        .gauge-center {
            width: 24px;
            height: 24px;
            background: radial-gradient(circle at 30% 30%, var(--gopher-tan), var(--dirt-dark));
            border-radius: 50%;
            position: absolute;
            bottom: -12px;
            left: 98px;
            border: 2px solid var(--dirt-dark);
            box-shadow: var(--shadow-sm);
        }
        
        /* Tick marks on gauge */
        .gauge-ticks {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }
        
        .gauge-label {
            font-family: var(--font-display);
            font-size: 2.5rem;
            color: var(--bushwood-dark);
            text-shadow: 2px 2px 0 rgba(255,255,255,0.5);
        }
        
        body.serious-mode .gauge-label {
            font-family: var(--font-body);
            font-weight: 700;
            text-shadow: none;
        }
        
        .gauge-sublabel {
            font-size: 1rem;
            color: var(--dirt-dark);
            font-family: var(--font-handwritten);
            margin-top: 5px;
        }
        
        body.serious-mode .gauge-sublabel {
            font-family: var(--font-body);
            color: var(--text-secondary);
        }
        
        /* üß® DYNAMITE FUSE EFFECT - Burns when risk is high */
        .dynamite-fuse {
            position: absolute;
            top: -30px;
            right: 20px;
            width: 4px;
            height: 50px;
            background: linear-gradient(180deg, 
                #4a3728 0%, 
                #2d2118 50%, 
                #4a3728 100%
            );
            border-radius: 2px;
            display: none;
        }
        
        .dynamite-fuse::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -4px;
            width: 12px;
            height: 12px;
            background: radial-gradient(circle, #ff6b00 0%, #ff4500 50%, #cc0000 100%);
            border-radius: 50%;
            animation: fuseFlicker 0.15s ease-in-out infinite;
            box-shadow: 0 0 10px #ff6b00, 0 0 20px #ff4500;
        }
        
        .dynamite-fuse::after {
            content: 'üí•';
            position: absolute;
            top: -25px;
            left: -12px;
            font-size: 1.5rem;
            animation: sparkJump 0.3s ease-out infinite;
        }
        
        @keyframes fuseFlicker {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.8; }
        }
        
        @keyframes sparkJump {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-10px) rotate(15deg); opacity: 0; }
        }
        
        .suspicion-gauge.high-risk .dynamite-fuse {
            display: block;
            animation: fuseBurn 2s linear infinite;
        }
        
        @keyframes fuseBurn {
            0% { height: 50px; }
            100% { height: 10px; }
        }
        
        body.serious-mode .dynamite-fuse {
            display: none !important;
        }
        
        /* Explosive warning for severe risk */
        .explosion-warning {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--explosives-red);
            color: white;
            font-family: var(--font-display);
            font-size: 0.65rem;
            padding: 3px 12px;
            border-radius: 10px;
            letter-spacing: 1px;
            opacity: 0;
            transition: opacity 0.3s ease;
            white-space: nowrap;
        }
        
        .suspicion-gauge.high-risk .explosion-warning {
            opacity: 1;
            animation: warningPulse 1s ease-in-out infinite;
        }
        
        @keyframes warningPulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
        }
        
        body.serious-mode .explosion-warning {
            display: none;
        }
        
        /* Gauge tier markers */
        .gauge-markers {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.7rem;
            color: var(--dirt-dark);
            font-family: var(--font-handwritten);
        }
        
        body.serious-mode .gauge-markers {
            font-family: var(--font-body);
        }
        
        body.serious-mode .suspicion-gauge {
            background: white;
            border-color: #e0e0e0;
        }
        
        /* ============================================
           üé≠ VERDICT CARD - Cheater Reveal Theatrics
           ============================================ */
        .verdict-card {
            border: 3px solid var(--dirt-brown) !important;
            position: relative;
            overflow: hidden;
        }
        
        .verdict-card.severe-verdict {
            border-color: var(--explosives-red) !important;
            animation: verdict-pulse 2s infinite;
        }
        
        /* üö® WANTED POSTER - For severe sandbaggers */
        .verdict-card.severe-verdict::before {
            content: '‚ö†Ô∏è WANTED ‚ö†Ô∏è';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: var(--explosives-red);
            color: white;
            font-family: var(--font-display);
            font-size: 1rem;
            text-align: center;
            padding: 8px;
            letter-spacing: 3px;
            animation: wanted-flash 1s ease-in-out infinite;
        }
        
        @keyframes wanted-flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .verdict-card.severe-verdict .result-header {
            margin-top: 45px;
        }
        
        .verdict-card.severe-verdict::after {
            content: 'üß®';
            position: absolute;
            top: 50px;
            right: 15px;
            font-size: 2rem;
            animation: dynamite-shake 0.5s ease-in-out infinite;
            opacity: 0.8;
        }
        
        @keyframes dynamite-shake {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }
        
        body.serious-mode .verdict-card.severe-verdict::before,
        body.serious-mode .verdict-card.severe-verdict::after {
            display: none;
        }
        
        body.serious-mode .verdict-card.severe-verdict .result-header {
            margin-top: 0;
        }
        
        .verdict-card.high-verdict {
            border-color: #D97706 !important; /* amber/orange */
            animation: verdict-pulse-high 3s infinite;
        }
        
        .verdict-card.high-verdict::before {
            content: 'üîç UNDER INVESTIGATION';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: #D97706;
            color: white;
            font-family: var(--font-display);
            font-size: 0.85rem;
            text-align: center;
            padding: 6px;
            letter-spacing: 2px;
        }
        
        .verdict-card.high-verdict .result-header {
            margin-top: 35px;
        }
        
        body.serious-mode .verdict-card.high-verdict::before {
            display: none;
        }
        
        body.serious-mode .verdict-card.high-verdict .result-header {
            margin-top: 0;
        }
        
        .verdict-card.moderate-verdict {
            border-color: var(--grass-yellow) !important;
        }
        
        @keyframes verdict-pulse {
            0%, 100% { box-shadow: 4px 4px 0 var(--dirt-brown), 0 0 0 0 rgba(158, 42, 42, 0.3); }
            50% { box-shadow: 4px 4px 0 var(--dirt-brown), 0 0 20px 5px rgba(158, 42, 42, 0); }
        }
        
        @keyframes verdict-pulse-high {
            0%, 100% { box-shadow: 4px 4px 0 var(--dirt-brown), 0 0 0 0 rgba(217, 119, 6, 0.3); }
            50% { box-shadow: 4px 4px 0 var(--dirt-brown), 0 0 15px 3px rgba(217, 119, 6, 0); }
        }
        
        body.serious-mode .verdict-card {
            animation: none;
        }
        
        .tier-ruling {
            text-align: center;
            font-family: var(--font-display);
            font-size: 1.3rem;
            margin: 20px 0;
            padding: 15px;
            background: var(--paper-aged);
            border-radius: var(--radius-md);
            color: var(--bushwood-dark);
            letter-spacing: 1px;
            border: 2px dashed var(--gopher-tan);
        }
        
        body.serious-mode .tier-ruling {
            font-family: var(--font-body);
            font-weight: 700;
            background: #f5f5f5;
            border-style: solid;
            border-color: #e0e0e0;
        }
        
        .summary-text {
            margin: 20px 0;
            padding: 20px;
            background: var(--paper-cream);
            border-radius: var(--radius-md);
            font-size: 1rem;
            line-height: 1.7;
            border-left: 4px solid var(--bushwood-green);
            font-family: var(--font-handwritten);
        }
        
        body.serious-mode .summary-text {
            font-family: var(--font-body);
            background: #fafafa;
        }
        
        .recommendation-box {
            padding: 18px;
            background: var(--gopher-light);
            border-radius: var(--radius-md);
            border-left: 4px solid var(--bushwood-green);
        }
        
        .recommendation-box strong {
            font-family: var(--font-display);
            letter-spacing: 0.5px;
        }
        
        body.serious-mode .recommendation-box strong {
            font-family: var(--font-body);
        }
        
        .recommendation-box p {
            margin-top: 10px;
            font-family: var(--font-handwritten);
        }
        
        body.serious-mode .recommendation-box {
            background: #f0f0f0;
        }
        
        body.serious-mode .recommendation-box p {
            font-family: var(--font-body);
        }
        
        .verdict-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px dashed var(--gopher-tan);
        }

        /* ============================================
           üö© RED FLAGS - Torn Note Cards
           ============================================ */
        .red-flag-item {
            margin-bottom: 18px;
            padding: 18px;
            border-radius: var(--radius-sm);
            background: var(--paper-cream);
            border-left: 5px solid;
            box-shadow: 3px 3px 0 var(--dirt-brown), var(--shadow-sm);
            transition: transform 0.2s ease;
            position: relative;
        }
        
        /* Torn edge effect */
        .red-flag-item::after {
            content: '';
            position: absolute;
            top: 0;
            right: -3px;
            bottom: 0;
            width: 3px;
            background: linear-gradient(
                to bottom,
                var(--paper-cream) 0%,
                transparent 5%,
                var(--paper-cream) 10%,
                transparent 15%,
                var(--paper-cream) 20%,
                transparent 25%,
                var(--paper-cream) 30%,
                transparent 35%,
                var(--paper-cream) 40%,
                transparent 45%,
                var(--paper-cream) 50%,
                transparent 55%,
                var(--paper-cream) 60%,
                transparent 65%,
                var(--paper-cream) 70%,
                transparent 75%,
                var(--paper-cream) 80%,
                transparent 85%,
                var(--paper-cream) 90%,
                transparent 95%,
                var(--paper-cream) 100%
            );
        }
        
        .red-flag-item:hover {
            transform: translateX(5px) rotate(0.5deg);
        }
        
        body.serious-mode .red-flag-item:hover {
            transform: none;
        }
        
        body.serious-mode .red-flag-item::after {
            display: none;
        }
        
        .red-flag-item.severity-low {
            border-left-color: #4a7c4e;
            background: linear-gradient(to right, #e8f0e8 0%, var(--paper-cream) 25%);
        }
        
        .red-flag-item.severity-medium {
            border-left-color: var(--grass-yellow);
            background: linear-gradient(to right, #f5f0d8 0%, var(--paper-cream) 25%);
        }
        
        .red-flag-item.severity-high {
            border-left-color: #d4632a;
            background: linear-gradient(to right, #f5e6df 0%, var(--paper-cream) 25%);
        }
        
        .red-flag-item.severity-critical {
            border-left-color: var(--explosives-red);
            background: linear-gradient(to right, #f5dfdf 0%, var(--paper-cream) 25%);
            animation: flag-shake 0.5s ease-in-out;
        }
        
        @keyframes flag-shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px) rotate(-0.5deg); }
            75% { transform: translateX(3px) rotate(0.5deg); }
        }
        
        body.serious-mode .red-flag-item {
            background: #fff;
            box-shadow: var(--shadow-sm);
            animation: none;
        }
        
        .flag-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .flag-severity {
            font-weight: 700;
            font-size: 0.85rem;
            font-family: var(--font-display);
            letter-spacing: 0.5px;
        }
        
        body.serious-mode .flag-severity {
            font-family: var(--font-body);
        }
        
        .flag-type {
            font-size: 0.75rem;
            color: var(--dirt-dark);
            font-family: var(--font-handwritten);
            background: var(--gopher-light);
            padding: 2px 8px;
            border-radius: 2px;
        }
        
        body.serious-mode .flag-type {
            font-family: var(--font-body);
            background: #f0f0f0;
        }
        
        .flag-description {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 0.95rem;
            color: var(--bushwood-dark);
        }
        
        .flag-evidence {
            font-size: 0.9rem;
            color: var(--dirt-dark);
            margin-bottom: 8px;
            padding: 8px;
            background: rgba(255,255,255,0.5);
            border-radius: var(--radius-sm);
            font-family: var(--font-handwritten);
        }
        
        body.serious-mode .flag-evidence {
            font-family: var(--font-body);
            background: #fafafa;
        }
        
        .flag-quip {
            font-style: italic;
            color: var(--explosives-red);
            font-size: 0.85rem;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed var(--gopher-tan);
            font-family: var(--font-handwritten);
        }
        
        .flag-quip::before {
            content: '"';
        }
        
        .flag-quip::after {
            content: '" ‚Äî Carl';
        }
        
        body.serious-mode .flag-quip {
            display: none;
        }
        
        .flag-note {
            font-style: italic;
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        .no-flags {
            color: var(--risk-low);
            font-family: var(--font-handwritten);
            text-align: center;
            padding: 25px;
            background: rgba(74, 124, 78, 0.1);
            border-radius: var(--radius-md);
            border: 2px dashed var(--risk-low);
        }
        
        body.serious-mode .no-flags {
            font-family: var(--font-body);
            font-style: italic;
        }
        
        /* ============================================
           üèÜ ACHIEVEMENTS - Spackler License System
           ============================================ */
        .achievements-panel {
            position: fixed;
            top: 80px;
            right: -320px;
            width: 300px;
            max-height: calc(100vh - 100px);
            background: linear-gradient(135deg, var(--paper-cream) 0%, var(--paper-aged) 100%);
            border: 3px solid var(--dirt-brown);
            border-right: none;
            border-radius: var(--radius-lg) 0 0 var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 900;
            transition: right 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            overflow-y: auto;
        }
        
        .achievements-panel.open {
            right: 0;
        }
        
        .achievements-toggle {
            position: fixed;
            top: 80px;
            right: 0;
            background: var(--grass-yellow);
            color: var(--bushwood-dark);
            font-size: 1.5rem;
            padding: 15px 10px;
            border: 3px solid var(--dirt-brown);
            border-right: none;
            border-radius: var(--radius-md) 0 0 var(--radius-md);
            cursor: pointer;
            z-index: 901;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }
        
        .achievements-toggle:hover {
            background: var(--explosives-red);
            color: white;
            transform: translateX(-5px);
        }
        
        .achievements-toggle .badge-count {
            position: absolute;
            top: -5px;
            left: -5px;
            background: var(--explosives-red);
            color: white;
            font-size: 0.7rem;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-body);
            font-weight: bold;
        }
        
        .achievements-header {
            background: var(--bushwood-green);
            color: white;
            padding: 15px 20px;
            font-family: var(--font-display);
            font-size: 1.1rem;
            letter-spacing: 1px;
            text-align: center;
            position: sticky;
            top: 0;
        }
        
        .achievements-header::after {
            content: 'üèÜ';
            display: block;
            font-size: 2rem;
            margin-top: 5px;
        }
        
        .achievement-item {
            padding: 15px 20px;
            border-bottom: 1px dashed var(--gopher-tan);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background 0.3s ease;
        }
        
        .achievement-item:hover {
            background: rgba(232, 213, 100, 0.2);
        }
        
        .achievement-item.locked {
            opacity: 0.5;
            filter: grayscale(0.8);
        }
        
        .achievement-item.unlocked {
            background: rgba(46, 125, 50, 0.1);
        }
        
        .achievement-item.new {
            animation: achievementGlow 2s ease-in-out infinite;
        }
        
        @keyframes achievementGlow {
            0%, 100% { box-shadow: inset 0 0 0 0 rgba(232, 213, 100, 0); }
            50% { box-shadow: inset 0 0 20px 5px rgba(232, 213, 100, 0.3); }
        }
        
        .achievement-icon {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--paper-aged);
            border-radius: 50%;
            border: 2px solid var(--dirt-brown);
            flex-shrink: 0;
        }
        
        .achievement-item.unlocked .achievement-icon {
            background: var(--grass-yellow);
            border-color: var(--bushwood-green);
        }
        
        .achievement-info h4 {
            font-family: var(--font-display);
            font-size: 0.9rem;
            color: var(--bushwood-dark);
            margin-bottom: 3px;
        }
        
        .achievement-info p {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-family: var(--font-handwritten);
        }
        
        .achievement-item.unlocked .achievement-info h4 {
            color: var(--bushwood-green);
        }
        
        .achievements-stats {
            padding: 15px 20px;
            background: var(--bushwood-dark);
            color: var(--gopher-light);
            display: flex;
            justify-content: space-around;
            font-family: var(--font-handwritten);
            font-size: 0.85rem;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--grass-yellow);
        }
        
        body.serious-mode .achievements-panel,
        body.serious-mode .achievements-toggle {
            display: none;
        }
        
        /* Watchlist toggle button */
        .watchlist-toggle {
            position: fixed;
            top: 150px;
            right: 0;
            background: var(--explosives-red);
            color: white;
            font-size: 1.5rem;
            padding: 15px 10px;
            border: 3px solid var(--dirt-brown);
            border-right: none;
            border-radius: var(--radius-md) 0 0 var(--radius-md);
            cursor: pointer;
            z-index: 901;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }
        
        .watchlist-toggle:hover {
            background: var(--grass-yellow);
            color: var(--bushwood-dark);
            transform: translateX(-5px);
        }
        
        .watchlist-toggle .badge-count {
            position: absolute;
            top: -5px;
            left: -5px;
            background: var(--bushwood-dark);
            color: white;
            font-size: 0.7rem;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-body);
            font-weight: bold;
        }
        
        /* Watchlist panel */
        .watchlist-panel {
            position: fixed;
            top: 80px;
            left: -320px;
            width: 300px;
            max-height: calc(100vh - 100px);
            background: linear-gradient(135deg, #1a1208 0%, #2a1f0f 100%);
            border: 3px solid var(--explosives-red);
            border-left: none;
            border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
            box-shadow: var(--shadow-lg);
            z-index: 900;
            transition: left 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            overflow-y: auto;
        }
        
        .watchlist-panel.open {
            left: 0;
        }
        
        .watchlist-header {
            background: var(--explosives-red);
            color: white;
            padding: 15px 20px;
            font-family: var(--font-display);
            font-size: 1rem;
            letter-spacing: 1px;
            text-align: center;
            position: sticky;
            top: 0;
        }
        
        .watchlist-empty {
            padding: 30px 20px;
            text-align: center;
            color: var(--gopher-light);
            font-family: var(--font-handwritten);
        }
        
        .watchlist-items {
            padding: 10px;
        }
        
        .watchlist-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            padding: 12px 15px;
            margin-bottom: 10px;
            border-left: 3px solid var(--grass-yellow);
        }
        
        .watchlist-item .item-name {
            font-family: var(--font-display);
            color: var(--grass-yellow);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .watchlist-item .item-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--gopher-light);
        }
        
        .watchlist-item .item-score {
            font-weight: bold;
            color: var(--explosives-red);
        }
        
        .watchlist-item .item-date {
            opacity: 0.7;
        }
        
        .watchlist-item .item-remove {
            background: transparent;
            border: none;
            color: var(--explosives-red);
            cursor: pointer;
            padding: 2px 5px;
            font-size: 0.9rem;
            opacity: 0.7;
            transition: opacity 0.3s;
        }
        
        .watchlist-item .item-remove:hover {
            opacity: 1;
        }
        
        .watchlist-clear {
            display: block;
            width: calc(100% - 20px);
            margin: 10px;
            padding: 10px;
            background: transparent;
            border: 1px dashed var(--explosives-red);
            color: var(--explosives-red);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-family: var(--font-display);
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }
        
        .watchlist-clear:hover {
            background: var(--explosives-red);
            color: white;
        }
        
        .watchlist-actions {
            display: flex;
            gap: 8px;
            padding: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .watchlist-export,
        .watchlist-import {
            flex: 1;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-family: var(--font-display);
            font-size: 0.75rem;
            transition: all 0.2s ease;
        }
        
        .watchlist-export:hover,
        .watchlist-import:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        
        body.serious-mode .watchlist-toggle,
        body.serious-mode .watchlist-panel {
            display: none;
        }
        
        /* History toggle button */
        .history-toggle {
            position: fixed;
            bottom: 270px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6a5acd 0%, #483d8b 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .history-toggle:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }
        
        .history-toggle .badge-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--grass-yellow);
            color: var(--bushwood-dark);
            font-size: 0.65rem;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }
        
        /* History panel */
        .history-panel {
            position: fixed;
            right: -320px;
            top: 50%;
            transform: translateY(-50%);
            width: 300px;
            max-height: 70vh;
            background: linear-gradient(180deg, #2d2d3d 0%, #1a1a2e 100%);
            border-radius: var(--radius-lg) 0 0 var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 999;
            transition: right 0.3s ease;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .history-panel.open {
            right: 0;
        }
        
        .history-header {
            background: linear-gradient(135deg, #6a5acd 0%, #483d8b 100%);
            color: white;
            padding: 15px;
            font-family: var(--font-display);
            font-weight: bold;
            text-align: center;
            letter-spacing: 1px;
        }
        
        .history-empty {
            padding: 40px 20px;
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
        }
        
        .history-items {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            max-height: 400px;
        }
        
        .history-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            padding: 12px;
            margin-bottom: 8px;
            border-left: 3px solid #6a5acd;
            transition: all 0.2s ease;
        }
        
        .history-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(-3px);
        }
        
        .history-item .item-name {
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .history-item .item-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .history-item .item-flags {
            opacity: 0.7;
        }
        
        .history-clear {
            display: block;
            width: calc(100% - 20px);
            margin: 10px;
            padding: 10px;
            background: transparent;
            border: 1px dashed rgba(106, 90, 205, 0.5);
            color: rgba(106, 90, 205, 0.8);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-family: var(--font-display);
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }
        
        .history-clear:hover {
            background: #6a5acd;
            color: white;
            border-color: #6a5acd;
        }
        
        body.serious-mode .history-toggle,
        body.serious-mode .history-panel {
            display: none;
        }
        
        /* Stats toggle button */
        .stats-toggle {
            position: fixed;
            bottom: 330px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #20b2aa 0%, #008b8b 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .stats-toggle:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }
        
        /* Stats panel */
        .stats-panel {
            position: fixed;
            bottom: -400px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 500px;
            background: linear-gradient(180deg, #1a2a3a 0%, #0d1a26 100%);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            box-shadow: 0 -5px 30px rgba(0, 0, 0, 0.5);
            z-index: 999;
            transition: bottom 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            overflow: hidden;
            padding-bottom: 20px;
        }
        
        .stats-panel.open {
            bottom: 0;
        }
        
        .stats-header {
            background: linear-gradient(135deg, #20b2aa 0%, #008b8b 100%);
            color: white;
            padding: 15px;
            font-family: var(--font-display);
            font-weight: bold;
            text-align: center;
            letter-spacing: 1px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 20px;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            padding: 15px 10px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
        }
        
        .stat-box:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .stat-box.severe {
            border-color: var(--explosives-red);
            background: rgba(201, 76, 76, 0.1);
        }
        
        .stat-box.clean {
            border-color: var(--fairway-green);
            background: rgba(46, 139, 87, 0.1);
        }
        
        .stat-box .stat-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .stat-box .stat-number {
            font-family: var(--font-display);
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
        }
        
        .stat-box .stat-label {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stats-chart {
            padding: 0 20px 10px;
        }
        
        .chart-title {
            font-family: var(--font-display);
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 10px;
            text-align: center;
        }
        
        .chart-bars {
            display: flex;
            gap: 8px;
            align-items: flex-end;
            height: 80px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--radius-sm);
        }
        
        .chart-bar {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .chart-bar .bar {
            width: 100%;
            min-height: 5px;
            border-radius: 3px 3px 0 0;
            transition: height 0.5s ease;
        }
        
        .chart-bar .bar-label {
            font-size: 0.6rem;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
        }
        
        .chart-bar .bar-count {
            font-size: 0.7rem;
            color: white;
            font-weight: bold;
        }
        
        body.serious-mode .stats-toggle,
        body.serious-mode .stats-panel {
            display: none;
        }

        /* Achievement unlock notification */
        .achievement-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: linear-gradient(135deg, var(--grass-yellow) 0%, #ffd54f 100%);
            padding: 15px 30px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg), 0 0 30px rgba(232, 213, 100, 0.5);
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .achievement-notification.show {
            transform: translateX(-50%) translateY(0);
        }
        
        .achievement-notification .unlock-icon {
            font-size: 2.5rem;
            animation: trophySpin 0.5s ease-out;
        }
        
        @keyframes trophySpin {
            0% { transform: rotateY(0deg) scale(0); }
            50% { transform: rotateY(180deg) scale(1.2); }
            100% { transform: rotateY(360deg) scale(1); }
        }
        
        .achievement-notification .unlock-text {
            font-family: var(--font-display);
            color: var(--bushwood-dark);
        }
        
        .achievement-notification .unlock-text h4 {
            font-size: 1rem;
            margin-bottom: 3px;
        }
        
        .achievement-notification .unlock-text p {
            font-size: 0.85rem;
            font-family: var(--font-handwritten);
            opacity: 0.8;
        }
        
        /* ============================================
           üéâ CELEBRATION EFFECTS - Confetti & Particles
           ============================================ */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confettiFall 3s ease-out forwards;
        }
        
        @keyframes confettiFall {
            0% {
                transform: translateY(-10px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* Golf ball particles */
        .golf-ball-particle {
            position: fixed;
            font-size: 1.5rem;
            pointer-events: none;
            z-index: 9998;
            animation: golfBallBounce 2s ease-out forwards;
        }
        
        @keyframes golfBallBounce {
            0% {
                transform: translateY(0) scale(0);
                opacity: 0;
            }
            10% {
                transform: translateY(-20px) scale(1);
                opacity: 1;
            }
            30% {
                transform: translateY(-50px) scale(1);
            }
            50% {
                transform: translateY(-20px) scale(1);
            }
            70% {
                transform: translateY(-30px) scale(1);
            }
            100% {
                transform: translateY(100px) scale(0.5);
                opacity: 0;
            }
        }
        
        /* Explosion effect for severe finds */
        .explosion-burst {
            position: fixed;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(211, 47, 47, 1) 0%, rgba(255, 152, 0, 0.8) 40%, transparent 70%);
            transform: translate(-50%, -50%) scale(0);
            pointer-events: none;
            z-index: 9997;
            animation: explosionBurst 0.8s ease-out forwards;
        }
        
        @keyframes explosionBurst {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0.8;
            }
            100% {
                transform: translate(-50%, -50%) scale(2);
                opacity: 0;
            }
        }
        
        /* Sparkle effect */
        .sparkle {
            position: fixed;
            width: 6px;
            height: 6px;
            background: var(--grass-yellow);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9996;
            animation: sparkle 0.8s ease-out forwards;
        }
        
        @keyframes sparkle {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: scale(1.5) rotate(180deg);
                opacity: 1;
            }
            100% {
                transform: scale(0) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Screen shake effect */
        @keyframes screenShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .screen-shake {
            animation: screenShake 0.5s ease-in-out;
        }
        
        /* Pulse glow for important elements */
        .pulse-glow {
            animation: pulseGlow 1s ease-in-out infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 5px var(--grass-yellow); }
            50% { box-shadow: 0 0 20px var(--grass-yellow), 0 0 30px rgba(232, 213, 100, 0.5); }
        }
        
        /* Flag wave animation for results */
        .flag-wave {
            animation: flagWave 2s ease-in-out infinite;
            transform-origin: bottom left;
        }
        
        @keyframes flagWave {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }
        
        /* Sound toggle button */
        .sound-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--paper-aged);
            border: 2px solid var(--dirt-brown);
            border-radius: var(--radius-round);
            width: 45px;
            height: 45px;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: var(--shadow-md);
            z-index: 900;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .sound-toggle:hover {
            background: var(--grass-yellow);
            transform: scale(1.1);
        }
        
        .sound-toggle.muted {
            opacity: 0.5;
        }
        
        body.serious-mode .sound-toggle {
            display: none;
        }
        
        /* Help toggle button */
        .help-toggle {
            position: fixed;
            bottom: 20px;
            left: 75px;
            background: var(--bushwood-green);
            border: 2px solid var(--grass-yellow);
            border-radius: var(--radius-round);
            width: 45px;
            height: 45px;
            cursor: pointer;
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--grass-yellow);
            box-shadow: var(--shadow-md);
            z-index: 900;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .help-toggle:hover {
            background: var(--grass-yellow);
            color: var(--bushwood-dark);
            transform: scale(1.1);
        }
        
        body.serious-mode .help-toggle {
            display: none;
        }
        
        /* Shortcuts help overlay */
        .shortcuts-help {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 15000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .shortcuts-help.active {
            display: flex;
        }
        
        .shortcuts-content {
            background: linear-gradient(135deg, var(--paper-cream) 0%, var(--paper-aged) 100%);
            padding: 30px;
            border-radius: var(--radius-lg);
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            border: 3px solid var(--dirt-brown);
        }
        
        .shortcuts-content h3 {
            text-align: center;
            font-family: var(--font-display);
            color: var(--bushwood-dark);
            margin-bottom: 20px;
            font-size: 1.2rem;
        }
        
        .shortcuts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .shortcut-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .shortcut-item kbd {
            background: var(--bushwood-dark);
            color: var(--grass-yellow);
            padding: 5px 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.8rem;
            display: inline-block;
            width: fit-content;
        }
        
        .shortcut-item span {
            font-family: var(--font-handwritten);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .shortcuts-close {
            display: block;
            width: 100%;
            margin-top: 20px;
            padding: 12px;
            background: var(--bushwood-green);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-family: var(--font-display);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .shortcuts-close:hover {
            background: var(--grass-yellow);
            color: var(--bushwood-dark);
        }
        
        @media (max-width: 500px) {
            .shortcuts-grid {
                grid-template-columns: 1fr;
            }
            
            .help-toggle {
                left: auto;
                right: 10px;
                bottom: 130px;
            }
        }

        /* ============================================
           ü¶∂ FOOTER - Muddy Footprints
           ============================================ */
        footer {
            text-align: center;
            padding: 35px 20px;
            color: var(--gopher-light);
            font-size: 0.9rem;
            background: linear-gradient(180deg, var(--bushwood-dark) 0%, #0a0f0a 100%);
            margin-top: 40px;
            position: relative;
            overflow: hidden;
        }
        
        footer::before {
            content: 'üêæ';
            position: absolute;
            left: 20%;
            top: 50%;
            transform: translateY(-50%) rotate(-15deg);
            font-size: 3rem;
            opacity: 0.1;
        }
        
        footer::after {
            content: '‚õ≥';
            position: absolute;
            right: 20%;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2rem;
            opacity: 0.15;
        }
        
        footer a {
            color: var(--grass-yellow);
            text-decoration: none;
            border-bottom: 1px dashed var(--grass-yellow);
        }
        
        footer a:hover {
            color: white;
        }
        
        .footer-quote {
            font-family: var(--font-handwritten);
            font-size: 0.85rem;
            opacity: 0.7;
            margin-top: 10px;
        }
        
        body.serious-mode footer {
            background: #37474f;
        }
        
        body.serious-mode footer::before,
        body.serious-mode footer::after {
            display: none;
        }
        
        body.serious-mode .footer-quote {
            display: none;
        }
        
        /* ============================================
           üîÑ MODE TOGGLE - Gopher vs Briefcase
           ============================================ */
        .mode-toggle {
            position: absolute;
            top: 12px;
            right: 15px;
            background: linear-gradient(180deg, var(--grass-yellow) 0%, #c9b84d 100%);
            border: 2px solid var(--dirt-dark);
            border-radius: 20px;
            padding: 6px 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: var(--font-handwritten);
            font-weight: 600;
            font-size: 0.8rem;
            color: var(--bushwood-dark);
            box-shadow: 2px 2px 0 var(--dirt-dark);
            transition: all 0.2s ease;
            z-index: 10;
        }
        
        .mode-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 3px 3px 0 var(--dirt-dark);
        }
        
        .mode-toggle:active {
            transform: translateY(1px);
            box-shadow: 1px 1px 0 var(--dirt-dark);
        }
        
        .mode-icon {
            font-size: 1.1rem;
            transition: transform 0.3s ease;
        }
        
        .mode-toggle:hover .mode-icon {
            animation: wiggle 0.5s ease-in-out;
        }
        
        @keyframes wiggle {
            0%, 100% { transform: rotate(0); }
            25% { transform: rotate(-15deg); }
            75% { transform: rotate(15deg); }
        }
        
        body.serious-mode .mode-toggle {
            background: #eceff1;
            border-color: #b0bec5;
            color: #37474f;
            font-family: var(--font-body);
            box-shadow: var(--shadow-sm);
        }
        
        body.serious-mode .mode-icon {
            font-size: 1rem;
        }
        
        .header-content {
            position: relative;
        }

        @media (max-width: 768px) {
            .mode-toggle {
                position: static;
                margin-top: 15px;
            }
            
            .tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .tab {
                white-space: nowrap;
                min-width: 120px;
            }
            
            header h1 {
                font-size: 1.4rem;
            }
            
            header h1::before,
            header h1::after {
                display: none;
            }
            
            header p {
                font-size: 0.9rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .container {
                padding: 10px;
            }
            
            .form-section {
                padding: 15px;
            }
            
            .result-card {
                padding: 15px;
            }
        }
        
        /* ============================================
           üì± MOBILE CADDY MODE - Touch-First Experience
           ============================================ */
        
        @media (max-width: 600px) {
            /* Larger touch targets */
            input, select, button {
                min-height: 48px;
                font-size: 16px; /* Prevents zoom on iOS */
            }
            
            /* Full-width inputs */
            .form-group input,
            .form-group select {
                width: 100%;
                padding: 14px;
            }
            
            /* Stack score entries vertically */
            .score-entry {
                flex-direction: column;
                gap: 10px;
            }
            
            .score-entry input {
                width: 100%;
            }
            
            /* Simpler suspicion gauge */
            .suspicion-gauge {
                width: 100%;
                height: 30px;
            }
            
            /* Gopher repositioning */
            .gopher-popup {
                bottom: 60px;
                right: 10px;
                width: 2.5rem;
                height: 2.5rem;
            }
            
            .gopher-speech {
                bottom: 120px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
            
            /* Achievement panel full-width */
            .achievements-panel {
                width: 100%;
                right: -100%;
                border-radius: 0;
            }
            
            .achievements-toggle {
                top: auto;
                bottom: 70px;
                right: 10px;
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
            
            /* Sound toggle repositioning */
            .sound-toggle {
                bottom: 70px;
                left: 10px;
            }
            
            /* Stack the Caddyshack feature toggles vertically on mobile */
            .watchlist-toggle,
            .history-toggle,
            .stats-toggle {
                right: 10px;
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
            
            .watchlist-toggle {
                bottom: 120px;
            }
            
            .history-toggle {
                bottom: 170px;
            }
            
            .stats-toggle {
                bottom: 220px;
            }
            
            /* Make panels full-width on mobile */
            .watchlist-panel,
            .history-panel {
                width: 100%;
                right: -100%;
                border-radius: 0;
            }
            
            .stats-panel {
                width: 95%;
                max-width: none;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                padding: 15px;
            }
            
            .stat-box .stat-number {
                font-size: 1.4rem;
            }
            
            /* Simplified header */
            header {
                padding: 15px;
            }
            
            header h1 {
                font-size: 1.2rem;
            }
            
            header p,
            .header-tagline {
                font-size: 0.8rem;
            }
            
            .header-tagline {
                display: none;
            }
            
            /* Compact tabs */
            .tabs {
                gap: 5px;
                padding: 5px;
            }
            
            .tab {
                padding: 10px 12px;
                font-size: 0.75rem;
                min-width: 80px;
            }
            
            /* Hide emoji decorations on small screens */
            .tab::before {
                display: none;
            }
            
            /* Simplified result cards */
            .risk-card {
                flex-direction: column;
                text-align: center;
            }
            
            .risk-score-circle {
                margin: 0 auto 15px;
            }
            
            /* Compact flags display */
            .red-flags-section {
                padding: 10px;
            }
            
            .red-flag-item {
                padding: 10px;
            }
            
            /* Splash screen mobile */
            .splash-logo {
                font-size: 1.3rem;
                padding: 0 20px;
            }
            
            .splash-tagline {
                font-size: 0.9rem;
                padding: 0 20px;
            }
            
            .splash-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .splash-buttons button {
                width: 80%;
            }
            
            /* WANTED poster mobile */
            .wanted-poster {
                padding: 15px;
            }
            
            .wanted-poster::before {
                font-size: 1rem;
            }
            
            /* Footer compact */
            footer {
                padding: 20px 10px;
            }
            
            .footer-quote {
                font-size: 0.85rem;
            }
            
            /* Hide grass texture on mobile for performance */
            .grass-overlay {
                display: none;
            }
            
            /* Larger form labels */
            .form-group label {
                font-size: 0.95rem;
                margin-bottom: 8px;
            }
            
            /* Action buttons stack */
            .verdict-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .verdict-actions button {
                width: 100%;
            }
            
            /* Narration box mobile */
            .narration-box {
                padding: 15px;
                font-size: 0.9rem;
            }
            
            .narration-box::before {
                font-size: 1.5rem;
            }
        }
        
        /* Extra small phones */
        @media (max-width: 380px) {
            header h1 {
                font-size: 1rem;
            }
            
            .tab {
                padding: 8px 10px;
                font-size: 0.7rem;
                min-width: 65px;
            }
            
            .splash-logo {
                font-size: 1.1rem;
            }
            
            .form-section h3 {
                font-size: 1rem;
            }
            
            .mode-toggle {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
            
            .gopher-popup {
                width: 2rem;
                height: 2rem;
            }
        }
        
        /* Landscape mobile */
        @media (max-width: 900px) and (orientation: landscape) {
            header {
                padding: 10px 15px;
            }
            
            header h1 {
                font-size: 1.1rem;
            }
            
            .splash-screen {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                padding: 10px;
            }
            
            .splash-logo,
            .splash-tagline {
                width: 100%;
                text-align: center;
            }
            
            .gopher-popup {
                bottom: 10px;
            }
            
            .gopher-speech {
                bottom: 70px;
            }
        }
        
        /* Touch-friendly enhancements */
        @media (pointer: coarse) {
            /* Larger tap targets for touch devices */
            button, .tab, a {
                min-height: 44px;
            }
            
            /* Remove hover effects that don't work on touch */
            .tab:hover::after {
                display: none;
            }
            
            /* Better scroll indicators */
            .tabs {
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            
            .tabs::-webkit-scrollbar {
                display: none;
            }
            
            /* Add momentum scrolling */
            .tabs,
            .achievements-panel {
                -webkit-overflow-scrolling: touch;
            }
        }
        
        /* ============================================
           üÜï FIRST-TIME USER WELCOME MODAL
           ============================================ */
        .welcome-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 100000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .welcome-modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .welcome-content {
            background: linear-gradient(180deg, #1a2b1c 0%, #0f1a10 100%);
            border: 3px solid var(--grass-yellow);
            border-radius: var(--radius-lg);
            max-width: 500px;
            width: 100%;
            padding: 30px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .welcome-modal.show .welcome-content {
            transform: scale(1);
        }
        
        .welcome-title {
            font-family: var(--font-display);
            font-size: 1.8rem;
            color: var(--grass-yellow);
            margin-bottom: 10px;
        }
        
        .welcome-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.95rem;
            margin-bottom: 25px;
        }
        
        .welcome-steps {
            text-align: left;
            margin: 20px 0;
        }
        
        .welcome-step {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            border-left: 3px solid var(--grass-yellow);
        }
        
        .welcome-step-num {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--grass-yellow);
            min-width: 30px;
        }
        
        .welcome-step-text {
            color: white;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .welcome-step-text strong {
            color: var(--grass-yellow);
        }
        
        .welcome-buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }
        
        .welcome-btn {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: var(--radius-md);
            font-family: var(--font-display);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .welcome-btn-primary {
            background: var(--grass-yellow);
            color: var(--bushwood-dark);
        }
        
        .welcome-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(232, 213, 100, 0.4);
        }
        
        .welcome-btn-secondary {
            background: transparent;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .welcome-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .welcome-skip {
            margin-top: 15px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
            cursor: pointer;
        }
        
        .welcome-skip:hover {
            color: rgba(255, 255, 255, 0.8);
        }
        
        /* Quick Check Banner for Suspects tab */
        .quick-check-banner {
            background: linear-gradient(135deg, #2d5a2e 0%, #1a3d1b 100%);
            border: 2px solid var(--grass-yellow);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .quick-check-title {
            font-family: var(--font-display);
            font-size: 1.3rem;
            color: var(--grass-yellow);
            margin-bottom: 8px;
        }
        
        .quick-check-subtitle {
            color: rgba(255, 255, 255, 0.85);
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        /* Form Help Tooltips */
        .form-group {
            position: relative;
        }
        
        .form-help {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: var(--grass-yellow);
            color: var(--bushwood-dark);
            border-radius: 50%;
            font-size: 10px;
            font-weight: bold;
            text-align: center;
            line-height: 16px;
            margin-left: 5px;
            cursor: help;
            vertical-align: middle;
        }
        
        .form-help:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bushwood-dark);
            color: white;
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: normal;
            white-space: nowrap;
            max-width: 250px;
            white-space: normal;
            z-index: 1000;
            box-shadow: var(--shadow-md);
        }
        
        /* Check Another Player Button */
        .check-another-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background: linear-gradient(135deg, var(--fairway-green) 0%, #1a4d1e 100%);
            border: 2px solid var(--grass-yellow);
            border-radius: var(--radius-md);
            color: white;
            font-family: var(--font-display);
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .check-another-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(232, 213, 100, 0.3);
        }
        
        /* Results Quick Summary Card */
        .results-quick-summary {
            background: linear-gradient(135deg, #1a2a1c 0%, #0f1a10 100%);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid;
            text-align: center;
        }
        
        .results-quick-summary.verdict-clean {
            border-color: var(--fairway-green);
        }
        
        .results-quick-summary.verdict-suspicious {
            border-color: var(--grass-yellow);
        }
        
        .results-quick-summary.verdict-likely {
            border-color: var(--explosives-red);
        }
        
        .summary-verdict {
            font-family: var(--font-display);
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        
        .verdict-clean .summary-verdict { color: var(--fairway-green); }
        .verdict-suspicious .summary-verdict { color: var(--grass-yellow); }
        .verdict-likely .summary-verdict { color: var(--explosives-red); }
        
        .summary-explanation {
            color: rgba(255, 255, 255, 0.85);
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .summary-score {
            font-size: 3rem;
            font-weight: bold;
            margin: 15px 0;
        }
        
        .verdict-clean .summary-score { color: var(--fairway-green); }
        .verdict-suspicious .summary-score { color: var(--grass-yellow); }
        .verdict-likely .summary-score { color: var(--explosives-red); }
        
        /* Mobile optimizations for welcome modal */
        @media (max-width: 600px) {
            .welcome-content {
                padding: 20px;
            }
            
            .welcome-title {
                font-size: 1.4rem;
            }
            
            .welcome-buttons {
                flex-direction: column;
            }
            
            .welcome-step {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- üß® SPLASH SCREEN - "Licensed to Kill... Handicaps" -->
    <div class="splash-screen" id="splash-screen">
        <div class="splash-explosion">üí•</div>
        <div class="splash-explosion">üí•</div>
        <div class="splash-explosion">üí•</div>
        <div class="splash-silhouette"><img src="/static/images/carl.jpg" alt="Carl Spackler"></div>
        <div class="splash-logo">SPACKLER'S HANDICAP TRACKER</div>
        <div class="splash-tagline">
            "A looper... you know, a caddy... tracking sandbaggers since 1980."
        </div>
        <div class="splash-buttons">
            <button class="btn-dynamite" onclick="enterApp()">ENTER THE LAIR</button>
            <button class="btn-clipboard" onclick="enterApp()">View Tournament Reports</button>
        </div>
    </div>
    
    <!-- üÜï FIRST-TIME USER WELCOME MODAL -->
    <div class="welcome-modal" id="welcomeModal">
        <div class="welcome-content">
            <div class="welcome-title">üèåÔ∏è Member-Guest? Check Your Opponents!</div>
            <div class="welcome-subtitle">
                Quickly analyze if the other team's handicaps seem legit.
            </div>
            
            <div class="welcome-steps">
                <div class="welcome-step">
                    <div class="welcome-step-num">1</div>
                    <div class="welcome-step-text">
                        <strong>Enter their handicap</strong> - Ask or check the tournament sheet
                    </div>
                </div>
                <div class="welcome-step">
                    <div class="welcome-step-num">2</div>
                    <div class="welcome-step-text">
                        <strong>Add their tournament scores</strong> - What did they shoot today and in past events?
                    </div>
                </div>
                <div class="welcome-step">
                    <div class="welcome-step-num">3</div>
                    <div class="welcome-step-text">
                        <strong>Get the verdict</strong> - We'll flag suspicious patterns instantly
                    </div>
                </div>
            </div>
            
            <div class="welcome-buttons">
                <button class="welcome-btn welcome-btn-primary" onclick="startQuickCheck()">
                    üîç Quick Check Now
                </button>
            </div>
            <div class="welcome-skip" onclick="dismissWelcome()">
                I know how this works, skip intro
            </div>
        </div>
    </div>
    
    <!-- GOPHER COMMAND CENTER - The Real Star -->
    <div class="gopher-hole" id="gopher-hole"></div>
    <div class="gopher-dirt" id="gopher-dirt"></div>
    <div class="gopher-popup" id="gopher-popup"><img src="/static/images/gopher.svg" alt="Gopher"></div>
    <div class="gopher-speech" id="gopher-speech"></div>

    <header>
        <div class="header-content">
            <h1>Spackler's Handicap Checker</h1>
            <p>Quick Sandbagger Detection for Tournaments & Member-Guests</p>
            <p class="header-tagline caddyshack-only">"Cinderella story... out of nowhere... a former greenskeeper now tracking cheaters at Augusta."</p>
        </div>
        <button class="mode-toggle" id="mode-toggle" onclick="toggleMode()" title="Switch between Caddyshack and Serious mode">
            <span class="mode-icon"><img src="/static/images/gopher.svg" alt="" class="gopher-icon"></span>
            <span class="mode-text">Gopher Mode</span>
        </button>
    </header>

    <div class="container">
        <!-- Carl's Tip Banner -->
        <div class="carl-tip caddyshack-only" id="carl-tip">
            <span class="tip-icon">üí°</span>
            <span class="tip-text" id="carl-tip-text">Loading wisdom from the Himalayas...</span>
            <button class="tip-refresh" onclick="refreshCarlTip()" title="Get new tip">üîÑ</button>
        </div>
        
        <div class="tabs">
            <button class="tab" onclick="showTab('individual')">Single Round</button>
            <button class="tab" onclick="showTab('team')">Team Best-Ball</button>
            <button class="tab" onclick="showTab('consecutive')">Hot Streak Check</button>
            <button class="tab" onclick="showTab('completed')">Score Analysis</button>
            <button class="tab active" onclick="showTab('sandbagging')" id="suspectsTab">üîç Check Opponent</button>
        </div>

        <!-- Individual Player Tab -->
        <div id="individual-tab" class="tab-content">
            <form id="individual-form">
                <div class="form-section">
                    <h3>Golfer Intel</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="handicap">Handicap Index</label>
                            <input type="number" id="handicap" step="0.1" value="15.0" min="-10" max="54" required>
                        </div>
                        <div class="form-group">
                            <label for="target-score">Target Score</label>
                            <input type="number" id="target-score" value="85" min="25" max="150" required>
                        </div>
                        <div class="form-group">
                            <label for="individual-holes-played">Holes Played</label>
                            <select id="individual-holes-played" required>
                                <option value="18" selected>18 Holes</option>
                                <option value="9">9 Holes</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>The Battlefield</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="course-name">Course Name</label>
                            <input type="text" id="course-name" value="Bushwood Country Club" required>
                        </div>
                        <div class="form-group">
                            <label for="tee-name">Tee</label>
                            <input type="text" id="tee-name" value="White" required>
                        </div>
                        <div class="form-group">
                            <label for="par">Par</label>
                            <input type="number" id="par" value="72" min="27" max="80" required>
                        </div>
                        <div class="form-group">
                            <label for="course-rating">Course Rating</label>
                            <input type="number" id="course-rating" step="0.1" value="72.5" min="55" max="85" required>
                        </div>
                        <div class="form-group">
                            <label for="slope-rating">Slope Rating</label>
                            <input type="number" id="slope-rating" value="130" min="55" max="155" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Mission Parameters</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="individual-holes-played">Holes Per Round</label>
                            <select id="individual-holes-played" required>
                                <option value="18" selected>18 Holes</option>
                                <option value="9">9 Holes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="num-rounds">Number of Rounds</label>
                            <input type="number" id="num-rounds" value="3" min="1" max="10" required>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" id="individual-submit-btn">Calculate Probabilities</button>
            </form>

            <div class="loading" id="individual-loading">
                <div class="spinner"></div>
                <p>Calculating...</p>
            </div>

            <div class="results-section" id="individual-results" style="display: none;">
                <h3>üìä Results</h3>
                
                <div class="result-card" id="single-round-result">
                    <div class="result-header">
                        <h4>Single Round Probability</h4>
                        <span class="probability-badge" id="single-prob">--</span>
                    </div>
                    <div class="result-details">
                        <div class="detail-item">
                            <div class="label">Expected Score</div>
                            <div class="value" id="expected-score">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Std Deviation</div>
                            <div class="value" id="score-std">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Target Score</div>
                            <div class="value" id="target-display">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Z-Score</div>
                            <div class="value" id="z-score">--</div>
                        </div>
                    </div>
                </div>

                <div class="result-card" id="multi-round-result">
                    <div class="result-header">
                        <h4>Multi-Round Probabilities</h4>
                        <span class="probability-badge" id="multi-prob">--</span>
                    </div>
                    <div class="result-details">
                        <div class="detail-item">
                            <div class="label">At Least Once</div>
                            <div class="value" id="prob-at-least-once">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Rounds</div>
                            <div class="value" id="num-rounds-display">--</div>
                        </div>
                    </div>
                </div>

                <div class="result-card" id="milestones-result">
                    <h4 style="margin-bottom: 15px;">Milestone Probabilities</h4>
                    <table class="milestones-table">
                        <thead>
                            <tr>
                                <th>Target Score</th>
                                <th>Single Round</th>
                                <th>At Least Once</th>
                            </tr>
                        </thead>
                        <tbody id="milestones-body">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="error-message" id="individual-error" style="display: none;"></div>
        </div>

        <!-- Team / Member-Guest Tab -->
        <div id="team-tab" class="tab-content">
            <form id="team-form">
                <div class="form-section">
                    <div class="team-player-section">
                        <h4>üë§ Player 1 (Member)</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="p1-handicap">Handicap Index</label>
                                <input type="number" id="p1-handicap" step="0.1" value="12.0" min="-10" max="54" required>
                            </div>
                        </div>
                    </div>

                    <div class="team-player-section">
                        <h4>üë§ Player 2 (Guest)</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="p2-handicap">Handicap Index</label>
                                <input type="number" id="p2-handicap" step="0.1" value="8.0" min="-10" max="54" required>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>‚õ≥ Course Information</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="team-course-name">Course Name</label>
                            <input type="text" id="team-course-name" value="Member-Guest Venue" required>
                        </div>
                        <div class="form-group">
                            <label for="team-tee-name">Tee</label>
                            <input type="text" id="team-tee-name" value="Blue" required>
                        </div>
                        <div class="form-group">
                            <label for="team-par">Par</label>
                            <input type="number" id="team-par" value="72" min="27" max="80" required>
                        </div>
                        <div class="form-group">
                            <label for="team-course-rating">Course Rating</label>
                            <input type="number" id="team-course-rating" step="0.1" value="73.5" min="55" max="85" required>
                        </div>
                        <div class="form-group">
                            <label for="team-slope-rating">Slope Rating</label>
                            <input type="number" id="team-slope-rating" value="135" min="55" max="155" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üéØ Best-Ball Target</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="target-net-score">Target Net Best-Ball Score</label>
                            <input type="number" id="target-net-score" value="63" min="40" max="100" required>
                        </div>
                        <div class="form-group">
                            <label for="handicap-allowance">Handicap Allowance %</label>
                            <input type="number" id="handicap-allowance" value="100" min="0" max="100" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üèÜ Event Structure</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="team-num-rounds">Number of Rounds</label>
                            <input type="number" id="team-num-rounds" value="3" min="1" max="10" required>
                        </div>
                        <div class="form-group">
                            <label for="min-success-rounds">Min Success Rounds</label>
                            <input type="number" id="min-success-rounds" value="1" min="1" max="10" required>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Calculate Team Probabilities</button>
            </form>

            <div class="loading" id="team-loading">
                <div class="spinner"></div>
                <p>Running simulation...</p>
            </div>

            <div class="results-section" id="team-results" style="display: none;">
                <h3>üìä Team Best-Ball Results</h3>
                
                <div class="result-card">
                    <div class="result-header">
                        <h4>Single Round Best-Ball</h4>
                        <span class="probability-badge" id="team-single-prob">--</span>
                    </div>
                    <div class="result-details">
                        <div class="detail-item">
                            <div class="label">Expected Net Best-Ball</div>
                            <div class="value" id="team-expected-bb">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Std Deviation</div>
                            <div class="value" id="team-std-bb">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Target Net Score</div>
                            <div class="value" id="team-target-display">--</div>
                        </div>
                    </div>
                </div>

                <div class="result-card">
                    <div class="result-header">
                        <h4>Multi-Round Probabilities</h4>
                        <span class="probability-badge" id="team-multi-prob">--</span>
                    </div>
                    <div class="result-details">
                        <div class="detail-item">
                            <div class="label">At Least Once</div>
                            <div class="value" id="team-prob-at-least-once">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">At Least N Rounds</div>
                            <div class="value" id="team-prob-at-least-n">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Simulations</div>
                            <div class="value" id="team-simulations">--</div>
                        </div>
                    </div>
                </div>

                <div class="summary-text" id="team-summary">
                </div>
            </div>

            <div class="error-message" id="team-error" style="display: none;"></div>
        </div>

        <!-- Consecutive Scores Tab -->
        <div id="consecutive-tab" class="tab-content">
            <form id="consecutive-form">
                <div class="form-section">
                    <h3>üë§ Golfer Information</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="cons-handicap">Handicap Index</label>
                            <input type="number" id="cons-handicap" step="0.1" value="15.0" min="-10" max="54" required>
                        </div>
                        <div class="form-group">
                            <label for="cons-target-score">Target Score</label>
                            <input type="number" id="cons-target-score" value="42" min="25" max="100" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>‚õ≥ Course Information</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="cons-course-name">Course Name</label>
                            <input type="text" id="cons-course-name" value="My Local Course" required>
                        </div>
                        <div class="form-group">
                            <label for="cons-tee-name">Tee</label>
                            <input type="text" id="cons-tee-name" value="White" required>
                        </div>
                        <div class="form-group">
                            <label for="cons-par">Par (Full 18)</label>
                            <input type="number" id="cons-par" value="72" min="27" max="80" required>
                        </div>
                        <div class="form-group">
                            <label for="cons-course-rating">Course Rating (Full 18)</label>
                            <input type="number" id="cons-course-rating" step="0.1" value="72.5" min="55" max="85" required>
                        </div>
                        <div class="form-group">
                            <label for="cons-slope-rating">Slope Rating</label>
                            <input type="number" id="cons-slope-rating" value="130" min="55" max="155" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üéØ Match Configuration</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="holes-per-round">Holes Per Round</label>
                            <select id="holes-per-round" required>
                                <option value="18">18 Holes</option>
                                <option value="9" selected>9 Holes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="consecutive-count">Consecutive Scores Needed</label>
                            <input type="number" id="consecutive-count" value="3" min="1" max="20" required>
                        </div>
                        <div class="form-group">
                            <label for="total-matches">Total Matches (optional)</label>
                            <input type="number" id="total-matches" value="10" min="1" max="100">
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Calculate Consecutive Probability</button>
            </form>

            <div class="loading" id="consecutive-loading">
                <div class="spinner"></div>
                <p>Calculating...</p>
            </div>

            <div class="results-section" id="consecutive-results" style="display: none;">
                <h3>üìä Consecutive Scores Results</h3>
                
                <div class="result-card">
                    <div class="result-header">
                        <h4>Single Round Probability</h4>
                        <span class="probability-badge" id="cons-single-prob">--</span>
                    </div>
                    <div class="result-details">
                        <div class="detail-item">
                            <div class="label">Expected Score</div>
                            <div class="value" id="cons-expected-score">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Std Deviation</div>
                            <div class="value" id="cons-score-std">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Target Score</div>
                            <div class="value" id="cons-target-display">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Holes</div>
                            <div class="value" id="cons-holes-display">--</div>
                        </div>
                    </div>
                </div>

                <div class="result-card">
                    <div class="result-header">
                        <h4>Consecutive Scores Probability</h4>
                        <span class="probability-badge" id="cons-all-prob">--</span>
                    </div>
                    <div class="result-details">
                        <div class="detail-item">
                            <div class="label">Consecutive Rounds</div>
                            <div class="value" id="cons-count-display">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">P(All Consecutive)</div>
                            <div class="value" id="cons-all-display">--</div>
                        </div>
                        <div class="detail-item" id="streak-container" style="display: none;">
                            <div class="label">P(Streak in Matches)</div>
                            <div class="value" id="cons-streak-display">--</div>
                        </div>
                    </div>
                </div>

                <div class="summary-text" id="consecutive-summary">
                </div>
            </div>

            <div class="error-message" id="consecutive-error" style="display: none;"></div>
        </div>
    </div>

    <!-- Completed Rounds Analysis Tab -->
    <div id="completed-tab" class="tab-content">
        <form id="completed-form">
            <div class="form-section">
                <h3>üë§ Golfer Information</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="comp-name">Golfer Name</label>
                        <input type="text" id="comp-name" value="John Smith" required>
                    </div>
                    <div class="form-group">
                        <label for="comp-handicap">Handicap Index</label>
                        <input type="number" id="comp-handicap" step="0.1" value="15.0" min="-10" max="54" required>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>‚õ≥ Course Information</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="comp-course-name">Course Name</label>
                        <input type="text" id="comp-course-name" value="My Local Course" required>
                    </div>
                    <div class="form-group">
                        <label for="comp-tee-name">Tee</label>
                        <input type="text" id="comp-tee-name" value="White" required>
                    </div>
                    <div class="form-group">
                        <label for="comp-par">Par</label>
                        <input type="number" id="comp-par" value="72" min="27" max="80" required>
                    </div>
                    <div class="form-group">
                        <label for="comp-course-rating">Course Rating</label>
                        <input type="number" id="comp-course-rating" step="0.1" value="72.5" min="50" max="90" required>
                    </div>
                    <div class="form-group">
                        <label for="comp-slope-rating">Slope Rating</label>
                        <input type="number" id="comp-slope-rating" value="130" min="55" max="155" required>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üìä Completed Round Scores</h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;">
                    Enter your actual gross scores from completed rounds. Add as many rounds as you'd like to analyze.
                </p>
                <div id="scores-container">
                    <div class="score-entry" data-round="1">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Round 1 Score</label>
                                <input type="number" class="score-input" min="25" max="200" required>
                            </div>
                            <div class="form-group">
                                <label>Holes Played</label>
                                <select class="holes-input" required>
                                    <option value="18" selected>18 Holes</option>
                                    <option value="9">9 Holes</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Date (Optional)</label>
                                <input type="date" class="date-input">
                            </div>
                            <div class="form-group">
                                <label>Notes (Optional)</label>
                                <input type="text" class="notes-input" placeholder="e.g., Windy day">
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" onclick="addScoreEntry()" class="btn btn-secondary" style="margin-top: 10px; background: var(--text-secondary);">
                    + Add Another Round
                </button>
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                Analyze My Scores
            </button>
        </form>

        <div class="loading-indicator" id="completed-loading">
            <div class="spinner"></div>
            <p>Analyzing completed rounds...</p>
        </div>

        <div id="completed-results" class="results-section" style="display: none;">
            <h3>üìà Score Analysis Results</h3>

            <div class="result-card">
                <div class="result-header">
                    <h4 id="comp-golfer-display">--</h4>
                    <span class="badge" id="comp-rounds-badge">-- rounds</span>
                </div>
                
                <div class="result-details">
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="label">Expected Score</div>
                            <div class="value" id="comp-expected">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Average Actual Score</div>
                            <div class="value" id="comp-average">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Total From Expected</div>
                            <div class="value" id="comp-total-diff">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Overall Probability</div>
                            <div class="value prob-high" id="comp-overall-prob">--</div>
                        </div>
                    </div>
                </div>

                <div class="summary-text" id="completed-overall-summary" style="margin-top: 15px; padding: 15px; background: #f0f7f0; border-radius: 8px;">
                </div>
            </div>

            <div class="result-card">
                <h4>Individual Round Analysis</h4>
                <div id="rounds-analysis-container">
                    <!-- Individual round cards will be inserted here -->
                </div>
            </div>

            <div class="result-card">
                <h4>Performance Highlights</h4>
                <div class="detail-grid">
                    <div class="detail-item">
                        <div class="label">Best Round</div>
                        <div class="value" style="color: var(--success);" id="comp-best-score">--</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Best Probability</div>
                        <div class="value" id="comp-best-prob">--</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Worst Round</div>
                        <div class="value" style="color: var(--error);" id="comp-worst-score">--</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Worst Probability</div>
                        <div class="value" id="comp-worst-prob">--</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="error-message" id="completed-error" style="display: none;"></div>
    </div>

    <!-- Sandbagging Detection Tab -->
    <div id="sandbagging-tab" class="tab-content active">
        <!-- Quick Check Banner for First-Time Users -->
        <div class="quick-check-banner" id="quickCheckBanner">
            <div class="quick-check-title">üèåÔ∏è Quick Opponent Check</div>
            <div class="quick-check-subtitle">
                At a member-guest? Enter your opponent's handicap and their scores from today.<br>
                We'll tell you if something looks fishy in under 30 seconds.
            </div>
        </div>
        
        <div class="clubhouse-banner" id="sand-banner">
            üîç The Sandbagger Watch List üîç
            <div style="font-size: 0.8rem; margin-top: 5px; opacity: 0.9;">
                "License to kill gophers by the government of the United Nations... and to investigate suspicious scorecards."
            </div>
        </div>
        
        <form id="sandbagging-form">
            <div class="form-section">
                <h3>üéØ Golfer Under Review</h3>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 15px;">
                    üí° <strong>Tip:</strong> Check the tournament pairing sheet for handicaps, or just ask!
                </p>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="sand-name">
                            Golfer Name
                            <span class="form-help" data-tooltip="Who are you checking? E.g., 'Bob Smith' or 'Team 7 Player'">?</span>
                        </label>
                        <input type="text" id="sand-name" placeholder="e.g., Bob Smith" required>
                    </div>
                    <div class="form-group">
                        <label for="sand-handicap">
                            Stated Handicap Index
                            <span class="form-help" data-tooltip="Their official USGA handicap index. Ask them or check the tournament sheet.">?</span>
                        </label>
                        <input type="number" id="sand-handicap" step="0.1" placeholder="e.g., 12.4" min="-10" max="54" required>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>‚õ≥ Course Information</h3>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 15px;">
                    üí° <strong>Tip:</strong> Check the scorecard or ask the pro shop. Default values work for most courses.
                </p>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="sand-course-name">
                            Course Name
                        </label>
                        <input type="text" id="sand-course-name" placeholder="e.g., Pinehurst #2" required>
                    </div>
                    <div class="form-group">
                        <label for="sand-tee-name">Tee Color</label>
                        <input type="text" id="sand-tee-name" value="White" required>
                    </div>
                    <div class="form-group">
                        <label for="sand-par">
                            Par
                            <span class="form-help" data-tooltip="Total par for the course (usually 70-72)">?</span>
                        </label>
                        <input type="number" id="sand-par" value="72" min="27" max="80" required>
                    </div>
                    <div class="form-group">
                        <label for="sand-course-rating">
                            Course Rating
                            <span class="form-help" data-tooltip="Found on scorecard. Typically 68-75. Measures difficulty for scratch golfers.">?</span>
                        </label>
                        <input type="number" id="sand-course-rating" step="0.1" value="72.0" min="50" max="90" required>
                    </div>
                    <div class="form-group">
                        <label for="sand-slope-rating">
                            Slope Rating
                            <span class="form-help" data-tooltip="Found on scorecard. Usually 113-140. Higher = harder for high handicappers.">?</span>
                        </label>
                        <input type="number" id="sand-slope-rating" value="125" min="55" max="155" required>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üèÜ Tournament Scores</h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;">
                    <strong>Enter what they shot today</strong> and any other tournament rounds you know about.<br>
                    More data = better analysis, but even one round can reveal patterns.
                </p>
                <div id="tournament-scores-container">
                    <div class="score-entry" data-round="1">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Today's Score</label>
                                <input type="number" class="tournament-score-input" placeholder="e.g., 78" min="25" max="200" required>
                            </div>
                            <div class="form-group">
                                <label>Holes</label>
                                <select class="tournament-holes-input" required>
                                    <option value="18" selected>18</option>
                                    <option value="9">9</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" onclick="addTournamentScore()" class="btn btn-secondary" style="margin-top: 10px;">
                    + Add Tournament Round
                </button>
            </div>

            <div class="form-section">
                <h3>‚õ≥ Casual Scores (Optional)</h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;">
                    Optional: Enter casual round scores to compare performance. Sandbaggers often play worse in casual rounds to inflate their handicap.
                </p>
                <div id="casual-scores-container">
                    <!-- Casual scores added dynamically -->
                </div>
                <button type="button" onclick="addCasualScore()" class="btn btn-secondary" style="margin-top: 10px;">
                    + Add Casual Round
                </button>
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px; font-size: 1.1rem;">
                üîç Analyze for Sandbagging
            </button>
        </form>

        <div class="loading-indicator" id="sandbagging-loading">
            <div class="spinner"></div>
            <p class="loading-main-text">Analyzing scoring patterns...</p>
            <p class="loading-carl-quote caddyshack-only" id="loading-quote">
                "Checking the underground surveillance footage..."
            </p>
            <div class="gopher-digging caddyshack-only"><img src="/static/images/gopher.svg" alt="Gopher" class="gopher-icon-large"></div>
        </div>

        <div id="sandbagging-results" class="results-section" style="display: none;">
            <h3 id="sand-results-title">üß® Spackler Analysis Results</h3>
            
            <!-- üÜï QUICK SUMMARY for First-Time Users -->
            <div class="results-quick-summary" id="resultsQuickSummary">
                <div class="summary-verdict" id="quickVerdict">Checking...</div>
                <div class="summary-score" id="quickScore">--</div>
                <div class="summary-explanation" id="quickExplanation">
                    Analyzing the data...
                </div>
            </div>
            
            <!-- üìñ THE NARRATION - Carl's story of this player -->
            <div class="carl-narration caddyshack-only" id="carl-narration">
                <div class="narration-avatar"><img src="/static/images/carl.jpg" alt="Carl Spackler"></div>
                <div class="narration-text" id="narration-text">
                    "Cinderella story, outta nowhere..."
                </div>
            </div>

            <!-- üé≠ THE VERDICT - Cheater Reveal Card -->
            <div class="result-card verdict-card" id="risk-card">
                <div class="result-header">
                    <h4 id="sand-golfer-name">--</h4>
                    <span class="badge" id="risk-badge">--</span>
                </div>
                
                <!-- üéØ Spackler Suspicion-O-Meter with Dynamite Fuse -->
                <div class="suspicion-gauge" id="suspicion-gauge">
                    <!-- Dynamite Fuse (appears when high risk) -->
                    <div class="dynamite-fuse"></div>
                    
                    <div class="gauge-container">
                        <div class="gauge-background"></div>
                        <div class="gauge-cover"></div>
                        <div class="gauge-needle" id="gauge-needle" style="transform: rotate(-90deg);"></div>
                        <div class="gauge-center"></div>
                    </div>
                    <div class="gauge-label" id="risk-score-display">--</div>
                    <div class="gauge-sublabel">Suspicion Index (0-100)</div>
                    <div class="gauge-markers">
                        <span>Clean</span>
                        <span>Hmm...</span>
                        <span>Fishy</span>
                        <span>BAGGER!</span>
                    </div>
                    
                    <!-- Explosion Warning -->
                    <div class="explosion-warning">‚ö†Ô∏è DETONATION IMMINENT</div>
                </div>
                
                <!-- Tier Label / Carl's Ruling -->
                <div id="tier-label-display" class="tier-ruling">
                </div>

                <!-- Summary with Carl's Voice -->
                <div class="summary-text" id="sand-summary">
                </div>

                <!-- Recommendation -->
                <div class="recommendation-box">
                    <strong>üìã Carl's Recommendation:</strong>
                    <p id="sand-recommendation"></p>
                </div>
                
                <!-- Action Buttons -->
                <div class="verdict-actions caddyshack-only">
                    <button class="btn btn-secondary" onclick="addToWatchlist()">
                        üìå Add to Watchlist
                    </button>
                    <button class="btn btn-secondary" onclick="shareRoast()">
                        üì§ Share Roast
                    </button>
                </div>
            </div>

            <!-- üìä Statistics Card -->
            <div class="result-card">
                <h4>üìä The Evidence Locker</h4>
                <div class="detail-grid">
                    <div class="detail-item">
                        <div class="label">Avg Tournament Score</div>
                        <div class="value" id="sand-avg-score">--</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Avg vs Expected</div>
                        <div class="value" id="sand-avg-vs-expected">--</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Performance Percentile</div>
                        <div class="value" id="sand-percentile">--</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Score Volatility</div>
                        <div class="value" id="sand-volatility">--</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Joint Probability</div>
                        <div class="value" id="sand-joint-prob">--</div>
                    </div>
                    <div class="detail-item" id="casual-comparison" style="display: none;">
                        <div class="label">Casual vs Tournament</div>
                        <div class="value" id="sand-casual-diff">--</div>
                    </div>
                </div>
            </div>

            <!-- üö© Red Flags Card -->
            <div class="result-card" id="red-flags-card">
                <h4>üö© Red Flags Detected (<span id="red-flags-count">0</span>)</h4>
                <div id="red-flags-container">
                    <p class="no-flags">‚úÖ No red flags detected</p>
                </div>
            </div>
            
            <!-- üÜï CHECK ANOTHER PLAYER Button -->
            <button type="button" class="check-another-btn" onclick="checkAnotherPlayer()">
                üîç Check Another Player
            </button>
        </div>

        <div class="error-message" id="sandbagging-error" style="display: none;"></div>
    </div>
</div>

    <!-- üèÜ ACHIEVEMENTS PANEL -->
    <button class="achievements-toggle" id="achievementsToggle" title="Spackler's License Bureau">
        üèÜ
        <span class="badge-count" id="achievementCount">0</span>
    </button>
    
    <!-- üìã WATCHLIST TOGGLE -->
    <button class="watchlist-toggle caddyshack-only" id="watchlistToggle" title="Noonan Watchlist" onclick="toggleWatchlistPanel()">
        üìã
        <span class="badge-count" id="watchlistCount">0</span>
    </button>
    
    <!-- üìú HISTORY TOGGLE -->
    <button class="history-toggle caddyshack-only" id="historyToggle" title="Analysis History" onclick="toggleHistoryPanel()">
        üìú
        <span class="badge-count" id="historyCount">0</span>
    </button>
    
    <!-- üìä STATS TOGGLE -->
    <button class="stats-toggle caddyshack-only" id="statsToggle" title="Quick Stats Dashboard" onclick="toggleStatsPanel()">
        üìä
    </button>
    
    <!-- üìä STATS PANEL -->
    <div class="stats-panel" id="statsPanel">
        <div class="stats-header">
            üìä SPACKLER STATS
        </div>
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-icon">üîç</div>
                <div class="stat-number" id="statsTotal">0</div>
                <div class="stat-label">Total Analyses</div>
            </div>
            <div class="stat-box">
                <div class="stat-icon">üéØ</div>
                <div class="stat-number" id="statsAvgScore">--</div>
                <div class="stat-label">Avg Score</div>
            </div>
            <div class="stat-box severe">
                <div class="stat-icon">üî•</div>
                <div class="stat-number" id="statsSevere">0</div>
                <div class="stat-label">Severe Finds</div>
            </div>
            <div class="stat-box clean">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-number" id="statsClean">0</div>
                <div class="stat-label">Clean Golfers</div>
            </div>
            <div class="stat-box">
                <div class="stat-icon">üìã</div>
                <div class="stat-number" id="statsWatched">0</div>
                <div class="stat-label">On Watchlist</div>
            </div>
            <div class="stat-box">
                <div class="stat-icon">üö©</div>
                <div class="stat-number" id="statsTotalFlags">0</div>
                <div class="stat-label">Red Flags Found</div>
            </div>
        </div>
        <div class="stats-chart">
            <div class="chart-title">Risk Level Breakdown</div>
            <div class="chart-bars" id="riskChart">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>
    
    <div class="achievements-panel" id="achievementsPanel">
        <div class="achievements-header">
            SPACKLER'S LICENSE BUREAU
        </div>
        <div class="achievements-stats">
            <div class="stat-item">
                <div class="stat-value" id="unlockedCount">0</div>
                <div>Unlocked</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalAnalyses">0</div>
                <div>Analyses</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="sandbaggersCaught">0</div>
                <div>Caught</div>
            </div>
        </div>
        <div class="achievements-list" id="achievementsList">
            <!-- Achievements will be populated by JS -->
        </div>
    </div>
    
    <!-- üìã WATCHLIST PANEL -->
    <div class="watchlist-panel" id="watchlistPanel">
        <div class="watchlist-header">
            üìã NOONAN WATCHLIST
        </div>
        <div class="watchlist-empty" id="watchlistEmpty">
            <p>No suspects yet...</p>
            <p style="font-size: 0.85rem; opacity: 0.7;">Analyze golfers and add them to your watchlist.</p>
        </div>
        <div class="watchlist-items" id="watchlistItems">
            <!-- Watchlist items populated by JS -->
        </div>
        <div class="watchlist-actions">
            <button class="watchlist-export" onclick="exportWatchlist()" title="Export watchlist as JSON">
                üì§ Export
            </button>
            <button class="watchlist-import" onclick="document.getElementById('watchlistImport').click()" title="Import watchlist from JSON">
                üì• Import
            </button>
            <input type="file" id="watchlistImport" accept=".json" style="display:none" onchange="importWatchlist(event)">
        </div>
        <button class="watchlist-clear" id="watchlistClear" onclick="clearWatchlist()">
            üóëÔ∏è Clear Watchlist
        </button>
    </div>
    
    <!-- üìú HISTORY PANEL -->
    <div class="history-panel" id="historyPanel">
        <div class="history-header">
            üìú ANALYSIS HISTORY
        </div>
        <div class="history-empty" id="historyEmpty">
            <p>No analyses yet...</p>
            <p style="font-size: 0.85rem; opacity: 0.7;">Analyze golfers to build your history.</p>
        </div>
        <div class="history-items" id="historyItems">
            <!-- History items populated by JS -->
        </div>
        <button class="history-clear" id="historyClear" onclick="clearHistory()">
            üóëÔ∏è Clear History
        </button>
    </div>
    
    <!-- Achievement Notification Popup -->
    <div class="achievement-notification" id="achievementNotification">
        <span class="unlock-icon">üèÜ</span>
        <div class="unlock-text">
            <h4 id="notificationTitle">Achievement Unlocked!</h4>
            <p id="notificationDesc">Description here</p>
        </div>
    </div>
    
    <!-- Confetti Container -->
    <div class="confetti-container" id="confettiContainer"></div>
    
    <!-- Keyboard Shortcuts Help -->
    <div class="shortcuts-help" id="shortcutsHelp">
        <div class="shortcuts-content">
            <h3>‚å®Ô∏è Keyboard Shortcuts & Easter Eggs</h3>
            <div class="shortcuts-grid">
                <div class="shortcut-item">
                    <kbd>?</kbd>
                    <span>Show this help</span>
                </div>
                <div class="shortcut-item">
                    <kbd>üìã Button</kbd>
                    <span>Noonan Watchlist</span>
                </div>
                <div class="shortcut-item">
                    <kbd>üìú Button</kbd>
                    <span>Analysis History</span>
                </div>
                <div class="shortcut-item">
                    <kbd>üìä Button</kbd>
                    <span>Stats Dashboard</span>
                </div>
                <div class="shortcut-item">
                    <kbd>‚Üë‚Üë‚Üì‚Üì‚Üê‚Üí‚Üê‚ÜíBA</kbd>
                    <span>Total Consciousness</span>
                </div>
                <div class="shortcut-item">
                    <kbd>Type: lama</kbd>
                    <span>Dalai Lama quote</span>
                </div>
                <div class="shortcut-item">
                    <kbd>Type: noonan</kbd>
                    <span>NOONAN! effect</span>
                </div>
                <div class="shortcut-item">
                    <kbd>Type: gunga</kbd>
                    <span>Gunga galunga</span>
                </div>
                <div class="shortcut-item">
                    <kbd>Tap gopher 5x</kbd>
                    <span>Night vision mode</span>
                </div>
                <div class="shortcut-item">
                    <kbd>Triple-click title</kbd>
                    <span>Random movie quote</span>
                </div>
                <div class="shortcut-item">
                    <kbd>Shake phone</kbd>
                    <span>Explosion effect</span>
                </div>
            </div>
            <button class="shortcuts-close" onclick="toggleShortcutsHelp()">Got it!</button>
        </div>
    </div>
    
    <!-- Sound Toggle -->
    <button class="sound-toggle" id="soundToggle" title="Toggle Sound Effects">
        üîä
    </button>
    
    <!-- Help Button -->
    <button class="help-toggle caddyshack-only" id="helpToggle" onclick="toggleShortcutsHelp()" title="Keyboard shortcuts (?)">
        ?
    </button>

    <footer>
        <p>
            <strong>üß® Spackler's Handicap Tracker</strong> - Bushwood CC Edition v1.0.0
        </p>
        <p style="font-size: 0.85rem; margin-top: 8px;">
            <a href="/docs" target="_blank">üìã API Docs</a> | 
            Licensed to kill... handicaps.
        </p>
        <p class="footer-quote" id="footer-quote">
            "So I got that goin' for me, which is nice."
        </p>
        <p class="footer-quote-attribution" id="footer-quote-attr" style="font-size: 0.75rem; opacity: 0.7; margin-top: 5px;">
            ‚Äî Carl Spackler, Quote of the Day
        </p>
        <p style="font-size: 0.75rem; margin-top: 12px; opacity: 0.7;">
            ‚ö†Ô∏è Statistical patterns only. Does not accuse anyone of actual cheating.
        </p>
    </footer>

    <script>
        const API_BASE = '/api/golf';
        
        // Mode state
        let currentMode = localStorage.getItem('clubhouse_mode') || 'caddyshack';
        let gopherClickCount = 0;
        let nightVisionMode = false;
        
        // =================================================================
        // üé¨ CARL SPACKLER'S COMPLETE QUOTE DATABASE
        // "In the immortal words of Jean Paul Sartre..."
        // =================================================================
        
        // General wisdom - random popup quips
        const spacklerQuips = [
            "Hey buddy... this guy's numbers don't add up.",
            "I've got the results here. Not good. Not good at all.",
            "This score is licensed to kill... your credibility.",
            "So I got that goin' for me, which is nice.",
            "Big hitter, the Lama. Long.",
            "Check me if I'm wrong Sandy, but if I kill all the golfers...",
            "Freeze gopher! You're under suspicion.",
            "A flute with no holes is not a flute. And this handicap is not legit.",
            "Cannonball! Cannonball comin'!",
            "In the immortal words of Jean Paul Sartre, 'Au revoir, sandbagger.'",
            "He's a menace. Pure and simple.",
            "Two wrongs don't make a right, but three lefts do.",
            "This guy's been playing his own game all along.",
            "License to kill gophers... AND bogus handicaps.",
            "I smell varmint poontang. And the only good varmint poontang is dead varmint poontang.",
            "He's about one score away from a flying elbow.",
            "Correct me if I'm wrong Sandy, but these numbers stink.",
            "This is a hybrid. A cross of sandbag... and bullcrap.",
            "Pool and a pond. Pond would be good for this guy. Cement shoes.",
            "I'd keep playing. I don't think the heavy stuff's gonna come down for quite a while.",
            "What an incredible Cinderella story... except it's all lies.",
            "He got that going for him. Which is suspicious.",
            "Be the ball... a lying, cheating ball.",
            "Noonan! This guy's a Noonan!",
            "Total consciousness wouldn't help this guy's handicap."
        ];
        
        // Loading state messages - shown during analysis
        const loadingQuips = [
            "Analyzing... like tracking a gopher through the 9th fairway...",
            "Running the numbers... this is better than total consciousness...",
            "Checking the scores... cinderella story time...",
            "Scanning for sandbaggers... I smell varmint poontang...",
            "Processing... don't worry, the heavy stuff won't come down for a while...",
            "Calculating probability... it's in the hole! Maybe...",
            "Cross-referencing data... this is like counting gopher holes...",
            "Evaluating patterns... be the algorithm, Danny...",
            "Crunching statistics... harder than growing a hybrid grass...",
            "Detecting anomalies... freeze gopher...",
            "Running analysis... big hitter, the computer. Long.",
            "Computing risk... in the immortal words of Jean Paul Sartre...",
            "Verifying handicap... a flute with no holes is not a flute...",
            "Checking consistency... two wrongs don't make a right...",
            "Measuring volatility... cinderella story, outta nowhere..."
        ];
        
        // Empty state messages - when no data
        const emptyStateQuips = [
            "No scores yet? That's like a golf course with no gophers. Suspicious.",
            "Enter some data, caddy. I got all day.",
            "Empty scorecard? Fill it in. I'll wait. I'm patient like a gopher.",
            "Nothing to analyze? Pool and a pond... pond would be good.",
            "C'mon, give me something to work with here.",
            "This form is emptier than Judge Smails' conscience.",
            "Enter the numbers. Let's find us a sandbagger.",
            "Data? I need data! A caddy needs numbers like a gopher needs dirt."
        ];
        
        // Error messages - Carl-style
        const errorQuips = [
            "Something went wrong. Even Carl can't fix this one.",
            "Error! That's like hitting into the water on 18. Try again.",
            "Well that didn't work. Probably a gopher chewed through the cables.",
            "System error. Must be those plastic explosives I planted.",
            "Oops. That's what happens when you let the gopher run IT.",
            "Technical difficulties. Check me if I'm wrong, but that's bad.",
            "Failed! Like Ty Webb's attempt at being humble.",
            "Error in the matrix. Even total consciousness couldn't see this coming."
        ];
        
        // Success messages - when analysis completes
        const successQuips = [
            "Analysis complete. Let's see what we've got here...",
            "Done! Now let's find out who's been naughty...",
            "Results are in. Drumroll please...",
            "Finished! Like a gopher after a good tunnel.",
            "Complete. Time to reveal the truth...",
            "All done. So we got that going for us.",
            "Analysis finished. The numbers don't lie.",
            "Ready for the verdict, caddy?"
        ];
        
        // Welcome messages - on app entry
        const welcomeQuips = [
            "Welcome to the lair, caddy. Let's find some sandbaggers.",
            "You made it! Now let's catch some cheaters.",
            "Enter freely and of your own will. And bring data.",
            "Welcome, my friend. I've been expecting you... and your suspicions.",
            "Ah, a fellow detective. Let's hunt some gophers.",
            "The lair welcomes you. Sandbaggers beware.",
            "Ready to expose some bogus handicaps? Let's roll."
        ];
        
        // Tab-specific messages
        const tabQuips = {
            probability: [
                "Probability tab, eh? Let's see how unlikely this score really is.",
                "Time to do some math. Don't worry, I'll handle the thinking.",
                "Probability... it's like guessing where the gopher will pop up next.",
                "The numbers don't lie. Unlike some golfers I know."
            ],
            sandbagging: [
                "Sandbagging analysis. My specialty.",
                "Let's find out who's playing their own game.",
                "Time to separate the honest from the hustlers.",
                "Sandbagger detection mode: ENGAGED."
            ],
            team: [
                "Team analysis? Two sandbaggers are worse than one.",
                "Let's see if this whole team is in on it.",
                "Team probability. Twice the players, twice the suspicion.",
                "Best ball, eh? More like best liars..."
            ]
        };
        
        // Narrator function - tells the story
        function narrateAnalysis(data) {
            const name = data.golfer_name || 'This player';
            const score = data.sandbagging_risk_score || 0;
            const hcp = data.handicap_index || 0;
            
            if (score >= 75) {
                return `Cinderella story... outta nowhere... ${name} with a ${hcp} handicap, posting scores that'd make the Dalai Lama suspicious. This ain't total consciousness, this is total sandbagging.`;
            } else if (score >= 50) {
                return `Here's an interesting one, Danny. ${name} claims a ${hcp} handicap but those tournament numbers... something smells, and it ain't the fertilizer.`;
            } else if (score >= 25) {
                return `${name}'s got some curious patterns here. Could be legit, could be sandbag city. Like a gopher hole - you gotta dig deeper to know for sure.`;
            } else {
                return `${name} looks clean. Numbers check out. This one's more honest than Ty Webb's blindfolded putting.`;
            }
        }
        
        // Get random quote from category
        function getQuote(category) {
            const quotes = {
                general: spacklerQuips,
                loading: loadingQuips,
                empty: emptyStateQuips,
                error: errorQuips,
                success: successQuips,
                welcome: welcomeQuips
            };
            const arr = quotes[category] || spacklerQuips;
            return arr[Math.floor(Math.random() * arr.length)];
        }
        
        // Rotating loading quote system
        let loadingInterval = null;
        function startLoadingQuotes(element) {
            if (!element) return;
            const updateQuote = () => {
                element.textContent = getQuote('loading');
            };
            updateQuote();
            loadingInterval = setInterval(updateQuote, 3000);
        }
        
        function stopLoadingQuotes() {
            if (loadingInterval) {
                clearInterval(loadingInterval);
                loadingInterval = null;
            }
        }
        
        // Initialize app on load
        document.addEventListener('DOMContentLoaded', () => {
            // Check if splash was already shown this session
            if (!sessionStorage.getItem('splash_shown')) {
                document.getElementById('splash-screen').style.display = 'flex';
            } else {
                document.getElementById('splash-screen').classList.add('hidden');
            }
            
            applyMode(currentMode);
            initializeApp();
            
            // Start gopher popup timer (only in Caddyshack mode)
            if (currentMode === 'caddyshack') {
                scheduleGopherPopup();
            }
        });
        
        // Enter app from splash screen
        function enterApp() {
            const splash = document.getElementById('splash-screen');
            splash.classList.add('hidden');
            sessionStorage.setItem('splash_shown', 'true');
            
            // Show welcome gopher after a delay with random welcome quip
            setTimeout(() => {
                if (currentMode === 'caddyshack') {
                    showGopherQuip(getQuote('welcome'), 'happy');
                }
            }, 1500);
        }
        
        // üêøÔ∏è GOPHER COMMAND CENTER - Enhanced with moods and reactions
        
        // Gopher mood states
        const GOPHER_MOODS = {
            IDLE: 'idle',
            HAPPY: 'happy',
            ALERT: 'alert',
            SUSPICIOUS: 'suspicious',
            ANGRY: 'angry',
            SCARED: 'scared'
        };
        
        // Speech bubble styles
        const SPEECH_STYLES = {
            normal: '',
            warning: 'warning',
            danger: 'danger',
            success: 'success'
        };
        
        let currentGopherMood = GOPHER_MOODS.IDLE;
        
        function scheduleGopherPopup() {
            // Random interval between 30-90 seconds
            const delay = (30 + Math.random() * 60) * 1000;
            setTimeout(() => {
                if (currentMode === 'caddyshack' && !document.body.classList.contains('serious-mode')) {
                    // Random moods for random popups
                    const randomMoods = [GOPHER_MOODS.IDLE, GOPHER_MOODS.SUSPICIOUS, GOPHER_MOODS.ALERT];
                    const mood = randomMoods[Math.floor(Math.random() * randomMoods.length)];
                    showGopherQuip(null, mood);
                    scheduleGopherPopup();
                }
            }, delay);
        }
        
        function showGopherQuip(customQuip = null, mood = GOPHER_MOODS.IDLE, speechStyle = SPEECH_STYLES.normal) {
            const gopher = document.getElementById('gopher-popup');
            const speech = document.getElementById('gopher-speech');
            const hole = document.getElementById('gopher-hole');
            
            if (!gopher || !speech) return;
            
            const quip = customQuip || spacklerQuips[Math.floor(Math.random() * spacklerQuips.length)];
            
            // Clear previous mood classes
            gopher.className = 'gopher-popup';
            speech.className = 'gopher-speech';
            
            // Set quip text
            speech.textContent = quip;
            
            // Apply mood
            currentGopherMood = mood;
            gopher.classList.add('active', mood);
            
            // Apply speech style
            speech.classList.add('active');
            if (speechStyle && speechStyle !== SPEECH_STYLES.normal) {
                speech.classList.add(speechStyle);
            }
            
            // Show hole
            if (hole) {
                hole.classList.add('visible');
            }
            
            // Create dirt spray effect on emergence
            createDirtSpray();
            
            // Hide after duration based on mood
            const duration = mood === GOPHER_MOODS.ANGRY ? 7000 : 5000;
            setTimeout(() => {
                hideGopher();
            }, duration);
        }
        
        function hideGopher() {
            const gopher = document.getElementById('gopher-popup');
            const speech = document.getElementById('gopher-speech');
            const hole = document.getElementById('gopher-hole');
            
            if (gopher) {
                gopher.classList.remove('active', ...Object.values(GOPHER_MOODS));
            }
            if (speech) {
                speech.classList.remove('active', ...Object.values(SPEECH_STYLES));
            }
            setTimeout(() => {
                if (hole) hole.classList.remove('visible');
            }, 500);
        }
        
        function createDirtSpray() {
            const container = document.getElementById('gopher-dirt');
            if (!container) return;
            
            // Create 8-12 dirt particles
            const numParticles = 8 + Math.floor(Math.random() * 5);
            
            for (let i = 0; i < numParticles; i++) {
                const particle = document.createElement('div');
                particle.className = 'dirt-particle';
                
                // Random trajectory
                const angle = (Math.random() * 120) - 60; // -60 to 60 degrees
                const distance = 30 + Math.random() * 40;
                const dx = Math.cos(angle * Math.PI / 180) * distance;
                const dy = -Math.abs(Math.sin(angle * Math.PI / 180) * distance) - 20;
                
                particle.style.setProperty('--dx', `${dx}px`);
                particle.style.setProperty('--dy', `${dy}px`);
                particle.style.animationDelay = `${i * 0.05}s`;
                
                container.appendChild(particle);
                
                // Remove after animation
                setTimeout(() => particle.remove(), 1000);
            }
        }
        
        // React to analysis results with appropriate gopher mood
        function gopherReact(riskLevel, score) {
            let mood, style;
            
            if (score >= 75 || riskLevel === 'SEVERE') {
                mood = GOPHER_MOODS.ANGRY;
                style = SPEECH_STYLES.danger;
            } else if (score >= 50 || riskLevel === 'HIGH') {
                mood = GOPHER_MOODS.SUSPICIOUS;
                style = SPEECH_STYLES.warning;
            } else if (score >= 25 || riskLevel === 'MODERATE') {
                mood = GOPHER_MOODS.ALERT;
                style = SPEECH_STYLES.warning;
            } else {
                mood = GOPHER_MOODS.HAPPY;
                style = SPEECH_STYLES.success;
            }
            
            return { mood, style };
        }
        
        // ü•ö Easter egg: Tap gopher 5 times for Night Vision Mode
        document.getElementById('gopher-popup')?.addEventListener('click', () => {
            gopherClickCount++;
            if (gopherClickCount >= 5) {
                toggleNightVision();
                gopherClickCount = 0;
            }
        });
        
        function toggleNightVision() {
            nightVisionMode = !nightVisionMode;
            if (nightVisionMode) {
                document.body.style.filter = 'hue-rotate(90deg) saturate(2) brightness(0.8)';
                showGopherQuip("NIGHT VISION ACTIVATED. Predator mode engaged.");
                // üèÜ Track Easter egg for achievement
                updateStats('nightVisionActivated');
                checkAchievements();
            } else {
                document.body.style.filter = '';
                showGopherQuip("Back to normal. Nothing to see here.");
            }
        }
        
        // ü•ö Easter egg: Shake detection (mobile)
        let lastShake = 0;
        if (window.DeviceMotionEvent) {
            window.addEventListener('devicemotion', (e) => {
                const acc = e.accelerationIncludingGravity;
                if (acc && Math.abs(acc.x) + Math.abs(acc.y) + Math.abs(acc.z) > 40) {
                    const now = Date.now();
                    if (now - lastShake > 2000) {
                        lastShake = now;
                        triggerExplosionEffect();
                    }
                }
            });
        }
        
        function triggerExplosionEffect() {
            // Screen shake
            document.body.style.animation = 'shake 0.5s ease-in-out';
            setTimeout(() => {
                document.body.style.animation = '';
            }, 500);
            
            // Create dirt particles
            for (let i = 0; i < 15; i++) {
                createDirtParticle();
            }
            
            showGopherQuip("CANNONBALL! CANNONBALL!");
        }
        
        function createDirtParticle() {
            const particle = document.createElement('div');
            particle.style.cssText = `
                position: fixed;
                width: ${5 + Math.random() * 10}px;
                height: ${5 + Math.random() * 10}px;
                background: #8B6432;
                border-radius: 50%;
                top: -20px;
                left: ${Math.random() * 100}vw;
                z-index: 10000;
                pointer-events: none;
                animation: dirtFall 2s ease-in forwards;
            `;
            document.body.appendChild(particle);
            setTimeout(() => particle.remove(), 2000);
        }
        
        // Add dirt fall animation dynamically
        if (!document.getElementById('dirt-animation-style')) {
            const style = document.createElement('style');
            style.id = 'dirt-animation-style';
            style.textContent = `
                @keyframes dirtFall {
                    to {
                        transform: translateY(120vh) rotate(360deg);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);
        }
        
        // ============================================
        // üßò DALAI LAMA EASTER EGGS - Philosophy Mode
        // ============================================
        
        // Comprehensive Caddyshack quote database (50+ quotes!)
        const caddyshackQuotes = [
            // Carl Spackler Classics
            { quote: "So I jump ship in Hong Kong and make my way over to Tibet, and I get on as a looper at a course over in the Himalayas.", character: "Carl Spackler" },
            { quote: "A looper, you know, a caddy, a looper, a jock.", character: "Carl Spackler" },
            { quote: "So, I tell them I'm a pro jock, and who do you think they give me? The Dalai Lama, himself.", character: "Carl Spackler" },
            { quote: "Twelfth son of the Lama. The flowing robes, the grace, bald... striking.", character: "Carl Spackler" },
            { quote: "Big hitter, the Lama - long.", character: "Carl Spackler" },
            { quote: "So we finish the eighteenth and he's gonna stiff me. And I say, 'Hey, Lama, hey, how about a little something, you know, for the effort?'", character: "Carl Spackler" },
            { quote: "And he says, 'Oh, uh, there won't be any money, but when you die, on your deathbed, you will receive total consciousness.'", character: "Carl Spackler" },
            { quote: "So I got that goin' for me, which is nice.", character: "Carl Spackler" },
            { quote: "In the immortal words of Jean Paul Sartre, 'Au revoir, gopher.'", character: "Carl Spackler" },
            { quote: "License to kill gophers by the government of the United Nations. Man, free to kill gophers at will.", character: "Carl Spackler" },
            { quote: "To kill, you must know your enemy, and in this case my enemy is a varmint.", character: "Carl Spackler" },
            { quote: "I have to laugh, because I've outsmarted even myself.", character: "Carl Spackler" },
            { quote: "This is a hybrid. This is a cross of Bluegrass, Kentucky Bluegrass, Featherbed Bent, and Northern California Sensemilla.", character: "Carl Spackler" },
            { quote: "The grass is nice and sticky. That's the last of the grass.", character: "Carl Spackler" },
            { quote: "Cannonball! Cannonball comin'!", character: "Carl Spackler" },
            { quote: "He got all of that one.", character: "Carl Spackler" },
            { quote: "It's in the hole! It's in the hole!", character: "Carl Spackler" },
            { quote: "Cinderella story. Outta nowhere. A former greenskeeper, now, about to become the Masters champion.", character: "Carl Spackler" },
            { quote: "A Cinderella story... About to become the champion at Augusta.", character: "Carl Spackler" },
            { quote: "Correct me if I'm wrong, Sandy, but if I kill all the golfers, they're gonna lock me up and throw away the key.", character: "Carl Spackler" },
            { quote: "What an incredible Cinderella story! This unknown comes out of nowhere to lead the pack at Augusta!", character: "Carl Spackler" },
            { quote: "A looper's life is like a box of chocolates.", character: "Carl Spackler" },
            
            // Ty Webb
            { quote: "Be the ball, Danny.", character: "Ty Webb" },
            { quote: "Just relax. Feel your way through it. Trust your instincts.", character: "Ty Webb" },
            { quote: "Find your center. Picture the ball's trajectory.", character: "Ty Webb" },
            { quote: "You're a real fighter, Danny.", character: "Ty Webb" },
            { quote: "Don't be obsessed with your desires Danny. The Zen philosopher Basho once wrote, 'A flute with no holes, is not a flute. A donut with no hole, is a danish.'", character: "Ty Webb" },
            { quote: "I'm gonna give you a little advice. There's a force in the universe that makes things happen. And all you have to do is get in touch with it, stop thinking, let things happen, and be the ball.", character: "Ty Webb" },
            { quote: "I was born to love you. I was born to lick your face.", character: "Ty Webb" },
            { quote: "Two wrongs don't make a right, but three lefts do.", character: "Ty Webb" },
            { quote: "Danny, I'm having a party at the Caddyshack. You know you're invited, so why don't you come?", character: "Ty Webb" },
            { quote: "Remember, Danny, two wrongs don't make a right, but three rights make a left.", character: "Ty Webb" },
            
            // Judge Smails
            { quote: "Well, we're waiting!", character: "Judge Smails" },
            { quote: "Don't you people have homes?", character: "Judge Smails" },
            { quote: "I've sentenced boys younger than you to the gas chamber. Didn't want to do it. I felt I owed it to them.", character: "Judge Smails" },
            { quote: "You'll get nothing and like it!", character: "Judge Smails" },
            { quote: "It's easy to grin when your ship comes in, and you've got the stock market beat. But the man worthwhile is the man who can smile when his shorts are too tight in the seat.", character: "Judge Smails" },
            { quote: "Gambling is illegal at Bushwood, sir, and I NEVER slice.", character: "Judge Smails" },
            { quote: "How about a Fresca?", character: "Judge Smails" },
            
            // Al Czervik
            { quote: "Hey everybody, we're all gonna get laid!", character: "Al Czervik" },
            { quote: "Who stepped on a duck?", character: "Al Czervik" },
            { quote: "I hear this place is restricted, Wang, so don't tell 'em you're Jewish.", character: "Al Czervik" },
            { quote: "Oh, this your wife, huh? A lovely lady. Hey baby, you must've been something before electricity.", character: "Al Czervik" },
            { quote: "You're a lot of woman, you know that? Yeah, wanna make 14 dollars the hard way?", character: "Al Czervik" },
            { quote: "Let's have a little wine with dinner, shall we? Bring us a pitcher of beer every seven minutes until somebody passes out.", character: "Al Czervik" },
            { quote: "Hey, nice buns. You know, you got a lot of nerve coming in here after what happened last summer!", character: "Al Czervik" },
            { quote: "Last time I saw a mouth like that, it had a hook in it.", character: "Al Czervik" },
            { quote: "Oh, this is the worst-looking hat I ever saw. You buy a hat like this, I bet you get a free bowl of soup.", character: "Al Czervik" },
            
            // Other Characters
            { quote: "Well? We're waiting!", character: "Various" },
            { quote: "Hey, Lama! How about a little something, you know, for the effort?", character: "Carl Spackler" },
            { quote: "Noonan!", character: "Various" },
            { quote: "Gunga galunga... gunga, gunga-lagunga.", character: "Carl Spackler" }
        ];
        
        // Quote of the Day - based on date
        function getQuoteOfTheDay() {
            const today = new Date();
            const dayIndex = (today.getFullYear() * 365 + today.getMonth() * 31 + today.getDate()) % caddyshackQuotes.length;
            return caddyshackQuotes[dayIndex];
        }
        
        // Philosophy Mode (Konami Code Easter Egg)
        let konamiSequence = [];
        const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        let philosophyMode = false;
        
        document.addEventListener('keydown', (e) => {
            konamiSequence.push(e.key);
            konamiSequence = konamiSequence.slice(-10);
            
            if (konamiSequence.join(',') === konamiCode.join(',')) {
                activatePhilosophyMode();
            }
            
            // ? key shows shortcuts help (when not in input field)
            if (e.key === '?' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
                toggleShortcutsHelp();
            }
            
            // Escape closes any overlay
            if (e.key === 'Escape') {
                const shortcuts = document.getElementById('shortcutsHelp');
                if (shortcuts?.classList.contains('active')) {
                    toggleShortcutsHelp();
                }
                if (philosophyMode) {
                    activatePhilosophyMode();
                }
            }
        });
        
        // Toggle shortcuts help panel
        function toggleShortcutsHelp() {
            const panel = document.getElementById('shortcutsHelp');
            if (panel) {
                panel.classList.toggle('active');
            }
        }
        
        function activatePhilosophyMode() {
            philosophyMode = !philosophyMode;
            
            if (philosophyMode) {
                document.body.classList.add('philosophy-mode');
                showPhilosophyOverlay();
                showGopherQuip("You have achieved total consciousness. Gunga galunga.", 'happy');
                
                // Achievement for discovering this
                updateStats('philosophyModeActivated');
                checkAchievements();
                
                // Create zen particles
                createZenParticles();
            } else {
                document.body.classList.remove('philosophy-mode');
                hidePhilosophyOverlay();
                showGopherQuip("Back to reality. But you'll always have that memory.", 'idle');
            }
        }
        
        function showPhilosophyOverlay() {
            // Create overlay if it doesn't exist
            let overlay = document.getElementById('philosophy-overlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.id = 'philosophy-overlay';
                overlay.innerHTML = `
                    <div class="philosophy-content">
                        <div class="lama-icon">üßò</div>
                        <h2>TOTAL CONSCIOUSNESS ACHIEVED</h2>
                        <div class="daily-quote">
                            <p class="quote-text">"${getQuoteOfTheDay().quote}"</p>
                            <p class="quote-attribution">- ${getQuoteOfTheDay().character}</p>
                        </div>
                        <div class="philosophy-stats">
                            <div class="zen-stat">
                                <span class="stat-emoji">üèåÔ∏è</span>
                                <span>Analyses: ${getStats().totalAnalyses || 0}</span>
                            </div>
                            <div class="zen-stat">
                                <span class="stat-emoji">üö®</span>
                                <span>Sandbaggers Caught: ${getStats().sandbaggersCaught || 0}</span>
                            </div>
                            <div class="zen-stat">
                                <span class="stat-emoji">üèÜ</span>
                                <span>Achievements: ${Object.values(loadAchievementProgress()).filter(a => a.unlocked).length}</span>
                            </div>
                        </div>
                        <button class="philosophy-close" onclick="activatePhilosophyMode()">Return to Bushwood</button>
                        <p class="philosophy-footer">Press ‚Üë‚Üë‚Üì‚Üì‚Üê‚Üí‚Üê‚ÜíBA again to exit</p>
                    </div>
                `;
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: linear-gradient(135deg, rgba(27, 94, 32, 0.95), rgba(76, 175, 80, 0.9));
                    z-index: 20000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    animation: fadeIn 1s ease;
                `;
                document.body.appendChild(overlay);
                
                // Add overlay styles if not present
                if (!document.getElementById('philosophy-styles')) {
                    const style = document.createElement('style');
                    style.id = 'philosophy-styles';
                    style.textContent = `
                        @keyframes fadeIn {
                            from { opacity: 0; }
                            to { opacity: 1; }
                        }
                        
                        @keyframes floatUp {
                            0%, 100% { transform: translateY(0); }
                            50% { transform: translateY(-10px); }
                        }
                        
                        @keyframes zenGlow {
                            0%, 100% { text-shadow: 0 0 10px rgba(232, 213, 100, 0.5); }
                            50% { text-shadow: 0 0 30px rgba(232, 213, 100, 1), 0 0 50px rgba(232, 213, 100, 0.5); }
                        }
                        
                        .philosophy-content {
                            text-align: center;
                            color: white;
                            padding: 40px;
                            max-width: 600px;
                        }
                        
                        .lama-icon {
                            font-size: 5rem;
                            animation: floatUp 3s ease-in-out infinite;
                            margin-bottom: 20px;
                        }
                        
                        .philosophy-content h2 {
                            font-family: 'Bungee', sans-serif;
                            font-size: 2rem;
                            letter-spacing: 3px;
                            margin-bottom: 30px;
                            animation: zenGlow 2s ease-in-out infinite;
                            color: #E8D564;
                        }
                        
                        .daily-quote {
                            background: rgba(0, 0, 0, 0.3);
                            padding: 25px;
                            border-radius: 15px;
                            margin: 30px 0;
                            border: 2px solid rgba(232, 213, 100, 0.3);
                        }
                        
                        .quote-text {
                            font-family: 'Shadows Into Light', cursive;
                            font-size: 1.4rem;
                            line-height: 1.6;
                            margin-bottom: 15px;
                        }
                        
                        .quote-attribution {
                            font-size: 1rem;
                            opacity: 0.8;
                            font-style: italic;
                        }
                        
                        .philosophy-stats {
                            display: flex;
                            justify-content: center;
                            gap: 30px;
                            margin: 30px 0;
                            flex-wrap: wrap;
                        }
                        
                        .zen-stat {
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            gap: 5px;
                            font-family: 'Bungee', sans-serif;
                        }
                        
                        .stat-emoji {
                            font-size: 2rem;
                        }
                        
                        .philosophy-close {
                            background: #E8D564;
                            color: #1B5E20;
                            border: none;
                            padding: 15px 30px;
                            font-family: 'Bungee', sans-serif;
                            font-size: 1rem;
                            border-radius: 30px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            margin-top: 20px;
                        }
                        
                        .philosophy-close:hover {
                            background: white;
                            transform: scale(1.05);
                        }
                        
                        .philosophy-footer {
                            margin-top: 20px;
                            font-size: 0.8rem;
                            opacity: 0.6;
                        }
                        
                        .zen-particle {
                            position: fixed;
                            pointer-events: none;
                            z-index: 19999;
                            font-size: 1.5rem;
                            animation: zenFloat 10s linear forwards;
                        }
                        
                        @keyframes zenFloat {
                            0% {
                                transform: translateY(100vh) rotate(0deg);
                                opacity: 0;
                            }
                            10% {
                                opacity: 1;
                            }
                            90% {
                                opacity: 1;
                            }
                            100% {
                                transform: translateY(-100px) rotate(360deg);
                                opacity: 0;
                            }
                        }
                    `;
                    document.head.appendChild(style);
                }
            } else {
                overlay.style.display = 'flex';
                // Update quote
                const quoteText = overlay.querySelector('.quote-text');
                const quoteAttr = overlay.querySelector('.quote-attribution');
                if (quoteText && quoteAttr) {
                    const dailyQuote = getQuoteOfTheDay();
                    quoteText.textContent = `"${dailyQuote.quote}"`;
                    quoteAttr.textContent = `- ${dailyQuote.character}`;
                }
            }
        }
        
        function hidePhilosophyOverlay() {
            const overlay = document.getElementById('philosophy-overlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }
        
        function createZenParticles() {
            const symbols = ['üèåÔ∏è', '‚õ≥', 'üßò', '‚òØÔ∏è', 'üåø', 'üéã', 'üïäÔ∏è', '‚ú®'];
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'zen-particle';
                    particle.textContent = symbols[Math.floor(Math.random() * symbols.length)];
                    particle.style.left = Math.random() * 100 + 'vw';
                    particle.style.animationDuration = (8 + Math.random() * 6) + 's';
                    particle.style.animationDelay = (Math.random() * 2) + 's';
                    document.body.appendChild(particle);
                    
                    setTimeout(() => particle.remove(), 15000);
                }, i * 500);
            }
        }
        
        // Secret click sequence on logo for random quote
        let headerClickCount = 0;
        let headerClickTimeout = null;
        
        document.querySelector('header h1')?.addEventListener('click', () => {
            headerClickCount++;
            clearTimeout(headerClickTimeout);
            
            if (headerClickCount >= 3) {
                // Show random quote
                const randomQuote = caddyshackQuotes[Math.floor(Math.random() * caddyshackQuotes.length)];
                showGopherQuip(`"${randomQuote.quote}" - ${randomQuote.character}`, 'happy');
                headerClickCount = 0;
            } else {
                headerClickTimeout = setTimeout(() => {
                    headerClickCount = 0;
                }, 1000);
            }
        });
        
        // Typing "lama" anywhere triggers a Dalai Lama quote
        let typeBuffer = '';
        document.addEventListener('keypress', (e) => {
            if (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA') return;
            
            typeBuffer += e.key.toLowerCase();
            typeBuffer = typeBuffer.slice(-10);
            
            if (typeBuffer.includes('lama')) {
                const lamaQuotes = caddyshackQuotes.filter(q => 
                    q.quote.toLowerCase().includes('lama') || 
                    q.quote.toLowerCase().includes('dalai') ||
                    q.quote.toLowerCase().includes('consciousness') ||
                    q.quote.toLowerCase().includes('tibet')
                );
                if (lamaQuotes.length > 0) {
                    const quote = lamaQuotes[Math.floor(Math.random() * lamaQuotes.length)];
                    showGopherQuip(`"${quote.quote}"`, 'happy');
                }
                typeBuffer = '';
            }
            
            if (typeBuffer.includes('noonan')) {
                showGopherQuip("NOONAN! NOONAN! NOONAN!", 'alert');
                document.body.classList.add('screen-shake');
                setTimeout(() => document.body.classList.remove('screen-shake'), 500);
                typeBuffer = '';
            }
            
            if (typeBuffer.includes('gunga')) {
                showGopherQuip("Gunga galunga... gunga, gunga-lagunga. So I got that going for me.", 'happy');
                typeBuffer = '';
            }
        });
        
        // Mode toggle function
        function toggleMode() {
            currentMode = currentMode === 'caddyshack' ? 'serious' : 'caddyshack';
            localStorage.setItem('clubhouse_mode', currentMode);
            applyMode(currentMode);
            
            // Sync with backend
            fetch(`${API_BASE}/config`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ mode: currentMode })
            }).catch(err => console.warn('Could not sync mode with backend:', err));
            
            // Reset night vision on mode switch
            if (nightVisionMode) {
                nightVisionMode = false;
                document.body.style.filter = '';
            }
        }
        
        // Apply mode to UI
        function applyMode(mode) {
            const body = document.body;
            const toggle = document.getElementById('mode-toggle');
            const modeIcon = toggle.querySelector('.mode-icon');
            const modeText = toggle.querySelector('.mode-text');
            
            if (mode === 'serious') {
                body.classList.add('serious-mode');
                modeIcon.innerHTML = 'üìã';
                modeText.textContent = 'Committee Mode';
                
                // Update text content for serious mode
                const sandBanner = document.getElementById('sand-banner');
                if (sandBanner) {
                    sandBanner.innerHTML = `
                        üìä Handicap Integrity Analysis
                        <div style="font-size: 0.8rem; margin-top: 5px; opacity: 0.9;">
                            Statistical pattern detection for handicap committee review
                        </div>
                    `;
                }
                const resultsTitle = document.getElementById('sand-results-title');
                if (resultsTitle) resultsTitle.textContent = 'üìä Analysis Results';
            } else {
                body.classList.remove('serious-mode');
                modeIcon.innerHTML = '<img src="/static/images/gopher.svg" alt="" class="gopher-icon">';
                modeText.textContent = 'Gopher Mode';
                
                // Update text content for Caddyshack mode
                const sandBanner = document.getElementById('sand-banner');
                if (sandBanner) {
                    sandBanner.innerHTML = `
                        üîç THE NOONAN WATCHLIST üîç
                        <div style="font-size: 0.8rem; margin-top: 5px; opacity: 0.9;">
                            "License to kill gophers by the government of the United Nations... and to investigate suspicious scorecards."
                        </div>
                    `;
                }
                const resultsTitle = document.getElementById('sand-results-title');
                if (resultsTitle) resultsTitle.textContent = 'üß® Spackler Analysis Results';
            }
            
            // Toggle visibility of Caddyshack-only elements
            document.querySelectorAll('.caddyshack-only').forEach(el => {
                el.style.display = mode === 'caddyshack' ? '' : 'none';
            });
        }
        
        // Update gauge needle position and dynamite effects
        function updateGauge(score) {
            const needle = document.getElementById('gauge-needle');
            const gauge = document.getElementById('suspicion-gauge');
            
            if (needle) {
                // Score 0 = -90deg (left), Score 100 = 90deg (right)
                const rotation = -90 + (score / 100) * 180;
                needle.style.transform = `rotate(${rotation}deg)`;
            }
            
            // Toggle high-risk class for dynamite fuse effect
            if (gauge) {
                if (score >= 50) {
                    gauge.classList.add('high-risk');
                } else {
                    gauge.classList.remove('high-risk');
                }
            }
        }
        
        // Get risk color based on level
        function getRiskColor(riskLevel) {
            const colors = {
                'LOW': 'var(--risk-low)',
                'MODERATE': 'var(--risk-moderate)',
                'HIGH': 'var(--risk-high)',
                'SEVERE': 'var(--risk-severe)'
            };
            return colors[riskLevel] || colors['LOW'];
        }
        
        // Get badge class based on risk level
        function getRiskBadgeClass(riskLevel) {
            const classes = {
                'LOW': 'badge-low',
                'MODERATE': 'badge-moderate',
                'HIGH': 'badge-high',
                'SEVERE': 'badge-severe'
            };
            return classes[riskLevel] || classes['LOW'];
        }
        
        // Carl's roast lines for sharing
        const roastLines = [
            "Total freaking bagger.",
            "Suspicious as a three-putt on a one-footer.",
            "I've seen more honest swings from Judge Smails.",
            "This guy's handicap is faker than Ty Webb's blindfolded putts.",
            "About as legitimate as Al Czervik's invitation to Bushwood.",
            "Even the gopher thinks something's fishy here.",
            "Playing his own game all along... and it's called 'sandbagging.'",
            "Cinderella story... out of nowhere... total sandbagger at Augusta.",
            "Big hitter, the Lama. Also big cheater, this guy.",
            "He'd look better in Carl's brown polyester than in golf clothes.",
            "License to kill his credibility.",
            "Gunga galunga. Gunga, gunga-lagunga. Also: busted."
        ];
        
        // üìå Add to Watchlist function
        function addToWatchlist() {
            const golferName = document.getElementById('sand-golfer-name').textContent;
            const riskScore = document.getElementById('risk-score-display').textContent;
            
            // Get existing watchlist
            let watchlist = [];
            try {
                watchlist = JSON.parse(localStorage.getItem('spackler_watchlist') || '[]');
            } catch (e) {
                watchlist = [];
            }
            
            // Add new entry
            const entry = {
                name: golferName,
                score: riskScore,
                date: new Date().toLocaleDateString(),
                timestamp: Date.now()
            };
            
            // Check if already on watchlist
            const existing = watchlist.findIndex(w => w.name === golferName);
            if (existing >= 0) {
                watchlist[existing] = entry;
                showGopherQuip(`"${golferName.split('(')[0].trim()}" updated on the watchlist. Keeping tabs...`);
            } else {
                watchlist.push(entry);
                showGopherQuip(`"${golferName.split('(')[0].trim()}" added to the Noonan Watchlist. Got 'em.`);
            }
            
            localStorage.setItem('spackler_watchlist', JSON.stringify(watchlist));
            
            // üèÜ Check watchlist achievements
            checkAchievements();
            
            // Update watchlist panel
            updateWatchlistPanel();
        }
        
        // Toggle watchlist panel
        function toggleWatchlistPanel() {
            const panel = document.getElementById('watchlistPanel');
            panel.classList.toggle('open');
            
            if (panel.classList.contains('open')) {
                updateWatchlistPanel();
            }
        }
        
        // Update watchlist panel UI
        function updateWatchlistPanel() {
            let watchlist = [];
            try {
                watchlist = JSON.parse(localStorage.getItem('spackler_watchlist') || '[]');
            } catch (e) {
                watchlist = [];
            }
            
            const itemsContainer = document.getElementById('watchlistItems');
            const emptyMessage = document.getElementById('watchlistEmpty');
            const clearButton = document.getElementById('watchlistClear');
            const countBadge = document.getElementById('watchlistCount');
            
            // Update badge count
            if (countBadge) {
                countBadge.textContent = watchlist.length;
            }
            
            if (watchlist.length === 0) {
                emptyMessage.style.display = 'block';
                itemsContainer.innerHTML = '';
                clearButton.style.display = 'none';
                return;
            }
            
            emptyMessage.style.display = 'none';
            clearButton.style.display = 'block';
            
            // Sort by most recent first
            watchlist.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
            
            itemsContainer.innerHTML = watchlist.map((item, index) => `
                <div class="watchlist-item">
                    <div class="item-name">${item.name.split('(')[0].trim()}</div>
                    <div class="item-details">
                        <span class="item-score">Score: ${item.score}</span>
                        <span class="item-date">${item.date || 'N/A'}</span>
                        <button class="item-remove" onclick="removeFromWatchlist(${index})" title="Remove">‚úï</button>
                    </div>
                </div>
            `).join('');
        }
        
        // Remove from watchlist
        function removeFromWatchlist(index) {
            let watchlist = [];
            try {
                watchlist = JSON.parse(localStorage.getItem('spackler_watchlist') || '[]');
            } catch (e) {
                watchlist = [];
            }
            
            const removed = watchlist.splice(index, 1)[0];
            localStorage.setItem('spackler_watchlist', JSON.stringify(watchlist));
            
            showGopherQuip(`Removed from watchlist. They're not out of the woods yet though...`);
            updateWatchlistPanel();
        }
        
        // Clear entire watchlist
        function clearWatchlist() {
            if (confirm('Clear the entire Noonan Watchlist? This cannot be undone.')) {
                localStorage.setItem('spackler_watchlist', '[]');
                showGopherQuip("Watchlist cleared. Fresh start. New hunt begins.");
                updateWatchlistPanel();
            }
        }
        
        // üì§ Export watchlist as JSON file
        function exportWatchlist() {
            let watchlist = [];
            try {
                watchlist = JSON.parse(localStorage.getItem('spackler_watchlist') || '[]');
            } catch (e) {
                watchlist = [];
            }
            
            if (watchlist.length === 0) {
                showGopherQuip("Nothing to export. The watchlist is empty.");
                return;
            }
            
            const exportData = {
                version: "1.0",
                exported: new Date().toISOString(),
                source: "The Spackler Index",
                watchlist: watchlist
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `spackler-watchlist-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showGopherQuip(`Exported ${watchlist.length} suspect(s). Evidence secured.`);
        }
        
        // üì• Import watchlist from JSON file
        function importWatchlist(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importData = JSON.parse(e.target.result);
                    
                    // Validate the import data
                    if (!importData.watchlist || !Array.isArray(importData.watchlist)) {
                        showGopherQuip("Invalid file format. Nice try, cheater.");
                        return;
                    }
                    
                    // Get current watchlist
                    let watchlist = [];
                    try {
                        watchlist = JSON.parse(localStorage.getItem('spackler_watchlist') || '[]');
                    } catch (err) {
                        watchlist = [];
                    }
                    
                    // Merge imported items (avoid duplicates by name)
                    const existingNames = new Set(watchlist.map(item => item.name));
                    let addedCount = 0;
                    
                    importData.watchlist.forEach(item => {
                        if (!existingNames.has(item.name)) {
                            watchlist.push(item);
                            existingNames.add(item.name);
                            addedCount++;
                        }
                    });
                    
                    localStorage.setItem('spackler_watchlist', JSON.stringify(watchlist));
                    updateWatchlistPanel();
                    checkAchievements();
                    
                    showGopherQuip(`Imported ${addedCount} new suspect(s). The hunt expands.`);
                } catch (err) {
                    showGopherQuip("Couldn't parse that file. Is it even JSON?");
                }
            };
            reader.readAsText(file);
            
            // Reset the file input
            event.target.value = '';
        }
        // üìú ADD TO ANALYSIS HISTORY
        // ÔøΩ ADD TO ANALYSIS HISTORY
        function addToHistory(data) {
            let history = [];
            try {
                history = JSON.parse(localStorage.getItem('spackler_history') || '[]');
            } catch (e) {
                history = [];
            }
            
            const entry = {
                name: data.golfer_name,
                score: data.sandbagging_risk_score.toFixed(1),
                riskLevel: data.risk_level,
                redFlags: data.red_flags.length,
                timestamp: Date.now(),
                date: new Date().toLocaleString()
            };
            
            // Add to beginning of history (most recent first)
            history.unshift(entry);
            
            // Keep only last 50 entries
            if (history.length > 50) {
                history = history.slice(0, 50);
            }
            
            localStorage.setItem('spackler_history', JSON.stringify(history));
            updateHistoryPanel();
        }
        
        // Toggle history panel
        function toggleHistoryPanel() {
            const panel = document.getElementById('historyPanel');
            panel.classList.toggle('open');
            
            if (panel.classList.contains('open')) {
                updateHistoryPanel();
            }
        }
        
        // Update history panel UI
        function updateHistoryPanel() {
            let history = [];
            try {
                history = JSON.parse(localStorage.getItem('spackler_history') || '[]');
            } catch (e) {
                history = [];
            }
            
            const itemsContainer = document.getElementById('historyItems');
            const emptyMessage = document.getElementById('historyEmpty');
            const clearButton = document.getElementById('historyClear');
            const countBadge = document.getElementById('historyCount');
            
            // Update badge count
            if (countBadge) {
                countBadge.textContent = history.length;
            }
            
            if (history.length === 0) {
                emptyMessage.style.display = 'block';
                itemsContainer.innerHTML = '';
                clearButton.style.display = 'none';
                return;
            }
            
            emptyMessage.style.display = 'none';
            clearButton.style.display = 'block';
            
            itemsContainer.innerHTML = history.map((item, index) => {
                const scoreColor = item.score >= 75 ? 'var(--explosives-red)' : 
                                   item.score >= 50 ? 'var(--grass-yellow)' : 
                                   item.score >= 25 ? '#f0ad4e' : 
                                   'var(--fairway-green)';
                return `
                    <div class="history-item">
                        <div class="item-name">${item.name.split('(')[0].trim()}</div>
                        <div class="item-details">
                            <span class="item-score" style="color: ${scoreColor}; font-weight: bold;">
                                ${item.score}/100
                            </span>
                            <span class="item-flags" title="Red flags">üö© ${item.redFlags}</span>
                            <span class="item-date">${item.date.split(',')[0]}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Clear analysis history
        function clearHistory() {
            if (confirm('Clear your entire analysis history? This cannot be undone.')) {
                localStorage.setItem('spackler_history', '[]');
                showGopherQuip("History cleared. No evidence left behind.");
                updateHistoryPanel();
                updateStatsPanel();
            }
        }
        
        // Toggle stats panel
        function toggleStatsPanel() {
            const panel = document.getElementById('statsPanel');
            panel.classList.toggle('open');
            
            if (panel.classList.contains('open')) {
                updateStatsPanel();
            }
        }
        
        // Update stats panel
        function updateStatsPanel() {
            let history = [];
            try {
                history = JSON.parse(localStorage.getItem('spackler_history') || '[]');
            } catch (e) {
                history = [];
            }
            
            let watchlist = [];
            try {
                watchlist = JSON.parse(localStorage.getItem('spackler_watchlist') || '[]');
            } catch (e) {
                watchlist = [];
            }
            
            // Calculate stats
            const total = history.length;
            let avgScore = 0;
            let severeCount = 0;
            let highCount = 0;
            let moderateCount = 0;
            let lowCount = 0;
            let totalFlags = 0;
            
            history.forEach(item => {
                const score = parseFloat(item.score);
                avgScore += score;
                totalFlags += item.redFlags || 0;
                
                if (score >= 75) severeCount++;
                else if (score >= 50) highCount++;
                else if (score >= 25) moderateCount++;
                else lowCount++;
            });
            
            avgScore = total > 0 ? (avgScore / total).toFixed(1) : '--';
            
            // Update DOM
            document.getElementById('statsTotal').textContent = total;
            document.getElementById('statsAvgScore').textContent = avgScore;
            document.getElementById('statsSevere').textContent = severeCount;
            document.getElementById('statsClean').textContent = lowCount;
            document.getElementById('statsWatched').textContent = watchlist.length;
            document.getElementById('statsTotalFlags').textContent = totalFlags;
            
            // Update chart
            const maxCount = Math.max(severeCount, highCount, moderateCount, lowCount, 1);
            const chartContainer = document.getElementById('riskChart');
            
            chartContainer.innerHTML = `
                <div class="chart-bar">
                    <div class="bar-count">${lowCount}</div>
                    <div class="bar" style="height: ${(lowCount / maxCount) * 100}%; background: var(--fairway-green);"></div>
                    <div class="bar-label">Low</div>
                </div>
                <div class="chart-bar">
                    <div class="bar-count">${moderateCount}</div>
                    <div class="bar" style="height: ${(moderateCount / maxCount) * 100}%; background: #f0ad4e;"></div>
                    <div class="bar-label">Mod</div>
                </div>
                <div class="chart-bar">
                    <div class="bar-count">${highCount}</div>
                    <div class="bar" style="height: ${(highCount / maxCount) * 100}%; background: var(--grass-yellow);"></div>
                    <div class="bar-label">High</div>
                </div>
                <div class="chart-bar">
                    <div class="bar-count">${severeCount}</div>
                    <div class="bar" style="height: ${(severeCount / maxCount) * 100}%; background: var(--explosives-red);"></div>
                    <div class="bar-label">Severe</div>
                </div>
            `;
        }
        
        // üì§ Share Roast function
        function shareRoast() {
            const golferName = document.getElementById('sand-golfer-name').textContent.split('(')[0].trim();
            const riskScore = document.getElementById('risk-score-display').textContent;
            const riskLevel = document.getElementById('risk-badge').textContent;
            
            // Pick a random roast
            const roast = roastLines[Math.floor(Math.random() * roastLines.length)];
            
            const shareText = `üß® SPACKLER ALERT: ${golferName} has a Suspicion Score of ${riskScore}/100. Verdict: "${roast}" - via Spackler's Handicap Tracker`;
            
            // üèÜ Track share for achievements
            updateStats('sharesCount');
            checkAchievements();
            
            // Try native share API first
            if (navigator.share) {
                navigator.share({
                    title: 'Sandbagger Alert from Spackler',
                    text: shareText
                }).catch(() => {
                    // Fallback to clipboard
                    copyToClipboard(shareText);
                });
            } else {
                copyToClipboard(shareText);
            }
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showGopherQuip("Copied to clipboard! Now go share the shame.");
            }).catch(() => {
                // Fallback
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showGopherQuip("Copied! Time to expose the bagger.");
            });
        }
        
        // ============================================
        // üèÜ SPACKLER'S LICENSE BUREAU - Achievement System
        // ============================================
        
        // Achievement definitions with Caddyshack-themed names
        const ACHIEVEMENTS = {
            FIRST_ANALYSIS: {
                id: 'FIRST_ANALYSIS',
                name: 'Licensed to Kill Gophers',
                description: 'Complete your first suspicion analysis',
                icon: 'üî´',
                requirement: 1,
                type: 'analyses'
            },
            ANALYST_VETERAN: {
                id: 'ANALYST_VETERAN',
                name: 'Groundskeeper Status',
                description: 'Complete 10 suspicion analyses',
                icon: 'üßë‚Äçüåæ',
                requirement: 10,
                type: 'analyses'
            },
            ANALYST_EXPERT: {
                id: 'ANALYST_EXPERT',
                name: 'Licensed to Kill Handicaps',
                description: 'Complete 50 suspicion analyses',
                icon: 'üíÄ',
                requirement: 50,
                type: 'analyses'
            },
            FIRST_SANDBAGGER: {
                id: 'FIRST_SANDBAGGER',
                name: 'Noonan!',
                description: 'Catch your first sandbagger (50+ score)',
                icon: 'üö®',
                requirement: 1,
                type: 'caught'
            },
            FIVE_SANDBAGGERS: {
                id: 'FIVE_SANDBAGGERS',
                name: 'Cinderella Story',
                description: 'Catch 5 sandbaggers',
                icon: '‚≠ê',
                requirement: 5,
                type: 'caught'
            },
            TEN_SANDBAGGERS: {
                id: 'TEN_SANDBAGGERS',
                name: 'Big Hitter, The Lama',
                description: 'Catch 10 sandbaggers',
                icon: 'üèåÔ∏è',
                requirement: 10,
                type: 'caught'
            },
            SEVERE_BAGGER: {
                id: 'SEVERE_BAGGER',
                name: 'Total Consciousness',
                description: 'Find a SEVERE risk sandbagger (75+ score)',
                icon: 'üßò',
                requirement: 1,
                type: 'severe'
            },
            WATCHLIST_STARTED: {
                id: 'WATCHLIST_STARTED',
                name: 'Noonan Watchlist',
                description: 'Add your first golfer to the watchlist',
                icon: 'üìã',
                requirement: 1,
                type: 'watchlist'
            },
            WATCHLIST_FIVE: {
                id: 'WATCHLIST_FIVE',
                name: 'Keeping Tabs',
                description: 'Have 5 golfers on your watchlist',
                icon: 'üëÄ',
                requirement: 5,
                type: 'watchlist'
            },
            SHARED_ROAST: {
                id: 'SHARED_ROAST',
                name: 'Spreading the Word',
                description: 'Share your first roast',
                icon: 'üì§',
                requirement: 1,
                type: 'shares'
            },
            TEAM_ANALYSIS: {
                id: 'TEAM_ANALYSIS',
                name: 'Team Spackler',
                description: 'Complete your first team analysis',
                icon: 'üë•',
                requirement: 1,
                type: 'teams'
            },
            CLEAN_GOLFER: {
                id: 'CLEAN_GOLFER',
                name: 'Not Everyone\'s a Cheat',
                description: 'Find a golfer with under 10 suspicion score',
                icon: 'üòá',
                requirement: 1,
                type: 'clean'
            },
            NIGHT_OWL: {
                id: 'NIGHT_OWL',
                name: 'Night Vision Mode',
                description: 'Activate night vision (tap gopher 5 times)',
                icon: 'ü¶â',
                requirement: 1,
                type: 'easter_egg'
            },
            DEDICATION: {
                id: 'DEDICATION',
                name: 'Gunga Galunga',
                description: 'Use the app 7 different days',
                icon: 'üôè',
                requirement: 7,
                type: 'days'
            },
            HUNDRED_CLUB: {
                id: 'HUNDRED_CLUB',
                name: 'Century of Scrutiny',
                description: 'Complete 100 analyses',
                icon: 'üíØ',
                requirement: 100,
                type: 'analyses'
            },
            TOTAL_CONSCIOUSNESS: {
                id: 'TOTAL_CONSCIOUSNESS',
                name: 'On Your Deathbed',
                description: 'Achieve Total Consciousness (‚Üë‚Üë‚Üì‚Üì‚Üê‚Üí‚Üê‚ÜíBA)',
                icon: 'üßò',
                requirement: 1,
                type: 'philosophy'
            }
        };
        
        // Load achievement progress from localStorage
        function loadAchievementProgress() {
            try {
                return JSON.parse(localStorage.getItem('spackler_achievements') || '{}');
            } catch (e) {
                return {};
            }
        }
        
        // Save achievement progress to localStorage
        function saveAchievementProgress(progress) {
            localStorage.setItem('spackler_achievements', JSON.stringify(progress));
        }
        
        // Get stats from localStorage
        function getStats() {
            try {
                return JSON.parse(localStorage.getItem('spackler_stats') || '{}');
            } catch (e) {
                return {};
            }
        }
        
        // Update stats
        function updateStats(key, value = 1, mode = 'increment') {
            const stats = getStats();
            if (mode === 'increment') {
                stats[key] = (stats[key] || 0) + value;
            } else if (mode === 'set') {
                stats[key] = value;
            } else if (mode === 'max') {
                stats[key] = Math.max(stats[key] || 0, value);
            }
            localStorage.setItem('spackler_stats', JSON.stringify(stats));
            return stats[key];
        }
        
        // Track usage days
        function trackUsageDay() {
            const today = new Date().toDateString();
            let days = [];
            try {
                days = JSON.parse(localStorage.getItem('spackler_usage_days') || '[]');
            } catch (e) {
                days = [];
            }
            if (!days.includes(today)) {
                days.push(today);
                localStorage.setItem('spackler_usage_days', JSON.stringify(days));
            }
            return days.length;
        }
        
        // Check and unlock achievements
        function checkAchievements() {
            const stats = getStats();
            const progress = loadAchievementProgress();
            const watchlist = JSON.parse(localStorage.getItem('spackler_watchlist') || '[]');
            const usageDays = JSON.parse(localStorage.getItem('spackler_usage_days') || '[]').length;
            
            Object.values(ACHIEVEMENTS).forEach(achievement => {
                if (progress[achievement.id]?.unlocked) return; // Already unlocked
                
                let currentValue = 0;
                switch (achievement.type) {
                    case 'analyses':
                        currentValue = stats.totalAnalyses || 0;
                        break;
                    case 'caught':
                        currentValue = stats.sandbaggersCaught || 0;
                        break;
                    case 'severe':
                        currentValue = stats.severeFound || 0;
                        break;
                    case 'watchlist':
                        currentValue = watchlist.length;
                        break;
                    case 'shares':
                        currentValue = stats.sharesCount || 0;
                        break;
                    case 'teams':
                        currentValue = stats.teamAnalyses || 0;
                        break;
                    case 'clean':
                        currentValue = stats.cleanGolfers || 0;
                        break;
                    case 'easter_egg':
                        currentValue = stats.nightVisionActivated || 0;
                        break;
                    case 'days':
                        currentValue = usageDays;
                        break;
                    case 'philosophy':
                        currentValue = stats.philosophyModeActivated || 0;
                        break;
                }
                
                if (currentValue >= achievement.requirement) {
                    unlockAchievement(achievement);
                }
            });
            
            updateAchievementUI();
        }
        
        // Unlock a specific achievement
        function unlockAchievement(achievement) {
            const progress = loadAchievementProgress();
            if (progress[achievement.id]?.unlocked) return;
            
            progress[achievement.id] = {
                unlocked: true,
                unlockedAt: Date.now(),
                isNew: true
            };
            saveAchievementProgress(progress);
            
            // Show notification
            showAchievementNotification(achievement);
            
            // Gopher reaction
            showGopherQuip(`Achievement unlocked: "${achievement.name}"! ${achievement.icon}`, 'happy');
            createDirtSpray();
        }
        
        // Show achievement unlock notification
        function showAchievementNotification(achievement) {
            const notification = document.getElementById('achievementNotification');
            const title = document.getElementById('notificationTitle');
            const desc = document.getElementById('notificationDesc');
            const icon = notification.querySelector('.unlock-icon');
            
            icon.textContent = achievement.icon;
            title.textContent = achievement.name;
            desc.textContent = achievement.description;
            
            notification.classList.add('show');
            
            // üéâ Trigger celebration effect!
            celebrate('achievement');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }
        
        // Update achievement UI
        function updateAchievementUI() {
            const progress = loadAchievementProgress();
            const stats = getStats();
            const list = document.getElementById('achievementsList');
            const countBadge = document.getElementById('achievementCount');
            const unlockedCountEl = document.getElementById('unlockedCount');
            const totalAnalysesEl = document.getElementById('totalAnalyses');
            const sandbaggersCaughtEl = document.getElementById('sandbaggersCaught');
            
            if (!list) return;
            
            // Count unlocked achievements
            const unlockedCount = Object.values(progress).filter(p => p.unlocked).length;
            const newCount = Object.values(progress).filter(p => p.unlocked && p.isNew).length;
            
            // Update badge count
            if (countBadge) {
                countBadge.textContent = newCount > 0 ? newCount : unlockedCount;
                countBadge.style.background = newCount > 0 ? 'var(--explosives-red)' : 'var(--bushwood-green)';
            }
            
            // Update stats display
            if (unlockedCountEl) unlockedCountEl.textContent = unlockedCount;
            if (totalAnalysesEl) totalAnalysesEl.textContent = stats.totalAnalyses || 0;
            if (sandbaggersCaughtEl) sandbaggersCaughtEl.textContent = stats.sandbaggersCaught || 0;
            
            // Build achievement list
            list.innerHTML = '';
            Object.values(ACHIEVEMENTS).forEach(achievement => {
                const isUnlocked = progress[achievement.id]?.unlocked;
                const isNew = progress[achievement.id]?.isNew;
                
                const item = document.createElement('div');
                item.className = `achievement-item ${isUnlocked ? 'unlocked' : 'locked'} ${isNew ? 'new' : ''}`;
                item.innerHTML = `
                    <div class="achievement-icon">${isUnlocked ? achievement.icon : '‚ùì'}</div>
                    <div class="achievement-info">
                        <h4>${isUnlocked ? achievement.name : '???'}</h4>
                        <p>${isUnlocked ? achievement.description : 'Keep playing to unlock!'}</p>
                    </div>
                `;
                
                // Mark as seen when panel is opened
                if (isNew) {
                    item.addEventListener('click', () => {
                        progress[achievement.id].isNew = false;
                        saveAchievementProgress(progress);
                        item.classList.remove('new');
                        updateAchievementUI();
                    });
                }
                
                list.appendChild(item);
            });
        }
        
        // Toggle achievements panel
        function toggleAchievementsPanel() {
            const panel = document.getElementById('achievementsPanel');
            panel.classList.toggle('open');
            
            // Mark all as seen when opening
            if (panel.classList.contains('open')) {
                const progress = loadAchievementProgress();
                let changed = false;
                Object.keys(progress).forEach(key => {
                    if (progress[key].isNew) {
                        progress[key].isNew = false;
                        changed = true;
                    }
                });
                if (changed) {
                    saveAchievementProgress(progress);
                    updateAchievementUI();
                }
            }
        }
        
        // Initialize achievements toggle button
        document.getElementById('achievementsToggle')?.addEventListener('click', toggleAchievementsPanel);
        
        // ============================================
        // üéâ CELEBRATION EFFECTS - Confetti & Particles
        // ============================================
        
        // Sound system state
        let soundEnabled = localStorage.getItem('spackler_sound') !== 'false';
        
        // Initialize sound toggle
        document.getElementById('soundToggle')?.addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            localStorage.setItem('spackler_sound', soundEnabled);
            const toggle = document.getElementById('soundToggle');
            toggle.textContent = soundEnabled ? 'üîä' : 'üîá';
            toggle.classList.toggle('muted', !soundEnabled);
            showGopherQuip(soundEnabled ? "Sound's back! Let's make some noise." : "Going stealth mode. Silent but deadly.");
        });
        
        // Create confetti celebration
        function createConfetti(count = 50) {
            if (currentMode !== 'caddyshack') return;
            
            const container = document.getElementById('confettiContainer');
            if (!container) return;
            
            const colors = ['#1B5E20', '#E8D564', '#8B4513', '#D32F2F', '#FFFFFF', '#4A7C4E'];
            const shapes = ['üèåÔ∏è', '‚õ≥', 'üèÜ', '‚≠ê', 'üéØ'];
            
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.animationDuration = (2 + Math.random() * 2) + 's';
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    
                    // Mix of colored squares and emojis
                    if (Math.random() > 0.4) {
                        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                        if (Math.random() > 0.5) {
                            confetti.style.borderRadius = '50%';
                        }
                    } else {
                        confetti.textContent = shapes[Math.floor(Math.random() * shapes.length)];
                        confetti.style.fontSize = (12 + Math.random() * 10) + 'px';
                        confetti.style.background = 'transparent';
                    }
                    
                    container.appendChild(confetti);
                    
                    // Remove after animation
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 30);
            }
        }
        
        // Create golf ball particles
        function createGolfBallBurst(x, y, count = 5) {
            if (currentMode !== 'caddyshack') return;
            
            for (let i = 0; i < count; i++) {
                const ball = document.createElement('div');
                ball.className = 'golf-ball-particle';
                ball.textContent = '‚ö™';
                ball.style.left = (x + (Math.random() - 0.5) * 100) + 'px';
                ball.style.top = y + 'px';
                ball.style.animationDelay = (i * 0.1) + 's';
                document.body.appendChild(ball);
                
                setTimeout(() => ball.remove(), 2500);
            }
        }
        
        // Create explosion burst
        function createExplosionBurst(x, y) {
            if (currentMode !== 'caddyshack') return;
            
            const burst = document.createElement('div');
            burst.className = 'explosion-burst';
            burst.style.left = x + 'px';
            burst.style.top = y + 'px';
            document.body.appendChild(burst);
            
            // Add screen shake
            document.body.classList.add('screen-shake');
            setTimeout(() => document.body.classList.remove('screen-shake'), 500);
            
            // Create sparkles around explosion
            for (let i = 0; i < 12; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                const angle = (i / 12) * Math.PI * 2;
                const distance = 50 + Math.random() * 50;
                sparkle.style.left = (x + Math.cos(angle) * distance) + 'px';
                sparkle.style.top = (y + Math.sin(angle) * distance) + 'px';
                sparkle.style.animationDelay = (Math.random() * 0.3) + 's';
                document.body.appendChild(sparkle);
                setTimeout(() => sparkle.remove(), 1000);
            }
            
            setTimeout(() => burst.remove(), 800);
        }
        
        // Create sparkle trail
        function createSparkleTrail(element) {
            if (currentMode !== 'caddyshack' || !element) return;
            
            const rect = element.getBoundingClientRect();
            const count = 8;
            
            for (let i = 0; i < count; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.left = (rect.left + Math.random() * rect.width) + 'px';
                sparkle.style.top = (rect.top + Math.random() * rect.height) + 'px';
                sparkle.style.animationDelay = (i * 0.1) + 's';
                sparkle.style.background = i % 2 === 0 ? 'var(--grass-yellow)' : '#fff';
                document.body.appendChild(sparkle);
                setTimeout(() => sparkle.remove(), 1000);
            }
        }
        
        // Celebration based on event type
        function celebrate(type, x = window.innerWidth / 2, y = window.innerHeight / 2) {
            if (currentMode !== 'caddyshack') return;
            
            switch (type) {
                case 'achievement':
                    createConfetti(40);
                    createGolfBallBurst(x, y, 3);
                    break;
                case 'sandbagger':
                    createExplosionBurst(x, y);
                    createConfetti(20);
                    break;
                case 'severe':
                    createExplosionBurst(x, y);
                    createExplosionBurst(x - 100, y + 50);
                    createExplosionBurst(x + 100, y + 50);
                    createConfetti(60);
                    break;
                case 'clean':
                    createGolfBallBurst(x, y, 8);
                    createSparkleTrail(document.querySelector('.risk-card'));
                    break;
                case 'analysis':
                    createSparkleTrail(document.querySelector('.suspicion-gauge'));
                    break;
            }
        }
        
        // Update initializeApp with sound state
        function initSoundToggle() {
            const toggle = document.getElementById('soundToggle');
            if (toggle) {
                toggle.textContent = soundEnabled ? 'üîä' : 'üîá';
                toggle.classList.toggle('muted', !soundEnabled);
            }
        }
        
        // Initialize app
        function initializeApp() {
            loadSavedFormData();
            trackUsageDay();
            checkAchievements();
            updateAchievementUI();
            initSoundToggle();
            updateFooterQuote();
            refreshCarlTip();
            updateWatchlistPanel();
            updateHistoryPanel();
            updateStatsPanel();
            checkFirstTimeUser();
        }
        
        // üÜï FIRST-TIME USER EXPERIENCE
        function checkFirstTimeUser() {
            const hasSeenWelcome = localStorage.getItem('spackler_seen_welcome');
            if (!hasSeenWelcome) {
                // Show welcome modal after splash screen dismisses
                setTimeout(() => {
                    const welcomeModal = document.getElementById('welcomeModal');
                    if (welcomeModal) {
                        welcomeModal.classList.add('show');
                    }
                }, 500);
            }
        }
        
        function dismissWelcome() {
            localStorage.setItem('spackler_seen_welcome', 'true');
            const welcomeModal = document.getElementById('welcomeModal');
            if (welcomeModal) {
                welcomeModal.classList.remove('show');
            }
        }
        
        function startQuickCheck() {
            dismissWelcome();
            // Navigate to the Suspects tab
            showTab('sandbagging');
            // Scroll to form
            setTimeout(() => {
                const form = document.getElementById('sandbagging-form');
                if (form) {
                    form.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 300);
        }
        
        // Check Another Player - reset form and scroll to top
        function checkAnotherPlayer() {
            // Hide results
            document.getElementById('sandbagging-results').style.display = 'none';
            
            // Reset name field
            document.getElementById('sand-name').value = '';
            document.getElementById('sand-name').focus();
            
            // Scroll back to form
            document.getElementById('sandbagging-form').scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Show encouraging gopher quip
            showGopherQuip("Fresh suspect? Let's get 'em. Enter their info.");
        }
        
        // Update quick summary based on results
        function updateQuickSummary(data) {
            const summary = document.getElementById('resultsQuickSummary');
            const verdict = document.getElementById('quickVerdict');
            const score = document.getElementById('quickScore');
            const explanation = document.getElementById('quickExplanation');
            
            const riskScore = data.sandbagging_risk_score;
            score.textContent = riskScore.toFixed(0) + '/100';
            
            // Remove all verdict classes
            summary.classList.remove('verdict-clean', 'verdict-suspicious', 'verdict-likely');
            
            if (riskScore < 25) {
                summary.classList.add('verdict-clean');
                verdict.textContent = '‚úÖ Looks Legit';
                explanation.innerHTML = `
                    <strong>Good news!</strong> Their scores are consistent with their stated handicap.<br>
                    No unusual patterns detected. Play on!
                `;
            } else if (riskScore < 50) {
                summary.classList.add('verdict-suspicious');
                verdict.textContent = 'ü§î Slightly Unusual';
                explanation.innerHTML = `
                    <strong>A few things look off</strong>, but could be explained by a hot streak.<br>
                    Worth keeping an eye on. Check the red flags below.
                `;
            } else if (riskScore < 75) {
                summary.classList.add('verdict-suspicious');
                verdict.textContent = '‚ö†Ô∏è Suspicious Patterns';
                explanation.innerHTML = `
                    <strong>Multiple red flags detected.</strong> Their performance significantly exceeds what their handicap suggests.<br>
                    You might want to bring this to the tournament committee's attention.
                `;
            } else {
                summary.classList.add('verdict-likely');
                verdict.textContent = 'üö® High Likelihood of Sandbagging';
                explanation.innerHTML = `
                    <strong>Strong evidence of handicap manipulation.</strong> Statistically, these scores are nearly impossible for someone with their stated handicap.<br>
                    Consider discussing with tournament officials.
                `;
            }
        }
        
        // Carl's random tips for the tip banner
        const carlTips = [
            "A looper's advice: Check the handicap index first. Trust, but verify.",
            "In my experience, if a score looks too good to be true... it probably is.",
            "The Dalai Lama told me: 'Watch the patterns, not just the numbers.'",
            "Remember: Everyone has a hot streak. But statistical improbability? That's different.",
            "I once caddied for a sandbagger in Tibet. Total consciousness didn't help him cheat.",
            "Big hitter, the Lama. Also said: 'Use multiple rounds for better analysis.'",
            "Licensed to kill gophers AND spot handicap inflation. Multitasking.",
            "Course difficulty matters. A 72 at Augusta is not a 72 at the local muni.",
            "When the joint probability gets too low, something fishy is going on.",
            "My hybrid grass? It's sticky. Like the numbers on a sandbagger's scorecard.",
            "Cinderella story? More like Pinnochio story when those scores are fake.",
            "Check the variance. Consistent baggers are easier to spot than lucky ones.",
            "I've outsmarted even myself tracking these numbers. And some sandbaggers too.",
            "Casual rounds vs tournament rounds... that differential tells a story.",
            "Gunga galunga. Also: Always check the red flags section."
        ];
        
        // Refresh Carl's tip
        function refreshCarlTip() {
            const tipText = document.getElementById('carl-tip-text');
            if (tipText && currentMode === 'caddyshack') {
                const tip = carlTips[Math.floor(Math.random() * carlTips.length)];
                tipText.style.opacity = '0';
                setTimeout(() => {
                    tipText.textContent = tip;
                    tipText.style.opacity = '1';
                }, 200);
            }
        }
        
        // Update footer with Quote of the Day
        function updateFooterQuote() {
            if (currentMode !== 'caddyshack') return;
            
            const quote = getQuoteOfTheDay();
            const footerQuote = document.getElementById('footer-quote');
            const footerAttr = document.getElementById('footer-quote-attr');
            
            if (footerQuote && quote) {
                footerQuote.textContent = `"${quote.quote}"`;
                if (footerAttr) {
                    footerAttr.textContent = `‚Äî ${quote.character}, Quote of the Day`;
                }
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            const tabIndex = tabName === 'individual' ? 1 : 
                            (tabName === 'team' ? 2 : 
                            (tabName === 'consecutive' ? 3 : 
                            (tabName === 'completed' ? 4 : 5)));
            document.querySelector(`.tab:nth-child(${tabIndex})`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Show tab-specific Carl quip occasionally
            if (currentMode === 'caddyshack' && Math.random() < 0.3) {
                const tabKey = tabName === 'individual' ? 'probability' : 
                              (tabName === 'sandbagging' ? 'sandbagging' : 'team');
                const quips = tabQuips[tabKey];
                if (quips && quips.length > 0) {
                    setTimeout(() => {
                        showGopherQuip(quips[Math.floor(Math.random() * quips.length)]);
                    }, 500);
                }
            }
        }

        function formatPercent(value) {
            return (value * 100).toFixed(1) + '%';
        }

        function getProbClass(prob) {
            return prob >= 0.2 ? 'prob-high' : 'prob-low';
        }

        // LocalStorage functions for form persistence
        function saveFormData(formName, data) {
            try {
                localStorage.setItem(`golf_${formName}`, JSON.stringify(data));
            } catch (e) {
                console.warn('Could not save form data to localStorage:', e);
            }
        }

        function loadFormData(formName) {
            try {
                const data = localStorage.getItem(`golf_${formName}`);
                return data ? JSON.parse(data) : null;
            } catch (e) {
                console.warn('Could not load form data from localStorage:', e);
                return null;
            }
        }
        
        function loadSavedFormData() {
            const individualData = loadFormData('individual');
            if (individualData) {
                if (individualData.handicap) document.getElementById('handicap').value = individualData.handicap;
                if (individualData.targetScore) document.getElementById('target-score').value = individualData.targetScore;
                if (individualData.courseName) document.getElementById('course-name').value = individualData.courseName;
                if (individualData.teeName) document.getElementById('tee-name').value = individualData.teeName;
                if (individualData.par) document.getElementById('par').value = individualData.par;
                if (individualData.courseRating) document.getElementById('course-rating').value = individualData.courseRating;
                if (individualData.slopeRating) document.getElementById('slope-rating').value = individualData.slopeRating;
                if (individualData.numRounds) document.getElementById('num-rounds').value = individualData.numRounds;
                if (individualData.holesPlayed) document.getElementById('individual-holes-played').value = individualData.holesPlayed;
            }

            const consecutiveData = loadFormData('consecutive');
            if (consecutiveData) {
                if (consecutiveData.handicap) document.getElementById('cons-handicap').value = consecutiveData.handicap;
                if (consecutiveData.targetScore) document.getElementById('cons-target-score').value = consecutiveData.targetScore;
                if (consecutiveData.holesPerRound) document.getElementById('holes-per-round').value = consecutiveData.holesPerRound;
                if (consecutiveData.consecutiveCount) document.getElementById('consecutive-count').value = consecutiveData.consecutiveCount;
                if (consecutiveData.totalMatches) document.getElementById('total-matches').value = consecutiveData.totalMatches;
            }
        }

        function setFormLoading(formId, isLoading) {
            const form = document.getElementById(formId);
            const inputs = form.querySelectorAll('input, select, button');
            inputs.forEach(input => {
                input.disabled = isLoading;
            });
        }

        // Initialize app on page load
        window.addEventListener('DOMContentLoaded', () => {
            applyMode(currentMode);  // Apply saved theme mode
            loadSavedFormData();     // Load saved form data
        });

        // Individual Player Form
        document.getElementById('individual-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const loading = document.getElementById('individual-loading');
            const results = document.getElementById('individual-results');
            const error = document.getElementById('individual-error');
            
            loading.classList.add('active');
            results.style.display = 'none';
            error.style.display = 'none';

            const golfer = {
                handicap_index: parseFloat(document.getElementById('handicap').value)
            };
            
            const course = {
                course_name: document.getElementById('course-name').value,
                tee_name: document.getElementById('tee-name').value,
                par: parseInt(document.getElementById('par').value),
                course_rating: parseFloat(document.getElementById('course-rating').value),
                slope_rating: parseInt(document.getElementById('slope-rating').value)
            };
            
            const targetScore = parseInt(document.getElementById('target-score').value);
            const numRounds = parseInt(document.getElementById('num-rounds').value);
            const holesPlayed = parseInt(document.getElementById('individual-holes-played').value);

            // Save form data
            saveFormData('individual', {
                handicap: golfer.handicap_index,
                targetScore: targetScore,
                courseName: course.course_name,
                teeName: course.tee_name,
                par: course.par,
                courseRating: course.course_rating,
                slopeRating: course.slope_rating,
                numRounds: numRounds,
                holesPlayed: holesPlayed
            });

            // Validate inputs
            if (holesPlayed === 9 && targetScore < 25) {
                error.textContent = 'Target score for 9-hole rounds must be at least 25';
                error.style.display = 'block';
                loading.classList.remove('active');
                return;
            }

            setFormLoading('individual-form', true);

            try {
                // Single round probability
                const singleResponse = await fetch(`${API_BASE}/probability/single-round`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        golfer: golfer,
                        course: course,
                        target: { target_score: targetScore },
                        holes_played: holesPlayed
                    })
                });
                
                if (!singleResponse.ok) throw new Error('Failed to calculate single round probability');
                const singleData = await singleResponse.json();

                // Multi-round probability
                const multiResponse = await fetch(`${API_BASE}/probability/multi-round`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        golfer: golfer,
                        course: course,
                        target: { target_score: targetScore },
                        event: { num_rounds: numRounds },
                        holes_played: holesPlayed
                    })
                });
                
                if (!multiResponse.ok) throw new Error('Failed to calculate multi-round probability');
                const multiData = await multiResponse.json();

                // Milestones
                const milestonesResponse = await fetch(`${API_BASE}/probability/milestones`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        golfer: golfer,
                        course: course,
                        event: { num_rounds: numRounds },
                        holes_played: holesPlayed
                    })
                });
                
                if (!milestonesResponse.ok) throw new Error('Failed to calculate milestone probabilities');
                const milestonesData = await milestonesResponse.json();

                // Update UI
                document.getElementById('single-prob').textContent = formatPercent(singleData.probability_score_at_or_below_target);
                document.getElementById('expected-score').textContent = singleData.expected_score.toFixed(1);
                document.getElementById('score-std').textContent = '¬±' + singleData.score_std.toFixed(1);
                document.getElementById('target-display').textContent = singleData.target_score;
                document.getElementById('z-score').textContent = singleData.z_score ? singleData.z_score.toFixed(2) : '--';

                document.getElementById('multi-prob').textContent = formatPercent(multiData.probability_at_least_once);
                document.getElementById('prob-at-least-once').textContent = formatPercent(multiData.probability_at_least_once);
                document.getElementById('num-rounds-display').textContent = multiData.num_rounds;

                // Milestones table
                const milestonesBody = document.getElementById('milestones-body');
                milestonesBody.innerHTML = '';
                milestonesData.milestones.forEach(milestone => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${milestone.target_score}</strong></td>
                        <td class="${getProbClass(milestone.prob_single_round_at_or_below)}">${formatPercent(milestone.prob_single_round_at_or_below)}</td>
                        <td class="${getProbClass(milestone.prob_at_least_once_in_event)}">${formatPercent(milestone.prob_at_least_once_in_event)}</td>
                    `;
                    milestonesBody.appendChild(row);
                });

                loading.classList.remove('active');
                setFormLoading('individual-form', false);
                results.style.display = 'block';
            } catch (err) {
                loading.classList.remove('active');
                setFormLoading('individual-form', false);
                error.textContent = err.message;
                error.style.display = 'block';
            }
        });

        // Team Form
        document.getElementById('team-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const loading = document.getElementById('team-loading');
            const results = document.getElementById('team-results');
            const error = document.getElementById('team-error');
            
            loading.classList.add('active');
            results.style.display = 'none';
            error.style.display = 'none';

            const team = {
                player1: {
                    golfer: { handicap_index: parseFloat(document.getElementById('p1-handicap').value) }
                },
                player2: {
                    golfer: { handicap_index: parseFloat(document.getElementById('p2-handicap').value) }
                }
            };
            
            const course = {
                course_name: document.getElementById('team-course-name').value,
                tee_name: document.getElementById('team-tee-name').value,
                par: parseInt(document.getElementById('team-par').value),
                course_rating: parseFloat(document.getElementById('team-course-rating').value),
                slope_rating: parseInt(document.getElementById('team-slope-rating').value)
            };
            
            const bestballTarget = {
                target_net_score: parseInt(document.getElementById('target-net-score').value),
                handicap_allowance_percent: parseFloat(document.getElementById('handicap-allowance').value)
            };
            
            const numRounds = parseInt(document.getElementById('team-num-rounds').value);
            const minSuccessRounds = parseInt(document.getElementById('min-success-rounds').value);

            try {
                const response = await fetch(`${API_BASE}/team/bestball/probability/multi-round`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        team: team,
                        course: course,
                        bestball_target: bestballTarget,
                        event: { num_rounds: numRounds },
                        min_success_rounds: minSuccessRounds
                    })
                });
                
                if (!response.ok) throw new Error('Failed to calculate team probability');
                const data = await response.json();

                // Update UI
                document.getElementById('team-single-prob').textContent = formatPercent(data.probability_net_bestball_at_or_below_target_single_round);
                document.getElementById('team-expected-bb').textContent = data.expected_team_bestball_score_single_round.toFixed(1);
                document.getElementById('team-std-bb').textContent = '¬±' + data.std_team_bestball_score_single_round.toFixed(1);
                document.getElementById('team-target-display').textContent = data.target_net_score;
                
                document.getElementById('team-multi-prob').textContent = formatPercent(data.probability_at_least_once_in_event);
                document.getElementById('team-prob-at-least-once').textContent = formatPercent(data.probability_at_least_once_in_event);
                document.getElementById('team-prob-at-least-n').textContent = formatPercent(data.probability_at_least_min_success_rounds);
                document.getElementById('team-simulations').textContent = data.num_simulations_used.toLocaleString();

                // Summary text
                const singleProb = (data.probability_net_bestball_at_or_below_target_single_round * 100).toFixed(0);
                const multiProb = (data.probability_at_least_once_in_event * 100).toFixed(0);
                document.getElementById('team-summary').innerHTML = `
                    Your team has a <strong>${singleProb}%</strong> chance of firing net ${data.target_net_score} or better 
                    in any one round, and a <strong>${multiProb}%</strong> chance of doing it at least once 
                    over ${data.num_rounds} rounds.
                `;
                
                // üèÜ Track team analysis for achievements
                updateStats('teamAnalyses');
                checkAchievements();

                loading.classList.remove('active');
                setFormLoading('team-form', false);
                results.style.display = 'block';
            } catch (err) {
                loading.classList.remove('active');
                setFormLoading('team-form', false);
                error.textContent = err.message;
                error.style.display = 'block';
            }
        });

        // Consecutive Scores Form
        document.getElementById('consecutive-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const loading = document.getElementById('consecutive-loading');
            const results = document.getElementById('consecutive-results');
            const error = document.getElementById('consecutive-error');
            
            loading.classList.add('active');
            results.style.display = 'none';
            error.style.display = 'none';

            const golfer = {
                handicap_index: parseFloat(document.getElementById('cons-handicap').value)
            };
            
            const course = {
                course_name: document.getElementById('cons-course-name').value,
                tee_name: document.getElementById('cons-tee-name').value,
                par: parseInt(document.getElementById('cons-par').value),
                course_rating: parseFloat(document.getElementById('cons-course-rating').value),
                slope_rating: parseInt(document.getElementById('cons-slope-rating').value)
            };
            
            const targetScore = parseInt(document.getElementById('cons-target-score').value);
            const holesPerRound = parseInt(document.getElementById('holes-per-round').value);
            const consecutiveCount = parseInt(document.getElementById('consecutive-count').value);
            const totalMatches = document.getElementById('total-matches').value ? 
                parseInt(document.getElementById('total-matches').value) : null;

            // Save form data
            saveFormData('consecutive', {
                handicap: golfer.handicap_index,
                targetScore: targetScore,
                holesPerRound: holesPerRound,
                consecutiveCount: consecutiveCount,
                totalMatches: totalMatches
            });

            // Validate inputs
            if (holesPerRound === 9 && targetScore < 25) {
                error.textContent = 'Target score for 9-hole rounds must be at least 25';
                error.style.display = 'block';
                loading.classList.remove('active');
                return;
            }

            setFormLoading('consecutive-form', true);

            try {
                const requestBody = {
                    golfer: golfer,
                    course: course,
                    target: { target_score: targetScore },
                    consecutive_count: consecutiveCount,
                    holes_per_round: holesPerRound
                };
                
                if (totalMatches) {
                    requestBody.total_matches = totalMatches;
                }

                const response = await fetch(`${API_BASE}/probability/consecutive`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                
                if (!response.ok) throw new Error('Failed to calculate consecutive probability');
                const data = await response.json();

                // Update UI
                document.getElementById('cons-single-prob').textContent = formatPercent(data.single_round_probability);
                document.getElementById('cons-expected-score').textContent = data.expected_score.toFixed(1);
                document.getElementById('cons-score-std').textContent = '¬±' + data.score_std.toFixed(1);
                document.getElementById('cons-target-display').textContent = data.target_score;
                document.getElementById('cons-holes-display').textContent = data.holes_per_round;
                
                document.getElementById('cons-all-prob').textContent = formatPercent(data.probability_all_consecutive);
                document.getElementById('cons-count-display').textContent = data.consecutive_count;
                document.getElementById('cons-all-display').textContent = formatPercent(data.probability_all_consecutive);
                
                // Show streak probability if total_matches was specified
                if (data.probability_streak_in_matches !== null) {
                    document.getElementById('streak-container').style.display = 'block';
                    document.getElementById('cons-streak-display').textContent = formatPercent(data.probability_streak_in_matches);
                } else {
                    document.getElementById('streak-container').style.display = 'none';
                }

                // Summary text
                const singleProb = (data.single_round_probability * 100).toFixed(1);
                const allProb = (data.probability_all_consecutive * 100).toFixed(2);
                let summaryText = `
                    You have a <strong>${singleProb}%</strong> chance of shooting ${data.target_score} or better 
                    in a single ${data.holes_per_round}-hole round, and a <strong>${allProb}%</strong> chance 
                    of doing it ${data.consecutive_count} times in a row.
                `;
                
                if (data.probability_streak_in_matches !== null) {
                    const streakProb = (data.probability_streak_in_matches * 100).toFixed(2);
                    summaryText += `<br><br>Over ${data.total_matches} total matches, there's a <strong>${streakProb}%</strong> 
                    chance of having at least one streak of ${data.consecutive_count} consecutive scores at or below ${data.target_score}.`;
                }
                
                document.getElementById('consecutive-summary').innerHTML = summaryText;

                loading.classList.remove('active');
                setFormLoading('consecutive-form', false);
                results.style.display = 'block';
            } catch (err) {
                loading.classList.remove('active');
                setFormLoading('consecutive-form', false);
                error.textContent = err.message;
                error.style.display = 'block';
            }
        });

        // Helper function to add score entry
        let scoreEntryCount = 1;
        function addScoreEntry() {
            scoreEntryCount++;
            const container = document.getElementById('scores-container');
            const newEntry = document.createElement('div');
            newEntry.className = 'score-entry';
            newEntry.setAttribute('data-round', scoreEntryCount);
            newEntry.innerHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <label>Round ${scoreEntryCount} Score</label>
                        <input type="number" class="score-input" min="25" max="200" required>
                    </div>
                    <div class="form-group">
                        <label>Holes Played</label>
                        <select class="holes-input" required>
                            <option value="18" selected>18 Holes</option>
                            <option value="9">9 Holes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Date (Optional)</label>
                        <input type="date" class="date-input">
                    </div>
                    <div class="form-group">
                        <label>Notes (Optional)</label>
                        <input type="text" class="notes-input" placeholder="e.g., Windy day">
                    </div>
                </div>
            `;
            container.appendChild(newEntry);
        }

        // Completed Rounds Analysis Form
        document.getElementById('completed-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const loading = document.getElementById('completed-loading');
            const results = document.getElementById('completed-results');
            const error = document.getElementById('completed-error');
            
            loading.classList.add('active');
            results.style.display = 'none';
            error.style.display = 'none';

            const golfer = {
                name: document.getElementById('comp-name').value,
                handicap_index: parseFloat(document.getElementById('comp-handicap').value)
            };
            
            const course = {
                course_name: document.getElementById('comp-course-name').value,
                tee_name: document.getElementById('comp-tee-name').value,
                par: parseInt(document.getElementById('comp-par').value),
                course_rating: parseFloat(document.getElementById('comp-course-rating').value),
                slope_rating: parseInt(document.getElementById('comp-slope-rating').value)
            };

            // Collect all score entries
            const scoreEntries = document.querySelectorAll('.score-entry');
            const completedScores = [];
            scoreEntries.forEach((entry, index) => {
                const score = parseInt(entry.querySelector('.score-input').value);
                const holes = parseInt(entry.querySelector('.holes-input').value);
                const date = entry.querySelector('.date-input').value || null;
                const notes = entry.querySelector('.notes-input').value || null;
                
                completedScores.push({
                    round_number: index + 1,
                    gross_score: score,
                    holes_played: holes,
                    round_date: date,
                    notes: notes
                });
            });

            try {
                const response = await fetch(`${API_BASE}/analyze/completed-rounds`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        golfer: golfer,
                        course: course,
                        completed_scores: completedScores
                    })
                });
                
                if (!response.ok) throw new Error('Failed to analyze completed rounds');
                const data = await response.json();

                // Update summary section
                document.getElementById('comp-golfer-display').textContent = 
                    `${data.golfer_name} (${data.handicap_index} HCP) @ ${data.course_name}`;
                document.getElementById('comp-rounds-badge').textContent = 
                    `${data.num_rounds_analyzed} round${data.num_rounds_analyzed > 1 ? 's' : ''}`;
                document.getElementById('comp-expected').textContent = data.expected_score_per_round.toFixed(1);
                document.getElementById('comp-average').textContent = data.average_actual_score.toFixed(1);
                
                const diffColor = data.total_strokes_from_expected < 0 ? 'var(--success)' : 'var(--error)';
                const diffSign = data.total_strokes_from_expected > 0 ? '+' : '';
                document.getElementById('comp-total-diff').innerHTML = 
                    `<span style="color: ${diffColor}; font-weight: bold;">${diffSign}${data.total_strokes_from_expected.toFixed(1)}</span>`;
                
                document.getElementById('comp-overall-prob').textContent = formatPercent(data.overall_probability);
                document.getElementById('completed-overall-summary').innerHTML = 
                    `<strong>${data.overall_performance_descriptor}</strong>`;

                // Individual rounds analysis
                const roundsContainer = document.getElementById('rounds-analysis-container');
                roundsContainer.innerHTML = '';
                
                data.round_analyses.forEach(round => {
                    const diffSign = round.strokes_from_expected > 0 ? '+' : '';
                    const diffColor = round.strokes_from_expected < 0 ? 'var(--success)' : 
                                     (round.strokes_from_expected > 0 ? 'var(--error)' : 'var(--text-primary)');
                    
                    const roundCard = document.createElement('div');
                    roundCard.style.cssText = 'border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #fafafa;';
                    roundCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h5 style="margin: 0;">Round ${round.round_number} <span style="font-size: 0.85rem; color: var(--text-secondary);">(${round.holes_played} holes)</span></h5>
                            <span style="font-size: 1.5rem; font-weight: bold;">${round.actual_score}</span>
                        </div>
                        <div class="detail-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                            <div class="detail-item">
                                <div class="label">Expected</div>
                                <div class="value">${round.expected_score.toFixed(1)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="label">From Expected</div>
                                <div class="value" style="color: ${diffColor}; font-weight: bold;">${diffSign}${round.strokes_from_expected.toFixed(1)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="label">Probability</div>
                                <div class="value">${formatPercent(round.probability_at_or_below)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="label">Percentile</div>
                                <div class="value">${round.percentile.toFixed(1)}%</div>
                            </div>
                        </div>
                        <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 6px; font-style: italic; color: var(--text-secondary);">
                            ${round.performance_descriptor}
                        </div>
                    `;
                    roundsContainer.appendChild(roundCard);
                });

                // Performance highlights
                document.getElementById('comp-best-score').textContent = data.best_round.actual_score;
                document.getElementById('comp-best-prob').textContent = 
                    `${formatPercent(data.best_round.probability_at_or_below)} (Round ${data.best_round.round_number})`;
                document.getElementById('comp-worst-score').textContent = data.worst_round.actual_score;
                document.getElementById('comp-worst-prob').textContent = 
                    `${formatPercent(data.worst_round.probability_at_or_below)} (Round ${data.worst_round.round_number})`;

                loading.classList.remove('active');
                results.style.display = 'block';
            } catch (err) {
                loading.classList.remove('active');
                error.textContent = err.message;
                error.style.display = 'block';
            }
        });

        // Sandbagging Detection Helper Functions
        let tournamentScoreCount = 1;
        let casualScoreCount = 0;
        
        function addTournamentScore() {
            tournamentScoreCount++;
            const container = document.getElementById('tournament-scores-container');
            const newEntry = document.createElement('div');
            newEntry.className = 'score-entry';
            newEntry.innerHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <label>Tournament Round ${tournamentScoreCount}</label>
                        <input type="number" class="tournament-score-input" min="25" max="200" required>
                    </div>
                    <div class="form-group">
                        <label>Holes</label>
                        <select class="tournament-holes-input" required>
                            <option value="18" selected>18</option>
                            <option value="9">9</option>
                        </select>
                    </div>
                </div>
            `;
            container.appendChild(newEntry);
        }

        function addCasualScore() {
            casualScoreCount++;
            const container = document.getElementById('casual-scores-container');
            const newEntry = document.createElement('div');
            newEntry.className = 'score-entry';
            newEntry.innerHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <label>Casual Round ${casualScoreCount}</label>
                        <input type="number" class="casual-score-input" min="25" max="200" required>
                    </div>
                    <div class="form-group">
                        <label>Holes</label>
                        <select class="casual-holes-input" required>
                            <option value="18" selected>18</option>
                            <option value="9">9</option>
                        </select>
                    </div>
                </div>
            `;
            container.appendChild(newEntry);
        }

        // Sandbagging Analysis Form
        document.getElementById('sandbagging-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const loading = document.getElementById('sandbagging-loading');
            const results = document.getElementById('sandbagging-results');
            const error = document.getElementById('sandbagging-error');
            const loadingQuote = document.getElementById('loading-quote');
            
            loading.classList.add('active');
            results.style.display = 'none';
            error.style.display = 'none';
            
            // Start rotating Carl's loading quotes
            if (currentMode === 'caddyshack' && loadingQuote) {
                startLoadingQuotes(loadingQuote);
            }

            const golfer = {
                name: document.getElementById('sand-name').value,
                handicap_index: parseFloat(document.getElementById('sand-handicap').value)
            };
            
            const course = {
                course_name: document.getElementById('sand-course-name').value,
                tee_name: document.getElementById('sand-tee-name').value,
                par: parseInt(document.getElementById('sand-par').value),
                course_rating: parseFloat(document.getElementById('sand-course-rating').value),
                slope_rating: parseInt(document.getElementById('sand-slope-rating').value)
            };

            // Collect tournament scores
            const tournamentScores = [];
            document.querySelectorAll('#tournament-scores-container .score-entry').forEach((entry, index) => {
                const score = parseInt(entry.querySelector('.tournament-score-input').value);
                const holes = parseInt(entry.querySelector('.tournament-holes-input').value);
                tournamentScores.push({
                    round_number: index + 1,
                    gross_score: score,
                    holes_played: holes
                });
            });

            // Collect casual scores (if any)
            let casualScores = null;
            const casualEntries = document.querySelectorAll('#casual-scores-container .score-entry');
            if (casualEntries.length > 0) {
                casualScores = [];
                casualEntries.forEach((entry, index) => {
                    const score = parseInt(entry.querySelector('.casual-score-input').value);
                    const holes = parseInt(entry.querySelector('.casual-holes-input').value);
                    casualScores.push({
                        round_number: index + 1,
                        gross_score: score,
                        holes_played: holes
                    });
                });
            }

            try {
                const requestBody = {
                    golfer: golfer,
                    course: course,
                    tournament_scores: tournamentScores
                };
                
                if (casualScores) {
                    requestBody.casual_scores = casualScores;
                }

                const response = await fetch(`${API_BASE}/analyze/sandbagging`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                
                if (!response.ok) throw new Error('Failed to analyze for sandbagging');
                const data = await response.json();

                // üÜï Update quick summary for first-time users
                updateQuickSummary(data);
                
                // Update suspicion gauge
                updateGauge(data.sandbagging_risk_score);

                // Update risk card
                document.getElementById('sand-golfer-name').textContent = 
                    `${data.golfer_name} (${data.handicap_index} HCP)`;
                
                const riskBadge = document.getElementById('risk-badge');
                const riskCard = document.getElementById('risk-card');
                
                // Get mode-aware badge class and color
                const badgeClass = getRiskBadgeClass(data.risk_level);
                riskBadge.className = 'risk-badge ' + badgeClass;
                riskBadge.textContent = `${data.risk_level}`;
                
                // Apply card styling based on risk level
                const riskColor = getRiskColor(data.sandbagging_risk_score);
                riskCard.style.borderLeftColor = riskColor;
                riskCard.style.borderLeftWidth = '4px';
                
                // Update tier label display if the API returns a tier_label
                const tierLabelEl = document.getElementById('tier-label-display');
                if (tierLabelEl && data.tier_label) {
                    tierLabelEl.textContent = data.tier_label;
                }
                
                document.getElementById('risk-score-display').textContent = data.sandbagging_risk_score.toFixed(1);
                document.getElementById('risk-score-display').style.color = riskColor;
                
                document.getElementById('sand-summary').innerHTML = data.summary;
                document.getElementById('sand-recommendation').textContent = data.recommendation;

                // Update statistics
                document.getElementById('sand-avg-score').textContent = data.tournament_avg_score.toFixed(1);
                
                const avgVsExpected = data.tournament_avg_vs_expected;
                const avgVsExpectedEl = document.getElementById('sand-avg-vs-expected');
                avgVsExpectedEl.textContent = (avgVsExpected > 0 ? '+' : '') + avgVsExpected.toFixed(1);
                avgVsExpectedEl.style.color = avgVsExpected < 0 ? 'var(--success)' : 'var(--error)';
                avgVsExpectedEl.style.fontWeight = 'bold';
                
                document.getElementById('sand-percentile').textContent = data.tournament_performance_percentile.toFixed(1) + '%';
                document.getElementById('sand-volatility').textContent = 
                    `${data.score_volatility.toFixed(1)} (${data.volatility_vs_expected})`;
                document.getElementById('sand-joint-prob').textContent = 
                    (data.probability_all_tournament_scores * 100).toFixed(4) + '%';
                
                // Casual comparison (if available)
                if (data.has_casual_comparison) {
                    document.getElementById('casual-comparison').style.display = 'block';
                    document.getElementById('sand-casual-diff').textContent = 
                        (data.casual_vs_tournament_diff > 0 ? '+' : '') + data.casual_vs_tournament_diff.toFixed(1) + ' strokes';
                } else {
                    document.getElementById('casual-comparison').style.display = 'none';
                }

                // Display red flags with themed styling
                const flagsContainer = document.getElementById('red-flags-container');
                document.getElementById('red-flags-count').textContent = data.red_flags.length;
                
                if (data.red_flags.length === 0) {
                    flagsContainer.innerHTML = '<p class="no-flags">‚úÖ No red flags detected - looking clean!</p>';
                } else {
                    flagsContainer.innerHTML = '';
                    data.red_flags.forEach(flag => {
                        const flagEl = document.createElement('div');
                        flagEl.className = `red-flag-item severity-${flag.severity.toLowerCase()}`;
                        
                        // Get severity icon
                        const severityIcons = {
                            'LOW': 'üí¨',
                            'MEDIUM': '‚ö°',
                            'HIGH': 'üö®',
                            'CRITICAL': 'üî•'
                        };
                        const icon = severityIcons[flag.severity] || 'üö©';
                        
                        flagEl.innerHTML = `
                            <div class="flag-header">
                                <span class="flag-severity">
                                    ${icon} ${flag.severity}
                                </span>
                                <span class="flag-type">
                                    ${flag.flag_type.replace(/_/g, ' ')}
                                </span>
                            </div>
                            <div class="flag-description">${flag.description}</div>
                            <div class="flag-evidence">
                                üìä ${flag.evidence}
                            </div>
                            ${flag.probability_note ? `<div class="flag-note">
                                ‚ÑπÔ∏è ${flag.probability_note}
                            </div>` : ''}
                        `;
                        
                        flagsContainer.appendChild(flagEl);
                    });
                }

                // üé≠ Verdict Theatrics - Carl's commentary based on risk level
                const verdictCard = document.querySelector('.verdict-card');
                if (verdictCard) {
                    // Remove previous severity classes
                    verdictCard.classList.remove('severe-verdict', 'high-verdict', 'moderate-verdict');
                    
                    // Add appropriate class based on risk
                    if (data.risk_level === 'SEVERE' || data.sandbagging_risk_score >= 75) {
                        verdictCard.classList.add('severe-verdict');
                    } else if (data.risk_level === 'HIGH' || data.sandbagging_risk_score >= 50) {
                        verdictCard.classList.add('high-verdict');
                    } else if (data.risk_level === 'MODERATE' || data.sandbagging_risk_score >= 25) {
                        verdictCard.classList.add('moderate-verdict');
                    }
                }
                
                // Carl's verdict quips based on risk level
                const carlVerdicts = {
                    'SEVERE': [
                        "Total freaking bagger. License revoked.",
                        "This guy's handicap is faker than Ty Webb's blindfolded putts.",
                        "Cinderella story... out of nowhere... total sandbagger at Augusta.",
                        "Even the gopher thinks this guy's fishy."
                    ],
                    'HIGH': [
                        "Something smells, and it ain't the fertilizer.",
                        "Gunga galunga. This one's trouble.",
                        "I'd keep an eye on this one. Big hitter. The... liar.",
                        "About as trustworthy as Danny Noonan with a scholarship."
                    ],
                    'MODERATE': [
                        "Hmm. Could be legit. Could be sandbag city.",
                        "I've seen this before. Watch the follow-through.",
                        "Might want to check the scores again...",
                        "Needs more investigation. I'll be watching."
                    ],
                    'LOW': [
                        "Looking clean. For now.",
                        "Seems legit. Go in peace.",
                        "Nothing to see here. Play on.",
                        "Clear as a summer day at Bushwood."
                    ]
                };
                
                // Update Carl's narration with the story
                const narrationText = document.getElementById('narration-text');
                if (narrationText && currentMode === 'caddyshack') {
                    narrationText.textContent = narrateAnalysis(data);
                }
                
                // Get gopher reaction based on risk
                const { mood, style } = gopherReact(data.risk_level, data.sandbagging_risk_score);
                
                // Show gopher with appropriate reaction
                const verdictQuips = carlVerdicts[data.risk_level] || carlVerdicts['MODERATE'];
                const quip = verdictQuips[Math.floor(Math.random() * verdictQuips.length)];
                setTimeout(() => showGopherQuip(quip, mood, style), 800);
                
                // üìú ADD TO ANALYSIS HISTORY
                addToHistory(data);
                
                // üèÜ ACHIEVEMENT TRACKING
                // Track analysis count
                updateStats('totalAnalyses');
                
                // Track if sandbagger caught (50+ score)
                if (data.sandbagging_risk_score >= 50) {
                    updateStats('sandbaggersCaught');
                    // üéâ Celebration for catching a sandbagger!
                    setTimeout(() => celebrate('sandbagger'), 500);
                }
                
                // Track severe finds (75+ score)
                if (data.sandbagging_risk_score >= 75) {
                    updateStats('severeFound');
                    // üéâ Big explosion for severe finds!
                    setTimeout(() => celebrate('severe'), 300);
                }
                
                // Track clean golfers (under 10 score)
                if (data.sandbagging_risk_score < 10) {
                    updateStats('cleanGolfers');
                    // üéâ Golf ball celebration for clean golfers
                    setTimeout(() => celebrate('clean'), 500);
                } else {
                    // üéâ Sparkle effect for any analysis
                    setTimeout(() => celebrate('analysis'), 500);
                }
                
                // Check for new achievements
                checkAchievements();

                // Stop loading quotes and show results
                stopLoadingQuotes();
                loading.classList.remove('active');
                results.style.display = 'block';
                
                // Scroll to results smoothly
                results.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } catch (err) {
                stopLoadingQuotes();
                loading.classList.remove('active');
                error.textContent = getQuote('error');
                error.style.display = 'block';
                showGopherQuip(getQuote('error'), GOPHER_MOODS.SCARED, SPEECH_STYLES.danger);
            }
        });
        
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Spackler SW registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Spackler SW registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>